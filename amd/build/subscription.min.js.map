{"version":3,"file":"subscription.min.js","sources":["../src/subscription.js"],"sourcesContent":["// This file is part of Moodle - http://moodle.org/\n//\n// Moodle is free software: you can redistribute it and/or modify\n// it under the terms of the GNU General Public License as published by\n// the Free Software Foundation, either version 3 of the License, or\n// (at your option) any later version.\n//\n// Moodle is distributed in the hope that it will be useful,\n// but WITHOUT ANY WARRANTY; without even the implied warranty of\n// MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n// GNU General Public License for more details.\n//\n// You should have received a copy of the GNU General Public License\n// along with Moodle.  If not, see <http://www.gnu.org/licenses/>.\n\n/**\n * Subscription management for Adeptus Insights plugin.\n *\n * Handles subscription plan selection, upgrades, downgrades, cancellations,\n * Stripe checkout integration, and billing portal access.\n *\n * @module     report_adeptus_insights/subscription\n * @package\n * @copyright  2026 Adeptus 360 <info@adeptus360.com>\n * @license    http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later\n */\n\ndefine(['jquery', 'core/ajax', 'core/notification', 'core/str'], function($, Ajax, Notification, Str) {\n    'use strict';\n\n    var Swal = window.Swal;\n\n    // Language strings storage\n    var strings = {};\n\n    /**\n     * Load all language strings needed for the module\n     * @returns {Promise} Promise that resolves when strings are loaded\n     */\n    var loadStrings = function() {\n        return Str.get_strings([\n            {key: 'js_verifying_payment', component: 'report_adeptus_insights'},\n            {key: 'js_verifying_payment_text', component: 'report_adeptus_insights'},\n            {key: 'js_upgrade_successful', component: 'report_adeptus_insights'},\n            {key: 'js_verification_issue', component: 'report_adeptus_insights'},\n            {key: 'js_verification_issue_text', component: 'report_adeptus_insights'},\n            {key: 'js_processing_payment', component: 'report_adeptus_insights'},\n            {key: 'js_processing_payment_text', component: 'report_adeptus_insights'},\n            {key: 'js_checkout_cancelled', component: 'report_adeptus_insights'},\n            {key: 'js_checkout_cancelled_text', component: 'report_adeptus_insights'},\n            {key: 'js_cancel_subscription_title', component: 'report_adeptus_insights'},\n            {key: 'js_cancel_subscription_text', component: 'report_adeptus_insights'},\n            {key: 'js_yes_cancel', component: 'report_adeptus_insights'},\n            {key: 'js_upgrade_to', component: 'report_adeptus_insights'},\n            {key: 'js_downgrade_to', component: 'report_adeptus_insights'},\n            {key: 'js_choose_your_plan', component: 'report_adeptus_insights'},\n            {key: 'js_redirecting', component: 'report_adeptus_insights'},\n            {key: 'js_popup_blocked', component: 'report_adeptus_insights'},\n            {key: 'js_popup_blocked_text', component: 'report_adeptus_insights'},\n            {key: 'js_portal_creation_failed', component: 'report_adeptus_insights'},\n            {key: 'js_connection_error', component: 'report_adeptus_insights'},\n            {key: 'js_preparing_checkout', component: 'report_adeptus_insights'},\n            {key: 'js_redirecting_checkout', component: 'report_adeptus_insights'},\n            {key: 'js_upgrade_coming_soon', component: 'report_adeptus_insights'},\n            {key: 'js_billing_portal_error', component: 'report_adeptus_insights'},\n            {key: 'js_opening_billing_portal', component: 'report_adeptus_insights'},\n            {key: 'js_loading_plans', component: 'report_adeptus_insights'},\n            {key: 'js_continue', component: 'report_adeptus_insights'},\n            {key: 'error', component: 'report_adeptus_insights'},\n            {key: 'cancel', component: 'report_adeptus_insights'},\n            {key: 'js_ok', component: 'report_adeptus_insights'},\n            {key: 'js_plan_id_not_available', component: 'report_adeptus_insights'},\n            {key: 'js_failed_billing_portal', component: 'report_adeptus_insights'},\n            {key: 'js_failed_load_plans', component: 'report_adeptus_insights'},\n            {key: 'js_failed_open_billing', component: 'report_adeptus_insights'},\n            {key: 'js_failed_checkout', component: 'report_adeptus_insights'},\n            {key: 'js_payment_not_available', component: 'report_adeptus_insights'},\n            {key: 'js_checkout_error', component: 'report_adeptus_insights'},\n            {key: 'js_subscribe_to', component: 'report_adeptus_insights'},\n            {key: 'js_renew_subscription', component: 'report_adeptus_insights'},\n            {key: 'js_keep_subscription', component: 'report_adeptus_insights'},\n            {key: 'js_yes_cancel_subscription', component: 'report_adeptus_insights'},\n            {key: 'js_monthly', component: 'report_adeptus_insights'},\n            {key: 'js_annual', component: 'report_adeptus_insights'},\n            {key: 'js_current_plan', component: 'report_adeptus_insights'},\n            {key: 'js_most_popular', component: 'report_adeptus_insights'},\n            {key: 'js_free', component: 'report_adeptus_insights'},\n            {key: 'js_forever', component: 'report_adeptus_insights'},\n            {key: 'js_per_year', component: 'report_adeptus_insights'},\n            {key: 'js_per_month', component: 'report_adeptus_insights'},\n            {key: 'js_save_percent', component: 'report_adeptus_insights'},\n            {key: 'js_ai_tokens', component: 'report_adeptus_insights'},\n            {key: 'js_exports_mo', component: 'report_adeptus_insights'},\n            {key: 'js_saved_reports', component: 'report_adeptus_insights'},\n            {key: 'js_formats', component: 'report_adeptus_insights'},\n            {key: 'js_free_plan', component: 'report_adeptus_insights'},\n            {key: 'js_annual_plans_soon', component: 'report_adeptus_insights'},\n            {key: 'js_upgrade', component: 'report_adeptus_insights'},\n            {key: 'js_downgrade', component: 'report_adeptus_insights'},\n            {key: 'js_upgrade_redirect_text', component: 'report_adeptus_insights'},\n            {key: 'js_downgrade_redirect_text', component: 'report_adeptus_insights'},\n            {key: 'js_downgrade_features_text', component: 'report_adeptus_insights'},\n            {key: 'js_action_undone', component: 'report_adeptus_insights'},\n            {key: 'js_opening_billing_portal_new_window', component: 'report_adeptus_insights'},\n            {key: 'js_open_portal_manually', component: 'report_adeptus_insights'},\n            {key: 'js_current_subscription', component: 'report_adeptus_insights'},\n            {key: 'js_plan_label', component: 'report_adeptus_insights'},\n            {key: 'js_status_label', component: 'report_adeptus_insights'},\n            {key: 'js_cancelled_access_ends', component: 'report_adeptus_insights'},\n            {key: 'js_payment_failed_attempts', component: 'report_adeptus_insights'},\n            {key: 'js_next_billing', component: 'report_adeptus_insights'},\n            {key: 'js_api_access_disabled', component: 'report_adeptus_insights'},\n            {key: 'js_update_payment_restore', component: 'report_adeptus_insights'},\n            {key: 'js_subscription_cancelled_reactivate', component: 'report_adeptus_insights'},\n            {key: 'js_preparing_upgrade', component: 'report_adeptus_insights'},\n            {key: 'js_opening_billing', component: 'report_adeptus_insights'},\n            {key: 'js_online_payments_not_configured', component: 'report_adeptus_insights'},\n            {key: 'js_setting_up_payment', component: 'report_adeptus_insights'},\n            {key: 'js_redirect_complete_payment', component: 'report_adeptus_insights'},\n            {key: 'js_stripe_not_configured', component: 'report_adeptus_insights'},\n            {key: 'js_contact_admin', component: 'report_adeptus_insights'},\n            {key: 'js_redirect_complete_subscription', component: 'report_adeptus_insights'},\n            {key: 'js_welcome_back_renew', component: 'report_adeptus_insights'},\n            {key: 'js_not_now', component: 'report_adeptus_insights'},\n            {key: 'js_renew_now', component: 'report_adeptus_insights'}\n        ]).then(function(results) {\n            strings = {\n                verifying_payment: results[0],\n                verifying_payment_text: results[1],\n                upgrade_successful: results[2],\n                verification_issue: results[3],\n                verification_issue_text: results[4],\n                processing_payment: results[5],\n                processing_payment_text: results[6],\n                checkout_cancelled: results[7],\n                checkout_cancelled_text: results[8],\n                cancel_subscription_title: results[9],\n                cancel_subscription_text: results[10],\n                yes_cancel: results[11],\n                upgrade_to: results[12],\n                downgrade_to: results[13],\n                choose_your_plan: results[14],\n                redirecting: results[15],\n                popup_blocked: results[16],\n                popup_blocked_text: results[17],\n                portal_creation_failed: results[18],\n                connection_error: results[19],\n                preparing_checkout: results[20],\n                redirecting_checkout: results[21],\n                upgrade_coming_soon: results[22],\n                billing_portal_error: results[23],\n                opening_billing_portal: results[24],\n                loading_plans: results[25],\n                continue_text: results[26],\n                error: results[27],\n                cancel: results[28],\n                ok: results[29],\n                plan_id_not_available: results[30],\n                failed_billing_portal: results[31],\n                failed_load_plans: results[32],\n                failed_open_billing: results[33],\n                failed_checkout: results[34],\n                payment_not_available: results[35],\n                checkout_error: results[36],\n                subscribe_to: results[37],\n                renew_subscription: results[38],\n                keep_subscription: results[39],\n                yes_cancel_subscription: results[40],\n                monthly: results[41],\n                annual: results[42],\n                current_plan: results[43],\n                most_popular: results[44],\n                free: results[45],\n                forever: results[46],\n                per_year: results[47],\n                per_month: results[48],\n                save_percent: results[49],\n                ai_tokens: results[50],\n                exports_mo: results[51],\n                saved_reports: results[52],\n                formats: results[53],\n                free_plan: results[54],\n                annual_plans_soon: results[55],\n                upgrade: results[56],\n                downgrade: results[57],\n                upgrade_redirect_text: results[58],\n                downgrade_redirect_text: results[59],\n                downgrade_features_text: results[60],\n                action_undone: results[61],\n                opening_billing_portal_new_window: results[62],\n                open_portal_manually: results[63],\n                current_subscription: results[64],\n                plan_label: results[65],\n                status_label: results[66],\n                cancelled_access_ends: results[67],\n                payment_failed_attempts: results[68],\n                next_billing: results[69],\n                api_access_disabled: results[70],\n                update_payment_restore: results[71],\n                subscription_cancelled_reactivate: results[72],\n                preparing_upgrade: results[73],\n                opening_billing: results[74],\n                online_payments_not_configured: results[75],\n                setting_up_payment: results[76],\n                redirect_complete_payment: results[77],\n                stripe_not_configured: results[78],\n                contact_admin: results[79],\n                redirect_complete_subscription: results[80],\n                welcome_back_renew: results[81],\n                not_now: results[82],\n                renew_now: results[83]\n            };\n            return strings;\n        });\n    };\n\n    /**\n     * Get a loaded string, with fallback\n     * @param {string} key - The string key\n     * @param {string} fallback - Fallback value if string not loaded\n     * @returns {string} The string value\n     */\n    var getString = function(key, fallback) {\n        return strings[key] || fallback || key;\n    };\n\n    /**\n     * Subscription management for Adeptus Insights plugin\n     */\n    var Subscription = {\n        planId: 0,\n        subscriptionData: {},\n        /**\n         * Initialize subscription functionality\n         */\n        init: function() {\n            var self = this;\n            // Load strings first, then initialize\n            loadStrings().then(function() {\n                self._initAfterStrings();\n            }).catch(function() {\n                // Continue even if strings fail to load (fallbacks will be used)\n                self._initAfterStrings();\n            });\n        },\n\n        /**\n         * Continue initialization after strings are loaded\n         */\n        _initAfterStrings: function() {\n            // Initialize progress bar widths from data attributes\n            this.initProgressBars();\n\n            // Initialize event handlers\n            this.initEventHandlers();\n\n            // Check for checkout success in URL\n            this.checkForCheckoutSuccess();\n\n            // Initialize subscription display\n            this.updateSubscriptionDisplay();\n        },\n\n        /**\n         * Initialize progress bar widths from data-width attributes\n         */\n        initProgressBars: function() {\n            $('.adeptus-progress-fill[data-width]').each(function() {\n                var width = $(this).data('width') || 0;\n                $(this).css('width', width + '%');\n            });\n        },\n\n        /**\n         * Check if returning from Stripe Checkout and verify the session\n         */\n        checkForCheckoutSuccess: function() {\n            var urlParams = new URLSearchParams(window.location.search);\n            var checkoutStatus = urlParams.get('checkout');\n            var sessionId = urlParams.get('session_id');\n\n            if (checkoutStatus === 'success' && sessionId) {\n                // Show loading\n                Swal.fire({\n                    title: getString('verifying_payment', 'Verifying Payment...'),\n                    html: '<p>' + getString('verifying_payment_text', 'Please wait while we confirm your subscription upgrade.') + '</p>',\n                    allowOutsideClick: false,\n                    showConfirmButton: false,\n                    didOpen: function() {\n                        Swal.showLoading();\n                    }\n                });\n\n                // Call verification endpoint\n                Ajax.call([{\n                    methodname: 'report_adeptus_insights_verify_checkout_session',\n                    args: {\n                        session_id: sessionId,\n                        sesskey: M.cfg.sesskey\n                    },\n                    done: function(response) {\n                        if (response && response.success) {\n                            var planName = response.plan_name || 'Pro';\n                            Swal.fire({\n                                icon: 'success',\n                                title: getString('upgrade_successful', 'Upgrade Successful!'),\n                                html: '<p>' + getString('upgrade_successful_text', 'Your subscription has been upgraded to <strong>' + planName + '</strong>. Your new features are now available.').replace('{$a}', '<strong>' + planName + '</strong>') + '</p>',\n                                confirmButtonColor: '#2563eb',\n                                confirmButtonText: getString('continue_text', 'Continue')\n                            }).then(function() {\n                                // Clean URL and refresh to show new plan\n                                var cleanUrl = window.location.href.split('?')[0];\n                                window.location.href = cleanUrl;\n                            });\n                        } else {\n                            Swal.fire({\n                                icon: 'warning',\n                                title: getString('verification_issue', 'Verification Issue'),\n                                html: '<p>' + (response.message || 'Could not verify payment.') + '</p>' +\n                                      '<p>' + getString('verification_issue_text', 'If you completed payment, your subscription will be updated shortly.') + '</p>',\n                                confirmButtonColor: '#2563eb'\n                            });\n                        }\n                    },\n                    fail: function() {\n                        Swal.fire({\n                            icon: 'info',\n                            title: getString('processing_payment', 'Processing Payment'),\n                            html: '<p>' + getString('processing_payment_text', 'Your payment is being processed. Your subscription will be updated within a few minutes.') + '</p>',\n                            confirmButtonColor: '#2563eb'\n                        });\n                    }\n                }]);\n\n                // Clean URL to remove checkout params (without refresh)\n                var cleanUrl = window.location.href.split('?')[0];\n                window.history.replaceState({}, document.title, cleanUrl);\n\n            } else if (checkoutStatus === 'cancelled') {\n                Swal.fire({\n                    icon: 'info',\n                    title: getString('checkout_cancelled', 'Checkout Cancelled'),\n                    text: getString('checkout_cancelled_text', 'Your checkout was cancelled. No charges were made.'),\n                    confirmButtonColor: '#2563eb'\n                });\n\n                // Clean URL\n                var cancelUrl = window.location.href.split('?')[0];\n                window.history.replaceState({}, document.title, cancelUrl);\n            }\n        },\n\n        /**\n         * Initialize event handlers\n         */\n        initEventHandlers: function() {\n            // Handle upgrade plan button - redirects to wizard for plan selection\n            $(document).on('click', '.btn-upgrade-plan, #upgrade-plan', function(e) {\n                e.preventDefault();\n                Subscription.handleUpgradeFromFree();\n            });\n\n            // Handle downgrade plan buttons (for paid plan users via billing portal)\n            $(document).on('click', '.btn-downgrade-plan', function(e) {\n                e.preventDefault();\n                Subscription.handleDowngradePlan($(this));\n            });\n\n            // Handle cancel subscription buttons\n            $(document).on('click', '.btn-cancel-subscription, #cancel-subscription', function(e) {\n                e.preventDefault();\n                Subscription.handleCancelSubscription($(this));\n            });\n\n            // Handle billing portal access\n            $(document).on('click', '.btn-billing-portal', function(e) {\n                e.preventDefault();\n                Subscription.openBillingPortal();\n            });\n\n            // Handle modify subscription button\n            $(document).on('click', '.btn-modify-subscription, #modify-subscription', function(e) {\n                e.preventDefault();\n                Subscription.openBillingPortal();\n            });\n\n            // Handle view plans button (open billing portal)\n            $(document).on('click', '.btn-view-plans, #view-plans', function(e) {\n                e.preventDefault();\n                Subscription.openBillingPortal();\n            });\n\n            // Handle select plan button (new subscriptions)\n            $(document).on('click', '.select-plan-btn', function(e) {\n                e.preventDefault();\n                var planId = $(this).data('plan-id');\n                var planName = $(this).data('plan-name');\n                Subscription.handleSelectPlan($(this), planId, planName);\n            });\n\n            // Handle renew subscription button\n            $(document).on('click', '#renew-subscription', function(e) {\n                e.preventDefault();\n                Subscription.handleRenewSubscription();\n            });\n\n            // Handle update payment button\n            $(document).on('click', '#update-payment', function(e) {\n                e.preventDefault();\n                Subscription.openBillingPortal();\n            });\n        },\n\n        /**\n         * Handle upgrade plan\n         * @param $button\n         */\n        handleUpgradePlan: function($button) {\n            var planId = $button.data('plan-id');\n            var planName = $button.data('plan-name');\n\n            if (!planId) {\n                Swal.fire({\n                    icon: 'error',\n                    title: getString('error', 'Error'),\n                    text: getString('plan_id_not_available', 'Plan ID not available. Please try again.'),\n                    confirmButtonColor: '#3085d6'\n                });\n                return;\n            }\n\n            // Show confirmation dialog\n            Swal.fire({\n                icon: 'question',\n                title: getString('upgrade_to', 'Upgrade to {$a}?').replace('{$a}', planName),\n                html: '<p>' + getString('upgrade_redirect_text', 'You will be redirected to the billing portal to complete the upgrade.') + '</p>',\n                showCancelButton: true,\n                confirmButtonColor: '#f39c12',\n                cancelButtonColor: '#95a5a6',\n                confirmButtonText: '<i class=\"fa fa-arrow-up\"></i> ' + getString('upgrade', 'Upgrade'),\n                cancelButtonText: getString('cancel', 'Cancel')\n            }).then(function(result) {\n                if (result.isConfirmed) {\n                    Subscription.createBillingPortalSession(planId, 'upgrade');\n                }\n            });\n        },\n\n        /**\n         * Handle downgrade plan\n         * @param $button\n         */\n        handleDowngradePlan: function($button) {\n            var planId = $button.data('plan-id');\n            var planName = $button.data('plan-name');\n\n            if (!planId) {\n                Swal.fire({\n                    icon: 'error',\n                    title: getString('error', 'Error'),\n                    text: getString('plan_id_not_available', 'Plan ID not available. Please try again.'),\n                    confirmButtonColor: '#3085d6'\n                });\n                return;\n            }\n\n            // Show confirmation dialog\n            Swal.fire({\n                icon: 'warning',\n                title: getString('downgrade_to', 'Downgrade to {$a}?').replace('{$a}', planName),\n                html: '<p>' + getString('downgrade_redirect_text', 'You will be redirected to the billing portal to complete the downgrade.') + '</p>' +\n                      '<p class=\"text-muted\"><small>' + getString('downgrade_features_text', 'Your current plan features will remain active until the end of the billing period.') + '</small></p>',\n                showCancelButton: true,\n                confirmButtonColor: '#17a2b8',\n                cancelButtonColor: '#95a5a6',\n                confirmButtonText: '<i class=\"fa fa-arrow-down\"></i> ' + getString('downgrade', 'Downgrade'),\n                cancelButtonText: getString('cancel', 'Cancel')\n            }).then(function(result) {\n                if (result.isConfirmed) {\n                    Subscription.createBillingPortalSession(planId, 'downgrade');\n                }\n            });\n        },\n\n        /**\n         * Handle cancel subscription\n         */\n        handleCancelSubscription: function() {\n            Swal.fire({\n                icon: 'warning',\n                title: getString('cancel_subscription_title', 'Cancel Subscription?'),\n                html: '<p><strong>' + getString('cancel_subscription_text', 'Are you sure you want to cancel your subscription? You will lose access to premium features at the end of your billing period.') + '</strong></p>' +\n                      '<p class=\"text-danger\"><small>' + getString('action_undone', 'This action cannot be undone.') + '</small></p>',\n                showCancelButton: true,\n                confirmButtonColor: '#e74c3c',\n                cancelButtonColor: '#95a5a6',\n                confirmButtonText: '<i class=\"fa fa-times\"></i> ' + getString('yes_cancel', 'Yes, cancel it'),\n                cancelButtonText: getString('keep_subscription', 'Keep Subscription'),\n                focusCancel: true\n            }).then(function(result) {\n                if (result.isConfirmed) {\n                    Subscription.createBillingPortalSession(null, 'cancel');\n                }\n            });\n        },\n\n        /**\n         * Open billing portal\n         */\n        openBillingPortal: function() {\n            Subscription.createBillingPortalSession(Subscription.subscriptionData.plan_id, 'modify');\n        },\n\n        /**\n         * Create billing portal session\n         * @param planId\n         * @param action\n         */\n        createBillingPortalSession: function(planId, action) {\n            var returnUrl = window.location.href;\n            var data = {\n                return_url: returnUrl,\n                sesskey: M.cfg.sesskey\n            };\n\n            // Only add plan_id and action if they are defined and not null\n            if (planId && planId !== 'undefined' && planId !== null) {\n                data.plan_id = planId;\n            }\n\n            if (action && action !== 'undefined' && action !== null) {\n                data.action = action;\n            }\n\n            Ajax.call([{\n                methodname: 'report_adeptus_insights_create_billing_portal_session',\n                args: data,\n                done: function(response) {\n                    if (response && response.success && response.portal_url) {\n                        Swal.fire({\n                            icon: 'success',\n                            title: getString('redirecting', 'Redirecting...'),\n                            html: '<p>' + getString('opening_billing_portal_new_window', 'Opening billing portal in a new window...') + '</p>',\n                            timer: 2000,\n                            timerProgressBar: true,\n                            showConfirmButton: false,\n                            allowOutsideClick: false,\n                            didOpen: function() {\n                                Swal.showLoading();\n                            }\n                        });\n\n                        // Open in new tab\n                        setTimeout(function() {\n                            var newWindow = window.open(response.portal_url, '_blank');\n                            if (!newWindow || newWindow.closed || typeof newWindow.closed === 'undefined') {\n                                Swal.fire({\n                                    icon: 'warning',\n                                    title: getString('popup_blocked', 'Popup Blocked'),\n                                    html: '<p>' + getString('popup_blocked_text', 'Please allow popups for this site to access the billing portal.') + '</p>' +\n                                          '<p><a href=\"' + response.portal_url + '\" target=\"_blank\" class=\"btn btn-primary\">' + getString('open_portal_manually', 'Open Portal Manually') + '</a></p>',\n                                    showConfirmButton: true,\n                                    confirmButtonText: getString('ok', 'OK')\n                                });\n                            }\n                        }, 1000);\n                    } else {\n                        Swal.fire({\n                            icon: 'error',\n                            title: getString('portal_creation_failed', 'Portal Creation Failed'),\n                            text: (response && response.message) || getString('failed_billing_portal', 'Failed to create billing portal session. Please try again.'),\n                            confirmButtonColor: '#3085d6'\n                        });\n                    }\n                },\n                fail: function() {\n                    Swal.fire({\n                        icon: 'error',\n                        title: getString('connection_error', 'Connection Error'),\n                        text: getString('failed_billing_portal', 'Failed to create billing portal session. Please check your connection and try again.'),\n                        confirmButtonColor: '#3085d6'\n                    });\n                }\n            }]);\n        },\n\n        /**\n         * Update subscription display\n         */\n        updateSubscriptionDisplay: function() {\n            // Get current subscription data\n            Ajax.call([{\n                methodname: 'report_adeptus_insights_get_subscription_details',\n                args: {},\n                done: function(response) {\n                    if (response.success && response.data) {\n                        Subscription.subscriptionData = response.data;\n                        Subscription.renderSubscriptionInfo(response.data);\n                    }\n                },\n                fail: function() {\n                    // Subscription details fetch failed silently.\n                }\n            }]);\n        },\n\n        /**\n         * Render subscription information\n         * @param subscriptionData\n         */\n        renderSubscriptionInfo: function(subscriptionData) {\n            var $container = $('.subscription-info');\n            if (!$container.length) {\n return;\n}\n\n            var html = '<div class=\"current-subscription\">';\n            html += '<h3>' + getString('current_subscription', 'Current Subscription') + '</h3>';\n            html += '<div class=\"adeptus-subscription-details\">';\n            html += '<p><strong>' + getString('plan_label', 'Plan:') + '</strong> ' + (subscriptionData.plan_name || 'Unknown') + '</p>';\n\n            // Display status with appropriate styling and messaging\n            var statusClass = 'text-success';\n            var statusText = subscriptionData.status || 'Unknown';\n\n            if (subscriptionData.should_disable_api_access) {\n                statusClass = 'text-danger';\n            } else if (subscriptionData.is_cancelled) {\n                statusClass = 'text-warning';\n            } else if (subscriptionData.has_payment_issues) {\n                statusClass = 'text-warning';\n            }\n\n            html += '<p><strong>' + getString('status_label', 'Status:') + '</strong> <span class=\"' + statusClass + '\">' + statusText + '</span></p>';\n\n            // Display status message if available\n            if (subscriptionData.status_message) {\n                var messageClass = 'text-muted';\n                if (subscriptionData.should_disable_api_access) {\n                    messageClass = 'text-danger';\n                } else if (subscriptionData.is_cancelled || subscriptionData.has_payment_issues) {\n                    messageClass = 'text-warning';\n                }\n                html += '<p class=\"' + messageClass + '\"><small>' + subscriptionData.status_message + '</small></p>';\n            }\n\n            // Show cancellation info\n            if (subscriptionData.cancel_at_period_end) {\n                var cancelDate = new Date(subscriptionData.current_period_end * 1000);\n                html += '<p class=\"text-warning\"><strong>' + getString('cancelled_access_ends', 'Cancelled: Access ends on {$a}').replace('{$a}', cancelDate.toLocaleDateString()) + '</strong></p>';\n            }\n\n            // Show payment failure info\n            if (subscriptionData.failed_payment_attempts > 0) {\n                html += '<p class=\"text-danger\"><strong>' + getString('payment_failed_attempts', 'Payment Failed: {$a} failed attempts').replace('{$a}', subscriptionData.failed_payment_attempts) + '</strong></p>';\n            }\n\n            if (subscriptionData.current_period_end) {\n                var endDate = new Date(subscriptionData.current_period_end * 1000);\n                html += '<p><strong>' + getString('next_billing', 'Next billing:') + '</strong> ' + endDate.toLocaleDateString() + '</p>';\n            }\n\n            html += '</div>';\n            html += '</div>';\n\n            $container.html(html);\n\n            // Update API access status globally\n            Subscription.updateApiAccessStatus(subscriptionData);\n        },\n\n        /**\n         * Update API access status globally\n         * @param subscriptionData\n         */\n        updateApiAccessStatus: function(subscriptionData) {\n            var apiAccessDisabled = subscriptionData.should_disable_api_access || false;\n\n            // Store the status globally for other modules to check\n            if (typeof window !== 'undefined') {\n                window.adeptusApiAccessDisabled = apiAccessDisabled;\n                window.adeptusSubscriptionStatus = subscriptionData;\n            }\n\n            // Disable/enable API-dependent elements\n            if (apiAccessDisabled) {\n                $('.btn-send-message, .btn-generate-report, .btn-ai-assistant').prop('disabled', true)\n                    .attr('title', getString('api_access_disabled', 'API access disabled') + ': ' + (subscriptionData.status_message || ''));\n\n                // Show warning message\n                this.showApiAccessWarning(subscriptionData);\n            } else {\n                $('.btn-send-message, .btn-generate-report, .btn-ai-assistant').prop('disabled', false)\n                    .removeAttr('title');\n\n                // Hide warning message\n                this.hideApiAccessWarning();\n            }\n        },\n\n        /**\n         * Show API access warning\n         * @param subscriptionData\n         */\n        showApiAccessWarning: function(subscriptionData) {\n            var $existingWarning = $('.api-access-warning');\n            if ($existingWarning.length) {\n return;\n}\n\n            var warningHtml = '<div class=\"api-access-warning alert alert-danger alert-dismissible fade show\" role=\"alert\">';\n            warningHtml += '<strong>' + getString('api_access_disabled', 'API Access Disabled') + '</strong><br>';\n            warningHtml += subscriptionData.status_message || '';\n\n            if (subscriptionData.has_payment_issues) {\n                warningHtml += '<br><small>' + getString('update_payment_restore', 'Please update your payment method to restore access.') + '</small>';\n            } else if (subscriptionData.is_cancelled) {\n                warningHtml += '<br><small>' + getString('subscription_cancelled_reactivate', 'Your subscription has been cancelled. Please reactivate to restore access.') + '</small>';\n            }\n\n            warningHtml += '<button type=\"button\" class=\"btn-close\" data-bs-dismiss=\"alert\" aria-label=\"Close\"></button>';\n            warningHtml += '</div>';\n\n            $('body').prepend(warningHtml);\n        },\n\n        /**\n         * Hide API access warning\n         */\n        hideApiAccessWarning: function() {\n            $('.api-access-warning').remove();\n        },\n\n        /**\n         * Refresh subscription data\n         */\n        refresh: function() {\n            this.updateSubscriptionDisplay();\n        },\n\n        /**\n         * Stored plans data for toggle switching\n         */\n        plansData: null,\n        currentInterval: 'monthly',\n\n        /**\n         * Handle upgrade from free plan\n         * Shows a modal with available plans\n         */\n        handleUpgradeFromFree: function() {\n            // Show loading state\n            Swal.fire({\n                title: getString('loading_plans', 'Loading Plans...'),\n                html: '<div style=\"padding: 20px;\"><i class=\"fa fa-spinner fa-spin fa-2x\"></i></div>',\n                showConfirmButton: false,\n                allowOutsideClick: false\n            });\n\n            // Fetch available plans using external service\n            Ajax.call([{\n                methodname: 'report_adeptus_insights_get_available_plans',\n                args: {}\n            }])[0].done(function(result) {\n                var data = result.data ? result.data : result;\n                if (data.success && (data.monthly_plans.length > 0 || data.yearly_plans.length > 0)) {\n                    // Store plans data for toggle switching\n                    Subscription.plansData = {\n                        monthly: data.monthly_plans || [],\n                        yearly: data.yearly_plans || []\n                    };\n                    Subscription.currentInterval = 'monthly';\n                    Subscription.showPlansModal(data);\n                } else {\n                    Swal.fire({\n                        icon: 'error',\n                        title: getString('error', 'Error'),\n                        text: data.message || getString('failed_load_plans', 'Failed to load plans. Please try again.'),\n                        confirmButtonColor: '#3085d6'\n                    });\n                }\n            }).fail(function() {\n                Swal.fire({\n                    icon: 'error',\n                    title: getString('connection_error', 'Connection Error'),\n                    text: getString('failed_load_plans', 'Failed to load plans. Please check your connection and try again.'),\n                    confirmButtonColor: '#3085d6'\n                });\n            });\n        },\n\n        /**\n         * Show plans selection modal with monthly/yearly toggle\n         * @param data\n         */\n        showPlansModal: function(data) {\n            var hasYearlyPlans = data.has_yearly_plans || false;\n            var maxYearlySavings = data.max_yearly_savings || 0;\n\n            // Build modal HTML with toggle\n            var modalHtml = '<div class=\"adeptus-plans-modal-container\" style=\"text-align: left;\">';\n\n            // Billing toggle (only if yearly plans exist)\n            if (hasYearlyPlans) {\n                modalHtml += '<div class=\"adeptus-billing-toggle-container\" style=\"display: flex; justify-content: center; margin-bottom: 24px;\">';\n                modalHtml += '<div class=\"adeptus-billing-toggle\" style=\"display: inline-flex; align-items: center; background: #f3f4f6; border-radius: 50px; padding: 6px; gap: 4px;\">';\n                modalHtml += '<button type=\"button\" class=\"adeptus-billing-toggle-btn active\" data-interval=\"monthly\" style=\"' +\n                    'padding: 10px 24px; border: none; background: white; border-radius: 50px; ' +\n                    'font-weight: 600; font-size: 14px; cursor: pointer; color: #1f2937; ' +\n                    'box-shadow: 0 2px 8px rgba(0,0,0,0.1); transition: all 0.3s ease;\">' + getString('monthly', 'Monthly') + '</button>';\n                modalHtml += '<button type=\"button\" class=\"adeptus-billing-toggle-btn\" data-interval=\"yearly\" style=\"' +\n                    'padding: 10px 24px; border: none; background: transparent; border-radius: 50px; ' +\n                    'font-weight: 600; font-size: 14px; cursor: pointer; color: #6b7280; transition: all 0.3s ease;\">' +\n                    getString('annual', 'Annual');\n                if (maxYearlySavings > 0) {\n                    modalHtml += '<span style=\"background: linear-gradient(135deg, #10b981 0%, #059669 100%); ' +\n                        'color: white; font-size: 10px; font-weight: 700; padding: 2px 8px; border-radius: 20px; ' +\n                        'margin-left: 6px; text-transform: uppercase;\">' + getString('save_percent', 'Save {$a}%').replace('{$a}', maxYearlySavings) + '</span>';\n                }\n                modalHtml += '</button>';\n                modalHtml += '</div></div>';\n            }\n\n            // Plans grid container\n            modalHtml += '<div id=\"plans-grid-container\">';\n            modalHtml += Subscription.buildPlansGrid(data.monthly_plans || [], 'monthly');\n            modalHtml += '</div>';\n\n            modalHtml += '</div>';\n\n            Swal.fire({\n                title: '<i class=\"fa fa-rocket\" style=\"color: #2563eb;\"></i> ' + getString('choose_your_plan', 'Choose Your Plan'),\n                html: modalHtml,\n                width: '95%',\n                showCancelButton: true,\n                showConfirmButton: false,\n                cancelButtonText: getString('cancel', 'Cancel'),\n                cancelButtonColor: '#95a5a6',\n                customClass: {\n                    popup: 'plans-modal-popup'\n                },\n                didOpen: function() {\n                    Subscription.initPlansModalHandlers();\n                }\n            });\n        },\n\n        /**\n         * Build plans grid HTML\n         * @param plans\n         * @param interval\n         */\n        buildPlansGrid: function(plans, interval) {\n            if (!plans || plans.length === 0) {\n                return '<div style=\"text-align: center; padding: 40px; color: #6b7280;\">' +\n                    '<i class=\"fa fa-calendar-times-o fa-2x\" style=\"margin-bottom: 10px;\"></i>' +\n                    '<p>' + getString('annual_plans_soon', 'Annual plans coming soon!') + '</p></div>';\n            }\n\n            var html = '<div class=\"plans-grid\" style=\"display: grid; grid-template-columns: repeat(auto-fit, minmax(300px, 1fr)); gap: 24px; max-width: 1000px; margin: 0 auto;\">';\n\n            plans.forEach(function(plan) {\n                var borderColor = plan.is_current ? '#10b981' : (plan.is_popular ? '#2563eb' : '#e5e7eb');\n                var bgColor = plan.is_current ? 'linear-gradient(135deg, #f0fdf4 0%, #ecfdf5 100%)' : 'white';\n\n                html += '<div class=\"adeptus-plan-card\" style=\"' +\n                    'background: ' + bgColor + '; ' +\n                    'border: 2px solid ' + borderColor + '; ' +\n                    'border-radius: 16px; ' +\n                    'padding: 28px 24px; ' +\n                    'position: relative; ' +\n                    'transition: all 0.3s ease; ' +\n                    'display: flex; ' +\n                    'flex-direction: column;\">';\n\n                // Badge\n                if (plan.is_current) {\n                    html += '<div style=\"position: absolute; top: -12px; left: 50%; transform: translateX(-50%); ' +\n                        'background: linear-gradient(135deg, #10b981 0%, #059669 100%); color: white; ' +\n                        'font-size: 11px; font-weight: 700; padding: 5px 14px; border-radius: 20px; ' +\n                        'text-transform: uppercase; letter-spacing: 0.5px;\">' + getString('current_plan', 'Current Plan') + '</div>';\n                } else if (plan.is_popular) {\n                    html += '<div style=\"position: absolute; top: -12px; left: 50%; transform: translateX(-50%); ' +\n                        'background: linear-gradient(135deg, #2563eb 0%, #1d4ed8 100%); color: white; ' +\n                        'font-size: 11px; font-weight: 700; padding: 5px 14px; border-radius: 20px; ' +\n                        'text-transform: uppercase; letter-spacing: 0.5px;\">' + getString('most_popular', 'Most Popular') + '</div>';\n                }\n\n                // Header\n                html += '<div style=\"text-align: center; margin-bottom: 20px; padding-top: 8px;\">';\n                html += '<div style=\"font-size: 22px; font-weight: 700; color: #1f2937; margin-bottom: 8px;\">' +\n                    plan.short_name + '</div>';\n                if (plan.description) {\n                    html += '<div style=\"color: #6b7280; font-size: 13px; line-height: 1.5;\">' +\n                        plan.description + '</div>';\n                }\n                html += '</div>';\n\n                // Price\n                html += '<div style=\"text-align: center; margin-bottom: 24px; padding-bottom: 24px; border-bottom: 1px solid #e5e7eb;\">';\n                if (plan.is_free) {\n                    html += '<div style=\"font-size: 42px; font-weight: 800; color: #10b981;\">' + getString('free', 'Free') + '</div>';\n                    html += '<div style=\"color: #6b7280; font-size: 13px;\">' + getString('forever', 'Forever') + '</div>';\n                } else {\n                    html += '<div style=\"font-size: 42px; font-weight: 800; color: #1f2937;\">' +\n                        plan.price_formatted + '</div>';\n                    var periodText = interval === 'yearly' ? getString('per_year', 'per year') : getString('per_month', 'per month');\n                    html += '<div style=\"color: #6b7280; font-size: 13px;\">' + periodText + '</div>';\n                    if (plan.has_savings) {\n                        html += '<div style=\"margin-top: 6px;\"><span style=\"background: linear-gradient(135deg, #10b981 0%, #059669 100%); ' +\n                            'color: white; font-size: 11px; font-weight: 700; padding: 3px 10px; border-radius: 20px;\">' +\n                            getString('save_percent', 'Save {$a}%').replace('{$a}', plan.savings_percent) + '</span></div>';\n                    }\n                }\n                html += '</div>';\n\n                // Limits - 4 items in 2x2 grid\n                html += '<div style=\"display: grid; grid-template-columns: 1fr 1fr; gap: 12px; margin-bottom: 20px; padding-bottom: 20px; border-bottom: 1px solid #e5e7eb;\">';\n                html += '<div style=\"text-align: center; padding: 12px; background: #f9fafb; border-radius: 10px;\">' +\n                    '<div style=\"font-size: 16px; font-weight: 700; color: #1f2937;\">' + plan.tokens_limit + '</div>' +\n                    '<div style=\"font-size: 11px; color: #6b7280; text-transform: uppercase; letter-spacing: 0.5px;\">' + getString('ai_tokens', 'AI Tokens') + '</div></div>';\n                html += '<div style=\"text-align: center; padding: 12px; background: #f9fafb; border-radius: 10px;\">' +\n                    '<div style=\"font-size: 16px; font-weight: 700; color: #1f2937;\">' + plan.exports_limit + '</div>' +\n                    '<div style=\"font-size: 11px; color: #6b7280; text-transform: uppercase; letter-spacing: 0.5px;\">' + getString('exports_mo', 'Exports/mo') + '</div></div>';\n                html += '<div style=\"text-align: center; padding: 12px; background: #f9fafb; border-radius: 10px;\">' +\n                    '<div style=\"font-size: 16px; font-weight: 700; color: #1f2937;\">' + plan.reports_limit + '</div>' +\n                    '<div style=\"font-size: 11px; color: #6b7280; text-transform: uppercase; letter-spacing: 0.5px;\">' + getString('saved_reports', 'Saved Reports') + '</div></div>';\n                html += '<div style=\"text-align: center; padding: 12px; background: #f9fafb; border-radius: 10px;\">' +\n                    '<div style=\"font-size: 16px; font-weight: 700; color: #1f2937;\">' + plan.export_formats + '</div>' +\n                    '<div style=\"font-size: 11px; color: #6b7280; text-transform: uppercase; letter-spacing: 0.5px;\">' + getString('formats', 'Formats') + '</div></div>';\n                html += '</div>';\n\n                // Features list\n                if (plan.features && plan.features.length > 0) {\n                    html += '<div style=\"flex: 1; margin-bottom: 20px;\">';\n                    html += '<ul style=\"list-style: none; padding: 0; margin: 0;\">';\n                    plan.features.forEach(function(feature) {\n                        html += '<li style=\"display: flex; align-items: flex-start; gap: 10px; padding: 8px 0; ' +\n                            'color: #374151; font-size: 13px; line-height: 1.4;\">' +\n                            '<i class=\"fa fa-check\" style=\"color: #10b981; font-size: 12px; margin-top: 3px; flex-shrink: 0;\"></i> ' +\n                            feature + '</li>';\n                    });\n                    html += '</ul></div>';\n                }\n\n                // Action button\n                html += '<div style=\"margin-top: auto;\">';\n                if (plan.is_current) {\n                    html += '<button class=\"adeptus-plan-select-btn\" disabled style=\"' +\n                        'display: block; width: 100%; padding: 14px; border: none; border-radius: 10px; ' +\n                        'background: #e5e7eb; color: #6b7280; font-weight: 600; font-size: 14px; cursor: default;\">' +\n                        '<i class=\"fa fa-check-circle\"></i> ' + getString('current_plan', 'Current Plan') + '</button>';\n                } else if (plan.is_free) {\n                    html += '<button class=\"adeptus-plan-select-btn\" disabled style=\"' +\n                        'display: block; width: 100%; padding: 14px; border: 2px solid #e5e7eb; border-radius: 10px; ' +\n                        'background: white; color: #374151; font-weight: 600; font-size: 14px; cursor: default;\">' +\n                        getString('free_plan', 'Free Plan') + '</button>';\n                } else {\n                    // Include stripe_price_id if available for checkout\n                    var stripePriceId = plan.stripe_price_id || '';\n                    var stripeConfigured = plan.stripe_configured || false;\n                    html += '<button class=\"adeptus-plan-select-btn\" data-plan-id=\"' + (plan.id || '') + '\" ' +\n                        'data-plan-name=\"' + plan.short_name + '\" ' +\n                        'data-stripe-price-id=\"' + stripePriceId + '\" ' +\n                        'data-stripe-configured=\"' + stripeConfigured + '\" style=\"' +\n                        'display: block; width: 100%; padding: 14px; border: none; border-radius: 10px; ' +\n                        'background: linear-gradient(135deg, #2563eb 0%, #1d4ed8 100%); color: white; ' +\n                        'font-weight: 600; font-size: 14px; cursor: pointer; transition: all 0.3s ease;\">' +\n                        '<i class=\"fa fa-arrow-up\"></i> ' + getString('upgrade_to', 'Upgrade to') + ' ' + plan.short_name + '</button>';\n                }\n                html += '</div>';\n\n                html += '</div>'; // End adeptus-plan-card\n            });\n\n            html += '</div>'; // End plans-grid\n            return html;\n        },\n\n        /**\n         * Initialize plans modal event handlers\n         */\n        initPlansModalHandlers: function() {\n            // Billing toggle handler\n            document.querySelectorAll('.adeptus-billing-toggle-btn').forEach(function(btn) {\n                btn.addEventListener('click', function() {\n                    var interval = this.getAttribute('data-interval');\n                    if (interval === Subscription.currentInterval) {\n return;\n}\n\n                    // Update toggle UI\n                    document.querySelectorAll('.adeptus-billing-toggle-btn').forEach(function(b) {\n                        b.classList.remove('active');\n                        b.style.background = 'transparent';\n                        b.style.color = '#6b7280';\n                        b.style.boxShadow = 'none';\n                    });\n                    this.classList.add('active');\n                    this.style.background = 'white';\n                    this.style.color = '#1f2937';\n                    this.style.boxShadow = '0 2px 8px rgba(0,0,0,0.1)';\n\n                    Subscription.currentInterval = interval;\n\n                    // Update plans display\n                    var plans = Subscription.plansData[interval] || [];\n                    var container = document.getElementById('plans-grid-container');\n                    if (container) {\n                        container.innerHTML = Subscription.buildPlansGrid(plans, interval);\n                        Subscription.initPlanButtonHandlers();\n                    }\n                });\n            });\n\n            // Initialize plan button handlers\n            Subscription.initPlanButtonHandlers();\n        },\n\n        /**\n         * Initialize plan button click handlers\n         */\n        initPlanButtonHandlers: function() {\n            document.querySelectorAll('.adeptus-plan-select-btn:not([disabled])').forEach(function(btn) {\n                btn.addEventListener('click', function() {\n                    var planName = this.getAttribute('data-plan-name');\n                    var planId = this.getAttribute('data-plan-id');\n                    var stripePriceId = this.getAttribute('data-stripe-price-id');\n                    var stripeConfigured = this.getAttribute('data-stripe-configured') === 'true';\n\n                    // If Stripe is configured for this plan, use checkout session\n                    if (stripeConfigured && stripePriceId) {\n                        Subscription.createCheckoutSession(planId, stripePriceId, planName);\n                    } else {\n                        // Fallback to billing portal or show \"coming soon\" message\n                        Subscription.openBillingPortalForUpgrade(planName, planId);\n                    }\n                });\n\n                // Hover effects\n                btn.addEventListener('mouseenter', function() {\n                    this.style.transform = 'translateY(-2px)';\n                    this.style.boxShadow = '0 8px 20px rgba(37, 99, 235, 0.3)';\n                });\n                btn.addEventListener('mouseleave', function() {\n                    this.style.transform = 'translateY(0)';\n                    this.style.boxShadow = 'none';\n                });\n            });\n        },\n\n        /**\n         * Open billing portal for upgrade\n         * Uses the same approach as Step 2 - opens billing portal where user can select plan\n         * @param planName\n         * @param planId\n         */\n        openBillingPortalForUpgrade: function(planName, planId) {\n            Swal.fire({\n                title: getString('opening_billing_portal', 'Opening Billing Portal...'),\n                html: '<p>' + getString('preparing_upgrade', 'Preparing upgrade to {$a}...').replace('{$a}', planName) + '</p>',\n                allowOutsideClick: false,\n                showConfirmButton: false,\n                didOpen: function() {\n                    Swal.showLoading();\n                }\n            });\n\n            var returnUrl = window.location.href;\n            var args = {\n                return_url: returnUrl,\n                sesskey: M.cfg.sesskey\n            };\n\n            // Pass plan_id if available (needed for customer creation)\n            if (planId) {\n                args.plan_id = planId;\n            }\n\n            Ajax.call([{\n                methodname: 'report_adeptus_insights_create_billing_portal_session',\n                args: args,\n                done: function(response) {\n                    if (response && response.success && response.portal_url) {\n                        Swal.fire({\n                            icon: 'success',\n                            title: getString('redirecting', 'Redirecting...'),\n                            html: '<p>' + getString('opening_billing', 'Opening billing portal...') + '</p>',\n                            timer: 2000,\n                            timerProgressBar: true,\n                            showConfirmButton: false,\n                            allowOutsideClick: false\n                        });\n\n                        setTimeout(function() {\n                            // Redirect in same window (like Step 2 does)\n                            window.location.href = response.portal_url;\n                        }, 1000);\n                    } else {\n                        var errorMessage = (response && response.message) || getString('failed_open_billing', 'Failed to open billing portal.');\n\n                        // Check for specific error codes and provide helpful messages\n                        if (errorMessage.indexOf('NO_STRIPE_CUSTOMER') !== -1 ||\n                            errorMessage.indexOf('payment_enabled') !== -1 ||\n                            errorMessage.indexOf('Stripe') !== -1) {\n                            Swal.fire({\n                                icon: 'info',\n                                title: getString('upgrade_coming_soon', 'Upgrade Coming Soon'),\n                                html: '<p>' + getString('online_payments_not_configured', 'Online payments are not yet configured for this installation.') + '</p>' +\n                                      '<p>' + getString('contact_admin', 'To upgrade to <strong>{$a}</strong>, please contact your administrator or email:').replace('{$a}', planName) + '</p>' +\n                                      '<p><a href=\"mailto:support@adeptus360.com?subject=Upgrade%20to%20' + planName + '\">support@adeptus360.com</a></p>',\n                                confirmButtonColor: '#2563eb',\n                                confirmButtonText: getString('ok', 'OK')\n                            });\n                        } else {\n                            Swal.fire({\n                                icon: 'error',\n                                title: getString('billing_portal_error', 'Billing Portal Error'),\n                                text: errorMessage,\n                                confirmButtonColor: '#3085d6'\n                            });\n                        }\n                    }\n                },\n                fail: function() {\n                    Swal.fire({\n                        icon: 'error',\n                        title: getString('connection_error', 'Connection Error'),\n                        text: getString('failed_open_billing', 'Failed to open billing portal. Please try again.'),\n                        confirmButtonColor: '#3085d6'\n                    });\n                }\n            }]);\n        },\n\n        /**\n         * Create Stripe Checkout session for new subscriptions\n         * @param {string} planId - The plan ID\n         * @param {string} stripePriceId - The Stripe price ID\n         * @param {string} planName - The plan name for display\n         */\n        createCheckoutSession: function(planId, stripePriceId, planName) {\n            Swal.fire({\n                title: getString('preparing_checkout', 'Preparing Checkout...'),\n                html: '<p>' + getString('setting_up_payment', 'Setting up payment for {$a}...').replace('{$a}', planName) + '</p>',\n                allowOutsideClick: false,\n                showConfirmButton: false,\n                didOpen: function() {\n                    Swal.showLoading();\n                }\n            });\n\n            var returnUrl = window.location.href;\n            var args = {\n                plan_id: parseInt(planId),\n                stripe_price_id: stripePriceId,\n                return_url: returnUrl,\n                sesskey: M.cfg.sesskey\n            };\n\n            Ajax.call([{\n                methodname: 'report_adeptus_insights_create_checkout_session',\n                args: args,\n                done: function(response) {\n                    if (response && response.success && response.checkout_url) {\n                        Swal.fire({\n                            icon: 'success',\n                            title: getString('redirecting_checkout', 'Redirecting to Checkout...'),\n                            html: '<p>' + getString('redirect_complete_payment', 'You will be redirected to complete your payment.') + '</p>',\n                            timer: 2000,\n                            timerProgressBar: true,\n                            showConfirmButton: false,\n                            allowOutsideClick: false\n                        });\n\n                        setTimeout(function() {\n                            window.location.href = response.checkout_url;\n                        }, 1000);\n                    } else {\n                        var errorMessage = (response && response.message) || getString('failed_checkout', 'Failed to create checkout session.');\n                        var errorCode = (response && response.error_code) || '';\n\n                        // Handle specific error codes\n                        if (errorCode === 'STRIPE_NOT_CONFIGURED') {\n                            Swal.fire({\n                                icon: 'info',\n                                title: getString('payment_not_available', 'Payment Not Available'),\n                                html: '<p>' + getString('stripe_not_configured', 'Stripe is not yet configured for the <strong>{$a}</strong> plan.').replace('{$a}', planName) + '</p>' +\n                                      '<p>' + getString('contact_admin', 'Please contact your administrator or email:') + '</p>' +\n                                      '<p><a href=\"mailto:support@adeptus360.com?subject=Upgrade%20to%20' + planName + '\">support@adeptus360.com</a></p>',\n                                confirmButtonColor: '#2563eb',\n                                confirmButtonText: getString('ok', 'OK')\n                            });\n                        } else {\n                            Swal.fire({\n                                icon: 'error',\n                                title: getString('checkout_error', 'Checkout Error'),\n                                text: errorMessage,\n                                confirmButtonColor: '#3085d6'\n                            });\n                        }\n                    }\n                },\n                fail: function() {\n                    Swal.fire({\n                        icon: 'error',\n                        title: getString('connection_error', 'Connection Error'),\n                        text: getString('failed_checkout', 'Failed to create checkout session. Please try again.'),\n                        confirmButtonColor: '#3085d6'\n                    });\n                }\n            }]);\n        },\n\n        /**\n         * Handle select plan (for new subscriptions)\n         * @param $button\n         * @param planId\n         * @param planName\n         */\n        handleSelectPlan: function($button, planId, planName) {\n            if (!planId) {\n                Swal.fire({\n                    icon: 'error',\n                    title: getString('error', 'Error'),\n                    text: getString('plan_id_not_available', 'Plan ID not available. Please try again.'),\n                    confirmButtonColor: '#3085d6'\n                });\n                return;\n            }\n\n            // Show confirmation dialog\n            Swal.fire({\n                icon: 'info',\n                title: getString('subscribe_to', 'Subscribe to {$a}?').replace('{$a}', planName),\n                html: '<p>' + getString('redirect_complete_subscription', 'You will be redirected to complete your subscription.') + '</p>',\n                showCancelButton: true,\n                confirmButtonColor: '#3498db',\n                cancelButtonColor: '#95a5a6',\n                confirmButtonText: '<i class=\"fa fa-credit-card\"></i> ' + getString('subscribe_to', 'Subscribe Now'),\n                cancelButtonText: getString('cancel', 'Cancel')\n            }).then(function(result) {\n                if (result.isConfirmed) {\n                    Subscription.createBillingPortalSession(planId, 'subscribe');\n                }\n            });\n        },\n\n        /**\n         * Handle renew subscription\n         */\n        handleRenewSubscription: function() {\n            Swal.fire({\n                icon: 'success',\n                title: getString('renew_subscription', 'Renew Your Subscription?'),\n                html: '<p>' + getString('welcome_back_renew', 'Welcome back! Renew your subscription to regain access to all premium features.') + '</p>',\n                showCancelButton: true,\n                confirmButtonColor: '#27ae60',\n                cancelButtonColor: '#95a5a6',\n                confirmButtonText: '<i class=\"fa fa-refresh\"></i> ' + getString('renew_now', 'Renew Subscription'),\n                cancelButtonText: getString('not_now', 'Not Now')\n            }).then(function(result) {\n                if (result.isConfirmed) {\n                    // Open billing portal for renewal\n                    Subscription.createBillingPortalSession(null, 'renew');\n                }\n            });\n        }\n    };\n\n    return Subscription;\n});\n"],"names":["define","$","Ajax","Notification","Str","Swal","window","strings","getString","key","fallback","Subscription","planId","subscriptionData","init","self","this","get_strings","component","then","results","verifying_payment","verifying_payment_text","upgrade_successful","verification_issue","verification_issue_text","processing_payment","processing_payment_text","checkout_cancelled","checkout_cancelled_text","cancel_subscription_title","cancel_subscription_text","yes_cancel","upgrade_to","downgrade_to","choose_your_plan","redirecting","popup_blocked","popup_blocked_text","portal_creation_failed","connection_error","preparing_checkout","redirecting_checkout","upgrade_coming_soon","billing_portal_error","opening_billing_portal","loading_plans","continue_text","error","cancel","ok","plan_id_not_available","failed_billing_portal","failed_load_plans","failed_open_billing","failed_checkout","payment_not_available","checkout_error","subscribe_to","renew_subscription","keep_subscription","yes_cancel_subscription","monthly","annual","current_plan","most_popular","free","forever","per_year","per_month","save_percent","ai_tokens","exports_mo","saved_reports","formats","free_plan","annual_plans_soon","upgrade","downgrade","upgrade_redirect_text","downgrade_redirect_text","downgrade_features_text","action_undone","opening_billing_portal_new_window","open_portal_manually","current_subscription","plan_label","status_label","cancelled_access_ends","payment_failed_attempts","next_billing","api_access_disabled","update_payment_restore","subscription_cancelled_reactivate","preparing_upgrade","opening_billing","online_payments_not_configured","setting_up_payment","redirect_complete_payment","stripe_not_configured","contact_admin","redirect_complete_subscription","welcome_back_renew","not_now","renew_now","_initAfterStrings","catch","initProgressBars","initEventHandlers","checkForCheckoutSuccess","updateSubscriptionDisplay","each","width","data","css","urlParams","URLSearchParams","location","search","checkoutStatus","get","sessionId","fire","title","html","allowOutsideClick","showConfirmButton","didOpen","showLoading","call","methodname","args","session_id","sesskey","M","cfg","done","response","success","planName","plan_name","icon","replace","confirmButtonColor","confirmButtonText","cleanUrl","href","split","message","fail","history","replaceState","document","text","cancelUrl","on","e","preventDefault","handleUpgradeFromFree","handleDowngradePlan","handleCancelSubscription","openBillingPortal","handleSelectPlan","handleRenewSubscription","handleUpgradePlan","$button","showCancelButton","cancelButtonColor","cancelButtonText","result","isConfirmed","createBillingPortalSession","focusCancel","plan_id","action","return_url","portal_url","timer","timerProgressBar","setTimeout","newWindow","open","closed","renderSubscriptionInfo","$container","length","statusClass","statusText","status","should_disable_api_access","is_cancelled","has_payment_issues","status_message","messageClass","cancel_at_period_end","cancelDate","Date","current_period_end","toLocaleDateString","failed_payment_attempts","endDate","updateApiAccessStatus","apiAccessDisabled","adeptusApiAccessDisabled","adeptusSubscriptionStatus","prop","attr","showApiAccessWarning","removeAttr","hideApiAccessWarning","warningHtml","prepend","remove","refresh","plansData","currentInterval","monthly_plans","yearly_plans","yearly","showPlansModal","hasYearlyPlans","has_yearly_plans","maxYearlySavings","max_yearly_savings","modalHtml","buildPlansGrid","customClass","popup","initPlansModalHandlers","plans","interval","forEach","plan","borderColor","is_current","is_popular","bgColor","short_name","description","is_free","price_formatted","periodText","has_savings","savings_percent","tokens_limit","exports_limit","reports_limit","export_formats","features","feature","stripePriceId","stripe_price_id","stripeConfigured","stripe_configured","id","querySelectorAll","btn","addEventListener","getAttribute","b","classList","style","background","color","boxShadow","add","container","getElementById","innerHTML","initPlanButtonHandlers","createCheckoutSession","openBillingPortalForUpgrade","transform","errorMessage","indexOf","returnUrl","parseInt","checkout_url","error_code"],"mappings":"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"}