{"version":3,"file":"subscription.min.js","sources":["../src/subscription.js"],"sourcesContent":["// jshint ignore:start\ndefine(['jquery', 'core/ajax', 'core/notification', 'core/str'], function($, Ajax, Notification, Str) {\n    'use strict';\n\n    var Swal = window.Swal;\n\n    // Language strings storage\n    var strings = {};\n\n    /**\n     * Load all language strings needed for the module\n     * @returns {Promise} Promise that resolves when strings are loaded\n     */\n    var loadStrings = function() {\n        return Str.get_strings([\n            {key: 'js_verifying_payment', component: 'report_adeptus_insights'},\n            {key: 'js_verifying_payment_text', component: 'report_adeptus_insights'},\n            {key: 'js_upgrade_successful', component: 'report_adeptus_insights'},\n            {key: 'js_verification_issue', component: 'report_adeptus_insights'},\n            {key: 'js_verification_issue_text', component: 'report_adeptus_insights'},\n            {key: 'js_processing_payment', component: 'report_adeptus_insights'},\n            {key: 'js_processing_payment_text', component: 'report_adeptus_insights'},\n            {key: 'js_checkout_cancelled', component: 'report_adeptus_insights'},\n            {key: 'js_checkout_cancelled_text', component: 'report_adeptus_insights'},\n            {key: 'js_cancel_subscription_title', component: 'report_adeptus_insights'},\n            {key: 'js_cancel_subscription_text', component: 'report_adeptus_insights'},\n            {key: 'js_yes_cancel', component: 'report_adeptus_insights'},\n            {key: 'js_upgrade_to', component: 'report_adeptus_insights'},\n            {key: 'js_downgrade_to', component: 'report_adeptus_insights'},\n            {key: 'js_choose_your_plan', component: 'report_adeptus_insights'},\n            {key: 'js_redirecting', component: 'report_adeptus_insights'},\n            {key: 'js_popup_blocked', component: 'report_adeptus_insights'},\n            {key: 'js_popup_blocked_text', component: 'report_adeptus_insights'},\n            {key: 'js_portal_creation_failed', component: 'report_adeptus_insights'},\n            {key: 'js_connection_error', component: 'report_adeptus_insights'},\n            {key: 'js_preparing_checkout', component: 'report_adeptus_insights'},\n            {key: 'js_redirecting_checkout', component: 'report_adeptus_insights'},\n            {key: 'js_upgrade_coming_soon', component: 'report_adeptus_insights'},\n            {key: 'js_billing_portal_error', component: 'report_adeptus_insights'},\n            {key: 'js_opening_billing_portal', component: 'report_adeptus_insights'},\n            {key: 'js_loading_plans', component: 'report_adeptus_insights'},\n            {key: 'js_continue', component: 'report_adeptus_insights'},\n            {key: 'error', component: 'report_adeptus_insights'},\n            {key: 'cancel', component: 'report_adeptus_insights'},\n            {key: 'js_ok', component: 'report_adeptus_insights'},\n            {key: 'js_plan_id_not_available', component: 'report_adeptus_insights'},\n            {key: 'js_failed_billing_portal', component: 'report_adeptus_insights'},\n            {key: 'js_failed_load_plans', component: 'report_adeptus_insights'},\n            {key: 'js_failed_open_billing', component: 'report_adeptus_insights'},\n            {key: 'js_failed_checkout', component: 'report_adeptus_insights'},\n            {key: 'js_payment_not_available', component: 'report_adeptus_insights'},\n            {key: 'js_checkout_error', component: 'report_adeptus_insights'},\n            {key: 'js_subscribe_to', component: 'report_adeptus_insights'},\n            {key: 'js_renew_subscription', component: 'report_adeptus_insights'},\n            {key: 'js_keep_subscription', component: 'report_adeptus_insights'},\n            {key: 'js_yes_cancel_subscription', component: 'report_adeptus_insights'}\n        ]).then(function(results) {\n            strings = {\n                verifying_payment: results[0],\n                verifying_payment_text: results[1],\n                upgrade_successful: results[2],\n                verification_issue: results[3],\n                verification_issue_text: results[4],\n                processing_payment: results[5],\n                processing_payment_text: results[6],\n                checkout_cancelled: results[7],\n                checkout_cancelled_text: results[8],\n                cancel_subscription_title: results[9],\n                cancel_subscription_text: results[10],\n                yes_cancel: results[11],\n                upgrade_to: results[12],\n                downgrade_to: results[13],\n                choose_your_plan: results[14],\n                redirecting: results[15],\n                popup_blocked: results[16],\n                popup_blocked_text: results[17],\n                portal_creation_failed: results[18],\n                connection_error: results[19],\n                preparing_checkout: results[20],\n                redirecting_checkout: results[21],\n                upgrade_coming_soon: results[22],\n                billing_portal_error: results[23],\n                opening_billing_portal: results[24],\n                loading_plans: results[25],\n                continue_text: results[26],\n                error: results[27],\n                cancel: results[28],\n                ok: results[29],\n                plan_id_not_available: results[30],\n                failed_billing_portal: results[31],\n                failed_load_plans: results[32],\n                failed_open_billing: results[33],\n                failed_checkout: results[34],\n                payment_not_available: results[35],\n                checkout_error: results[36],\n                subscribe_to: results[37],\n                renew_subscription: results[38],\n                keep_subscription: results[39],\n                yes_cancel_subscription: results[40]\n            };\n            return strings;\n        });\n    };\n\n    /**\n     * Get a loaded string, with fallback\n     * @param {string} key - The string key\n     * @param {string} fallback - Fallback value if string not loaded\n     * @returns {string} The string value\n     */\n    var getString = function(key, fallback) {\n        return strings[key] || fallback || key;\n    };\n\n    /**\n     * Subscription management for Adeptus Insights plugin\n     */\n    var Subscription = {\n        planId: 0,\n        subscriptionData: {},\n        /**\n         * Initialize subscription functionality\n         */\n        init: function() {\n            var self = this;\n            // Load strings first, then initialize\n            loadStrings().then(function() {\n                self._initAfterStrings();\n            }).catch(function() {\n                // Continue even if strings fail to load (fallbacks will be used)\n                self._initAfterStrings();\n            });\n        },\n\n        /**\n         * Continue initialization after strings are loaded\n         */\n        _initAfterStrings: function() {\n            // Initialize event handlers\n            this.initEventHandlers();\n\n            // Check for checkout success in URL\n            this.checkForCheckoutSuccess();\n\n            // Initialize subscription display\n            this.updateSubscriptionDisplay();\n        },\n\n        /**\n         * Check if returning from Stripe Checkout and verify the session\n         */\n        checkForCheckoutSuccess: function() {\n            var urlParams = new URLSearchParams(window.location.search);\n            var checkoutStatus = urlParams.get('checkout');\n            var sessionId = urlParams.get('session_id');\n\n            if (checkoutStatus === 'success' && sessionId) {\n                // Show loading\n                Swal.fire({\n                    title: getString('verifying_payment', 'Verifying Payment...'),\n                    html: '<p>' + getString('verifying_payment_text', 'Please wait while we confirm your subscription upgrade.') + '</p>',\n                    allowOutsideClick: false,\n                    showConfirmButton: false,\n                    didOpen: function() {\n                        Swal.showLoading();\n                    }\n                });\n\n                // Call verification endpoint\n                Ajax.call([{\n                    methodname: 'report_adeptus_insights_verify_checkout_session',\n                    args: {\n                        session_id: sessionId,\n                        sesskey: M.cfg.sesskey\n                    },\n                    done: function(response) {\n                        if (response && response.success) {\n                            var planName = response.plan_name || 'Pro';\n                            Swal.fire({\n                                icon: 'success',\n                                title: getString('upgrade_successful', 'Upgrade Successful!'),\n                                html: '<p>' + getString('upgrade_successful_text', 'Your subscription has been upgraded to <strong>' + planName + '</strong>. Your new features are now available.').replace('{$a}', '<strong>' + planName + '</strong>') + '</p>',\n                                confirmButtonColor: '#2563eb',\n                                confirmButtonText: getString('continue_text', 'Continue')\n                            }).then(function() {\n                                // Clean URL and refresh to show new plan\n                                var cleanUrl = window.location.href.split('?')[0];\n                                window.location.href = cleanUrl;\n                            });\n                        } else {\n                            Swal.fire({\n                                icon: 'warning',\n                                title: getString('verification_issue', 'Verification Issue'),\n                                html: '<p>' + (response.message || 'Could not verify payment.') + '</p>' +\n                                      '<p>' + getString('verification_issue_text', 'If you completed payment, your subscription will be updated shortly.') + '</p>',\n                                confirmButtonColor: '#2563eb'\n                            });\n                        }\n                    },\n                    fail: function(error) {\n                        Swal.fire({\n                            icon: 'info',\n                            title: getString('processing_payment', 'Processing Payment'),\n                            html: '<p>' + getString('processing_payment_text', 'Your payment is being processed. Your subscription will be updated within a few minutes.') + '</p>',\n                            confirmButtonColor: '#2563eb'\n                        });\n                    }\n                }]);\n\n                // Clean URL to remove checkout params (without refresh)\n                var cleanUrl = window.location.href.split('?')[0];\n                window.history.replaceState({}, document.title, cleanUrl);\n\n            } else if (checkoutStatus === 'cancelled') {\n                Swal.fire({\n                    icon: 'info',\n                    title: getString('checkout_cancelled', 'Checkout Cancelled'),\n                    text: getString('checkout_cancelled_text', 'Your checkout was cancelled. No charges were made.'),\n                    confirmButtonColor: '#2563eb'\n                });\n\n                // Clean URL\n                var cancelUrl = window.location.href.split('?')[0];\n                window.history.replaceState({}, document.title, cancelUrl);\n            }\n        },\n\n        /**\n         * Initialize event handlers\n         */\n        initEventHandlers: function() {\n            // Handle upgrade plan button - redirects to wizard for plan selection\n            $(document).on('click', '.btn-upgrade-plan, #upgrade-plan', function(e) {\n                e.preventDefault();\n                Subscription.handleUpgradeFromFree();\n            });\n\n            // Handle downgrade plan buttons (for paid plan users via billing portal)\n            $(document).on('click', '.btn-downgrade-plan', function(e) {\n                e.preventDefault();\n                Subscription.handleDowngradePlan($(this));\n            });\n\n            // Handle cancel subscription buttons\n            $(document).on('click', '.btn-cancel-subscription, #cancel-subscription', function(e) {\n                e.preventDefault();\n                Subscription.handleCancelSubscription($(this));\n            });\n\n            // Handle billing portal access\n            $(document).on('click', '.btn-billing-portal', function(e) {\n                e.preventDefault();\n                Subscription.openBillingPortal();\n            });\n\n            // Handle modify subscription button\n            $(document).on('click', '.btn-modify-subscription, #modify-subscription', function(e) {\n                e.preventDefault();\n                Subscription.openBillingPortal();\n            });\n\n            // Handle view plans button (open billing portal)\n            $(document).on('click', '.btn-view-plans, #view-plans', function(e) {\n                e.preventDefault();\n                Subscription.openBillingPortal();\n            });\n\n            // Handle select plan button (new subscriptions)\n            $(document).on('click', '.select-plan-btn', function(e) {\n                e.preventDefault();\n                var planId = $(this).data('plan-id');\n                var planName = $(this).data('plan-name');\n                Subscription.handleSelectPlan($(this), planId, planName);\n            });\n\n            // Handle renew subscription button\n            $(document).on('click', '#renew-subscription', function(e) {\n                e.preventDefault();\n                Subscription.handleRenewSubscription();\n            });\n\n            // Handle update payment button\n            $(document).on('click', '#update-payment', function(e) {\n                e.preventDefault();\n                Subscription.openBillingPortal();\n            });\n        },\n\n        /**\n         * Handle upgrade plan\n         */\n        handleUpgradePlan: function($button) {\n            var planId = $button.data('plan-id');\n            var planName = $button.data('plan-name');\n\n            if (!planId) {\n                Swal.fire({\n                    icon: 'error',\n                    title: getString('error', 'Error'),\n                    text: getString('plan_id_not_available', 'Plan ID not available. Please try again.'),\n                    confirmButtonColor: '#3085d6'\n                });\n                return;\n            }\n\n            // Show confirmation dialog\n            Swal.fire({\n                icon: 'question',\n                title: getString('upgrade_to', 'Upgrade to ' + planName + '?').replace('{$a}', planName),\n                html: '<p>You will be redirected to the billing portal to complete the upgrade.</p>',\n                showCancelButton: true,\n                confirmButtonColor: '#f39c12',\n                cancelButtonColor: '#95a5a6',\n                confirmButtonText: '<i class=\"fa fa-arrow-up\"></i> Upgrade',\n                cancelButtonText: getString('cancel', 'Cancel')\n            }).then(function(result) {\n                if (result.isConfirmed) {\n                    Subscription.createBillingPortalSession(planId, 'upgrade');\n                }\n            });\n        },\n\n        /**\n         * Handle downgrade plan\n         */\n        handleDowngradePlan: function($button) {\n            var planId = $button.data('plan-id');\n            var planName = $button.data('plan-name');\n\n            if (!planId) {\n                Swal.fire({\n                    icon: 'error',\n                    title: getString('error', 'Error'),\n                    text: getString('plan_id_not_available', 'Plan ID not available. Please try again.'),\n                    confirmButtonColor: '#3085d6'\n                });\n                return;\n            }\n\n            // Show confirmation dialog\n            Swal.fire({\n                icon: 'warning',\n                title: getString('downgrade_to', 'Downgrade to ' + planName + '?').replace('{$a}', planName),\n                html: '<p>You will be redirected to the billing portal to complete the downgrade.</p>' +\n                      '<p class=\"text-muted\"><small>Your current plan features will remain active until the end of the billing period.</small></p>',\n                showCancelButton: true,\n                confirmButtonColor: '#17a2b8',\n                cancelButtonColor: '#95a5a6',\n                confirmButtonText: '<i class=\"fa fa-arrow-down\"></i> Downgrade',\n                cancelButtonText: getString('cancel', 'Cancel')\n            }).then(function(result) {\n                if (result.isConfirmed) {\n                    Subscription.createBillingPortalSession(planId, 'downgrade');\n                }\n            });\n        },\n\n        /**\n         * Handle cancel subscription\n         */\n        handleCancelSubscription: function($button) {\n            Swal.fire({\n                icon: 'warning',\n                title: getString('cancel_subscription_title', 'Cancel Subscription?'),\n                html: '<p><strong>' + getString('cancel_subscription_text', 'Are you sure you want to cancel your subscription? You will lose access to premium features at the end of your billing period.') + '</strong></p>' +\n                      '<p class=\"text-danger\"><small>This action cannot be undone.</small></p>',\n                showCancelButton: true,\n                confirmButtonColor: '#e74c3c',\n                cancelButtonColor: '#95a5a6',\n                confirmButtonText: '<i class=\"fa fa-times\"></i> ' + getString('yes_cancel', 'Yes, cancel it'),\n                cancelButtonText: 'Keep Subscription',\n                focusCancel: true\n            }).then(function(result) {\n                if (result.isConfirmed) {\n                    Subscription.createBillingPortalSession(null, 'cancel');\n                }\n            });\n        },\n\n        /**\n         * Open billing portal\n         */\n        openBillingPortal: function() {\n            Subscription.createBillingPortalSession(Subscription.subscriptionData.plan_id, 'modify');\n        },\n\n        /**\n         * Create billing portal session\n         */\n        createBillingPortalSession: function(planId, action) {\n            var returnUrl = window.location.href;\n            var data = {\n                return_url: returnUrl,\n                sesskey: M.cfg.sesskey\n            };\n\n            // Only add plan_id and action if they are defined and not null\n            if (planId && planId !== 'undefined' && planId !== null) {\n                data.plan_id = planId;\n            }\n\n            if (action && action !== 'undefined' && action !== null) {\n                data.action = action;\n            }\n\n            Ajax.call([{\n                methodname: 'report_adeptus_insights_create_billing_portal_session',\n                args: data,\n                done: function(response) {\n                    if (response && response.success && response.portal_url) {\n                        Swal.fire({\n                            icon: 'success',\n                            title: getString('redirecting', 'Redirecting...'),\n                            html: '<p>Opening billing portal in a new window...</p>',\n                            timer: 2000,\n                            timerProgressBar: true,\n                            showConfirmButton: false,\n                            allowOutsideClick: false,\n                            didOpen: function() {\n                                Swal.showLoading();\n                            }\n                        });\n\n                        // Open in new tab\n                        setTimeout(function() {\n                            var newWindow = window.open(response.portal_url, '_blank');\n                            if (!newWindow || newWindow.closed || typeof newWindow.closed === 'undefined') {\n                                Swal.fire({\n                                    icon: 'warning',\n                                    title: getString('popup_blocked', 'Popup Blocked'),\n                                    html: '<p>' + getString('popup_blocked_text', 'Please allow popups for this site to access the billing portal.') + '</p>' +\n                                          '<p><a href=\"' + response.portal_url + '\" target=\"_blank\" class=\"btn btn-primary\">Open Portal Manually</a></p>',\n                                    showConfirmButton: true,\n                                    confirmButtonText: getString('ok', 'OK')\n                                });\n                            }\n                        }, 1000);\n                    } else {\n                        Swal.fire({\n                            icon: 'error',\n                            title: getString('portal_creation_failed', 'Portal Creation Failed'),\n                            text: (response && response.message) || getString('failed_billing_portal', 'Failed to create billing portal session. Please try again.'),\n                            confirmButtonColor: '#3085d6'\n                        });\n                    }\n                },\n                fail: function(error) {\n                    Swal.fire({\n                        icon: 'error',\n                        title: getString('connection_error', 'Connection Error'),\n                        text: getString('failed_billing_portal', 'Failed to create billing portal session. Please check your connection and try again.'),\n                        confirmButtonColor: '#3085d6'\n                    });\n                }\n            }]);\n        },\n\n        /**\n         * Update subscription display\n         */\n        updateSubscriptionDisplay: function() {\n            // Get current subscription data\n            Ajax.call([{\n                methodname: 'report_adeptus_insights_get_subscription_details',\n                args: {},\n                done: function(response) {\n                    if (response.success && response.data) {\n                        Subscription.subscriptionData = response.data;\n                        Subscription.renderSubscriptionInfo(response.data);\n                    }\n                },\n                fail: function(error) {\n                    // Subscription details fetch failed silently.\n                }\n            }]);\n        },\n\n        /**\n         * Render subscription information\n         */\n        renderSubscriptionInfo: function(subscriptionData) {\n            var $container = $('.subscription-info');\n            if (!$container.length) return;\n\n            var html = '<div class=\"current-subscription\">';\n            html += '<h3>Current Subscription</h3>';\n            html += '<div class=\"subscription-details\">';\n            html += '<p><strong>Plan:</strong> ' + (subscriptionData.plan_name || 'Unknown') + '</p>';\n\n            // Display status with appropriate styling and messaging\n            var statusClass = 'text-success';\n            var statusText = subscriptionData.status || 'Unknown';\n\n            if (subscriptionData.should_disable_api_access) {\n                statusClass = 'text-danger';\n            } else if (subscriptionData.is_cancelled) {\n                statusClass = 'text-warning';\n            } else if (subscriptionData.has_payment_issues) {\n                statusClass = 'text-warning';\n            }\n\n            html += '<p><strong>Status:</strong> <span class=\"' + statusClass + '\">' + statusText + '</span></p>';\n\n            // Display status message if available\n            if (subscriptionData.status_message) {\n                var messageClass = 'text-muted';\n                if (subscriptionData.should_disable_api_access) {\n                    messageClass = 'text-danger';\n                } else if (subscriptionData.is_cancelled || subscriptionData.has_payment_issues) {\n                    messageClass = 'text-warning';\n                }\n                html += '<p class=\"' + messageClass + '\"><small>' + subscriptionData.status_message + '</small></p>';\n            }\n\n            // Show cancellation info\n            if (subscriptionData.cancel_at_period_end) {\n                var cancelDate = new Date(subscriptionData.current_period_end * 1000);\n                html += '<p class=\"text-warning\"><strong>⚠️ Cancelled:</strong> Access ends on ' + cancelDate.toLocaleDateString() + '</p>';\n            }\n\n            // Show payment failure info\n            if (subscriptionData.failed_payment_attempts > 0) {\n                html += '<p class=\"text-danger\"><strong>❌ Payment Failed:</strong> ' + subscriptionData.failed_payment_attempts + ' failed attempts</p>';\n            }\n\n            if (subscriptionData.current_period_end) {\n                var endDate = new Date(subscriptionData.current_period_end * 1000);\n                html += '<p><strong>Next billing:</strong> ' + endDate.toLocaleDateString() + '</p>';\n            }\n\n            html += '</div>';\n            html += '</div>';\n\n            $container.html(html);\n\n            // Update API access status globally\n            Subscription.updateApiAccessStatus(subscriptionData);\n        },\n\n        /**\n         * Update API access status globally\n         */\n        updateApiAccessStatus: function(subscriptionData) {\n            var apiAccessDisabled = subscriptionData.should_disable_api_access || false;\n\n            // Store the status globally for other modules to check\n            if (typeof window !== 'undefined') {\n                window.adeptusApiAccessDisabled = apiAccessDisabled;\n                window.adeptusSubscriptionStatus = subscriptionData;\n            }\n\n            // Disable/enable API-dependent elements\n            if (apiAccessDisabled) {\n                $('.btn-send-message, .btn-generate-report, .btn-ai-assistant').prop('disabled', true)\n                    .attr('title', 'API access disabled: ' + (subscriptionData.status_message || 'Subscription issue'));\n\n                // Show warning message\n                this.showApiAccessWarning(subscriptionData);\n            } else {\n                $('.btn-send-message, .btn-generate-report, .btn-ai-assistant').prop('disabled', false)\n                    .removeAttr('title');\n\n                // Hide warning message\n                this.hideApiAccessWarning();\n            }\n        },\n\n        /**\n         * Show API access warning\n         */\n        showApiAccessWarning: function(subscriptionData) {\n            var $existingWarning = $('.api-access-warning');\n            if ($existingWarning.length) return;\n\n            var warningHtml = '<div class=\"api-access-warning alert alert-danger alert-dismissible fade show\" role=\"alert\">';\n            warningHtml += '<strong>⚠️ API Access Disabled</strong><br>';\n            warningHtml += subscriptionData.status_message || 'Your subscription has an issue that prevents API access.';\n\n            if (subscriptionData.has_payment_issues) {\n                warningHtml += '<br><small>Please update your payment method to restore access.</small>';\n            } else if (subscriptionData.is_cancelled) {\n                warningHtml += '<br><small>Your subscription has been cancelled. Please reactivate to restore access.</small>';\n            }\n\n            warningHtml += '<button type=\"button\" class=\"btn-close\" data-bs-dismiss=\"alert\" aria-label=\"Close\"></button>';\n            warningHtml += '</div>';\n\n            $('body').prepend(warningHtml);\n        },\n\n        /**\n         * Hide API access warning\n         */\n        hideApiAccessWarning: function() {\n            $('.api-access-warning').remove();\n        },\n\n        /**\n         * Refresh subscription data\n         */\n        refresh: function() {\n            this.updateSubscriptionDisplay();\n        },\n\n        /**\n         * Stored plans data for toggle switching\n         */\n        plansData: null,\n        currentInterval: 'monthly',\n\n        /**\n         * Handle upgrade from free plan\n         * Shows a modal with available plans\n         */\n        handleUpgradeFromFree: function() {\n            // Show loading state\n            Swal.fire({\n                title: getString('loading_plans', 'Loading Plans...'),\n                html: '<div style=\"padding: 20px;\"><i class=\"fa fa-spinner fa-spin fa-2x\"></i></div>',\n                showConfirmButton: false,\n                allowOutsideClick: false\n            });\n\n            // Fetch available plans\n            fetch(M.cfg.wwwroot + '/report/adeptus_insights/ajax/get_available_plans.php?sesskey=' + M.cfg.sesskey)\n                .then(function(response) { return response.json(); })\n                .then(function(data) {\n                    if (data.success && (data.monthly_plans.length > 0 || data.yearly_plans.length > 0)) {\n                        // Store plans data for toggle switching\n                        Subscription.plansData = {\n                            monthly: data.monthly_plans || [],\n                            yearly: data.yearly_plans || []\n                        };\n                        Subscription.currentInterval = 'monthly';\n                        Subscription.showPlansModal(data);\n                    } else {\n                        Swal.fire({\n                            icon: 'error',\n                            title: getString('error', 'Error'),\n                            text: data.message || getString('failed_load_plans', 'Failed to load plans. Please try again.'),\n                            confirmButtonColor: '#3085d6'\n                        });\n                    }\n                })\n                .catch(function(error) {\n                    Swal.fire({\n                        icon: 'error',\n                        title: getString('connection_error', 'Connection Error'),\n                        text: getString('failed_load_plans', 'Failed to load plans. Please check your connection and try again.'),\n                        confirmButtonColor: '#3085d6'\n                    });\n                });\n        },\n\n        /**\n         * Show plans selection modal with monthly/yearly toggle\n         */\n        showPlansModal: function(data) {\n            var hasYearlyPlans = data.has_yearly_plans || false;\n            var maxYearlySavings = data.max_yearly_savings || 0;\n\n            // Build modal HTML with toggle\n            var modalHtml = '<div class=\"plans-modal-container\" style=\"text-align: left;\">';\n\n            // Billing toggle (only if yearly plans exist)\n            if (hasYearlyPlans) {\n                modalHtml += '<div class=\"billing-toggle-container\" style=\"display: flex; justify-content: center; margin-bottom: 24px;\">';\n                modalHtml += '<div class=\"billing-toggle\" style=\"display: inline-flex; align-items: center; background: #f3f4f6; border-radius: 50px; padding: 6px; gap: 4px;\">';\n                modalHtml += '<button type=\"button\" class=\"billing-toggle-btn active\" data-interval=\"monthly\" style=\"' +\n                    'padding: 10px 24px; border: none; background: white; border-radius: 50px; ' +\n                    'font-weight: 600; font-size: 14px; cursor: pointer; color: #1f2937; ' +\n                    'box-shadow: 0 2px 8px rgba(0,0,0,0.1); transition: all 0.3s ease;\">Monthly</button>';\n                modalHtml += '<button type=\"button\" class=\"billing-toggle-btn\" data-interval=\"yearly\" style=\"' +\n                    'padding: 10px 24px; border: none; background: transparent; border-radius: 50px; ' +\n                    'font-weight: 600; font-size: 14px; cursor: pointer; color: #6b7280; transition: all 0.3s ease;\">' +\n                    'Annual';\n                if (maxYearlySavings > 0) {\n                    modalHtml += '<span style=\"background: linear-gradient(135deg, #10b981 0%, #059669 100%); ' +\n                        'color: white; font-size: 10px; font-weight: 700; padding: 2px 8px; border-radius: 20px; ' +\n                        'margin-left: 6px; text-transform: uppercase;\">Save ' + maxYearlySavings + '%</span>';\n                }\n                modalHtml += '</button>';\n                modalHtml += '</div></div>';\n            }\n\n            // Plans grid container\n            modalHtml += '<div id=\"plans-grid-container\">';\n            modalHtml += Subscription.buildPlansGrid(data.monthly_plans || [], 'monthly');\n            modalHtml += '</div>';\n\n            modalHtml += '</div>';\n\n            Swal.fire({\n                title: '<i class=\"fa fa-rocket\" style=\"color: #2563eb;\"></i> Choose Your Plan',\n                html: modalHtml,\n                width: '95%',\n                showCancelButton: true,\n                showConfirmButton: false,\n                cancelButtonText: 'Cancel',\n                cancelButtonColor: '#95a5a6',\n                customClass: {\n                    popup: 'plans-modal-popup'\n                },\n                didOpen: function() {\n                    Subscription.initPlansModalHandlers();\n                }\n            });\n        },\n\n        /**\n         * Build plans grid HTML\n         */\n        buildPlansGrid: function(plans, interval) {\n            if (!plans || plans.length === 0) {\n                return '<div style=\"text-align: center; padding: 40px; color: #6b7280;\">' +\n                    '<i class=\"fa fa-calendar-times-o fa-2x\" style=\"margin-bottom: 10px;\"></i>' +\n                    '<p>Annual plans coming soon!</p></div>';\n            }\n\n            var html = '<div class=\"plans-grid\" style=\"display: grid; grid-template-columns: repeat(auto-fit, minmax(300px, 1fr)); gap: 24px; max-width: 1000px; margin: 0 auto;\">';\n\n            plans.forEach(function(plan) {\n                var borderColor = plan.is_current ? '#10b981' : (plan.is_popular ? '#2563eb' : '#e5e7eb');\n                var bgColor = plan.is_current ? 'linear-gradient(135deg, #f0fdf4 0%, #ecfdf5 100%)' : 'white';\n\n                html += '<div class=\"plan-card\" style=\"' +\n                    'background: ' + bgColor + '; ' +\n                    'border: 2px solid ' + borderColor + '; ' +\n                    'border-radius: 16px; ' +\n                    'padding: 28px 24px; ' +\n                    'position: relative; ' +\n                    'transition: all 0.3s ease; ' +\n                    'display: flex; ' +\n                    'flex-direction: column;\">';\n\n                // Badge\n                if (plan.is_current) {\n                    html += '<div style=\"position: absolute; top: -12px; left: 50%; transform: translateX(-50%); ' +\n                        'background: linear-gradient(135deg, #10b981 0%, #059669 100%); color: white; ' +\n                        'font-size: 11px; font-weight: 700; padding: 5px 14px; border-radius: 20px; ' +\n                        'text-transform: uppercase; letter-spacing: 0.5px;\">Current Plan</div>';\n                } else if (plan.is_popular) {\n                    html += '<div style=\"position: absolute; top: -12px; left: 50%; transform: translateX(-50%); ' +\n                        'background: linear-gradient(135deg, #2563eb 0%, #1d4ed8 100%); color: white; ' +\n                        'font-size: 11px; font-weight: 700; padding: 5px 14px; border-radius: 20px; ' +\n                        'text-transform: uppercase; letter-spacing: 0.5px;\">Most Popular</div>';\n                }\n\n                // Header\n                html += '<div style=\"text-align: center; margin-bottom: 20px; padding-top: 8px;\">';\n                html += '<div style=\"font-size: 22px; font-weight: 700; color: #1f2937; margin-bottom: 8px;\">' +\n                    plan.short_name + '</div>';\n                if (plan.description) {\n                    html += '<div style=\"color: #6b7280; font-size: 13px; line-height: 1.5;\">' +\n                        plan.description + '</div>';\n                }\n                html += '</div>';\n\n                // Price\n                html += '<div style=\"text-align: center; margin-bottom: 24px; padding-bottom: 24px; border-bottom: 1px solid #e5e7eb;\">';\n                if (plan.is_free) {\n                    html += '<div style=\"font-size: 42px; font-weight: 800; color: #10b981;\">Free</div>';\n                    html += '<div style=\"color: #6b7280; font-size: 13px;\">Forever</div>';\n                } else {\n                    html += '<div style=\"font-size: 42px; font-weight: 800; color: #1f2937;\">' +\n                        plan.price_formatted + '</div>';\n                    var periodText = interval === 'yearly' ? 'per year' : 'per month';\n                    html += '<div style=\"color: #6b7280; font-size: 13px;\">' + periodText + '</div>';\n                    if (plan.has_savings) {\n                        html += '<div style=\"margin-top: 6px;\"><span style=\"background: linear-gradient(135deg, #10b981 0%, #059669 100%); ' +\n                            'color: white; font-size: 11px; font-weight: 700; padding: 3px 10px; border-radius: 20px;\">' +\n                            'Save ' + plan.savings_percent + '%</span></div>';\n                    }\n                }\n                html += '</div>';\n\n                // Limits - 4 items in 2x2 grid\n                html += '<div style=\"display: grid; grid-template-columns: 1fr 1fr; gap: 12px; margin-bottom: 20px; padding-bottom: 20px; border-bottom: 1px solid #e5e7eb;\">';\n                html += '<div style=\"text-align: center; padding: 12px; background: #f9fafb; border-radius: 10px;\">' +\n                    '<div style=\"font-size: 16px; font-weight: 700; color: #1f2937;\">' + plan.tokens_limit + '</div>' +\n                    '<div style=\"font-size: 11px; color: #6b7280; text-transform: uppercase; letter-spacing: 0.5px;\">AI Tokens</div></div>';\n                html += '<div style=\"text-align: center; padding: 12px; background: #f9fafb; border-radius: 10px;\">' +\n                    '<div style=\"font-size: 16px; font-weight: 700; color: #1f2937;\">' + plan.exports_limit + '</div>' +\n                    '<div style=\"font-size: 11px; color: #6b7280; text-transform: uppercase; letter-spacing: 0.5px;\">Exports/mo</div></div>';\n                html += '<div style=\"text-align: center; padding: 12px; background: #f9fafb; border-radius: 10px;\">' +\n                    '<div style=\"font-size: 16px; font-weight: 700; color: #1f2937;\">' + plan.reports_limit + '</div>' +\n                    '<div style=\"font-size: 11px; color: #6b7280; text-transform: uppercase; letter-spacing: 0.5px;\">Saved Reports</div></div>';\n                html += '<div style=\"text-align: center; padding: 12px; background: #f9fafb; border-radius: 10px;\">' +\n                    '<div style=\"font-size: 16px; font-weight: 700; color: #1f2937;\">' + plan.export_formats + '</div>' +\n                    '<div style=\"font-size: 11px; color: #6b7280; text-transform: uppercase; letter-spacing: 0.5px;\">Formats</div></div>';\n                html += '</div>';\n\n                // Features list\n                if (plan.features && plan.features.length > 0) {\n                    html += '<div style=\"flex: 1; margin-bottom: 20px;\">';\n                    html += '<ul style=\"list-style: none; padding: 0; margin: 0;\">';\n                    plan.features.forEach(function(feature) {\n                        html += '<li style=\"display: flex; align-items: flex-start; gap: 10px; padding: 8px 0; ' +\n                            'color: #374151; font-size: 13px; line-height: 1.4;\">' +\n                            '<i class=\"fa fa-check\" style=\"color: #10b981; font-size: 12px; margin-top: 3px; flex-shrink: 0;\"></i> ' +\n                            feature + '</li>';\n                    });\n                    html += '</ul></div>';\n                }\n\n                // Action button\n                html += '<div style=\"margin-top: auto;\">';\n                if (plan.is_current) {\n                    html += '<button class=\"plan-select-btn\" disabled style=\"' +\n                        'display: block; width: 100%; padding: 14px; border: none; border-radius: 10px; ' +\n                        'background: #e5e7eb; color: #6b7280; font-weight: 600; font-size: 14px; cursor: default;\">' +\n                        '<i class=\"fa fa-check-circle\"></i> Current Plan</button>';\n                } else if (plan.is_free) {\n                    html += '<button class=\"plan-select-btn\" disabled style=\"' +\n                        'display: block; width: 100%; padding: 14px; border: 2px solid #e5e7eb; border-radius: 10px; ' +\n                        'background: white; color: #374151; font-weight: 600; font-size: 14px; cursor: default;\">' +\n                        'Free Plan</button>';\n                } else {\n                    // Include stripe_price_id if available for checkout\n                    var stripePriceId = plan.stripe_price_id || '';\n                    var stripeConfigured = plan.stripe_configured || false;\n                    html += '<button class=\"plan-select-btn\" data-plan-id=\"' + (plan.id || '') + '\" ' +\n                        'data-plan-name=\"' + plan.short_name + '\" ' +\n                        'data-stripe-price-id=\"' + stripePriceId + '\" ' +\n                        'data-stripe-configured=\"' + stripeConfigured + '\" style=\"' +\n                        'display: block; width: 100%; padding: 14px; border: none; border-radius: 10px; ' +\n                        'background: linear-gradient(135deg, #2563eb 0%, #1d4ed8 100%); color: white; ' +\n                        'font-weight: 600; font-size: 14px; cursor: pointer; transition: all 0.3s ease;\">' +\n                        '<i class=\"fa fa-arrow-up\"></i> Upgrade to ' + plan.short_name + '</button>';\n                }\n                html += '</div>';\n\n                html += '</div>'; // end plan-card\n            });\n\n            html += '</div>'; // end plans-grid\n            return html;\n        },\n\n        /**\n         * Initialize plans modal event handlers\n         */\n        initPlansModalHandlers: function() {\n            // Billing toggle handler\n            document.querySelectorAll('.billing-toggle-btn').forEach(function(btn) {\n                btn.addEventListener('click', function() {\n                    var interval = this.getAttribute('data-interval');\n                    if (interval === Subscription.currentInterval) return;\n\n                    // Update toggle UI\n                    document.querySelectorAll('.billing-toggle-btn').forEach(function(b) {\n                        b.classList.remove('active');\n                        b.style.background = 'transparent';\n                        b.style.color = '#6b7280';\n                        b.style.boxShadow = 'none';\n                    });\n                    this.classList.add('active');\n                    this.style.background = 'white';\n                    this.style.color = '#1f2937';\n                    this.style.boxShadow = '0 2px 8px rgba(0,0,0,0.1)';\n\n                    Subscription.currentInterval = interval;\n\n                    // Update plans display\n                    var plans = Subscription.plansData[interval] || [];\n                    var container = document.getElementById('plans-grid-container');\n                    if (container) {\n                        container.innerHTML = Subscription.buildPlansGrid(plans, interval);\n                        Subscription.initPlanButtonHandlers();\n                    }\n                });\n            });\n\n            // Initialize plan button handlers\n            Subscription.initPlanButtonHandlers();\n        },\n\n        /**\n         * Initialize plan button click handlers\n         */\n        initPlanButtonHandlers: function() {\n            document.querySelectorAll('.plan-select-btn:not([disabled])').forEach(function(btn) {\n                btn.addEventListener('click', function() {\n                    var planName = this.getAttribute('data-plan-name');\n                    var planId = this.getAttribute('data-plan-id');\n                    var stripePriceId = this.getAttribute('data-stripe-price-id');\n                    var stripeConfigured = this.getAttribute('data-stripe-configured') === 'true';\n\n                    // If Stripe is configured for this plan, use checkout session\n                    if (stripeConfigured && stripePriceId) {\n                        Subscription.createCheckoutSession(planId, stripePriceId, planName);\n                    } else {\n                        // Fallback to billing portal or show \"coming soon\" message\n                        Subscription.openBillingPortalForUpgrade(planName, planId);\n                    }\n                });\n\n                // Hover effects\n                btn.addEventListener('mouseenter', function() {\n                    this.style.transform = 'translateY(-2px)';\n                    this.style.boxShadow = '0 8px 20px rgba(37, 99, 235, 0.3)';\n                });\n                btn.addEventListener('mouseleave', function() {\n                    this.style.transform = 'translateY(0)';\n                    this.style.boxShadow = 'none';\n                });\n            });\n        },\n\n        /**\n         * Open billing portal for upgrade\n         * Uses the same approach as Step 2 - opens billing portal where user can select plan\n         */\n        openBillingPortalForUpgrade: function(planName, planId) {\n            Swal.fire({\n                title: getString('opening_billing_portal', 'Opening Billing Portal...'),\n                html: '<p>Preparing upgrade to ' + planName + '...</p>',\n                allowOutsideClick: false,\n                showConfirmButton: false,\n                didOpen: function() {\n                    Swal.showLoading();\n                }\n            });\n\n            var returnUrl = window.location.href;\n            var args = {\n                return_url: returnUrl,\n                sesskey: M.cfg.sesskey\n            };\n\n            // Pass plan_id if available (needed for customer creation)\n            if (planId) {\n                args.plan_id = planId;\n            }\n\n            Ajax.call([{\n                methodname: 'report_adeptus_insights_create_billing_portal_session',\n                args: args,\n                done: function(response) {\n                    if (response && response.success && response.portal_url) {\n                        Swal.fire({\n                            icon: 'success',\n                            title: getString('redirecting', 'Redirecting...'),\n                            html: '<p>Opening billing portal...</p>',\n                            timer: 2000,\n                            timerProgressBar: true,\n                            showConfirmButton: false,\n                            allowOutsideClick: false\n                        });\n\n                        setTimeout(function() {\n                            // Redirect in same window (like Step 2 does)\n                            window.location.href = response.portal_url;\n                        }, 1000);\n                    } else {\n                        var errorMessage = (response && response.message) || getString('failed_open_billing', 'Failed to open billing portal.');\n\n                        // Check for specific error codes and provide helpful messages\n                        if (errorMessage.indexOf('NO_STRIPE_CUSTOMER') !== -1 ||\n                            errorMessage.indexOf('payment_enabled') !== -1 ||\n                            errorMessage.indexOf('Stripe') !== -1) {\n                            Swal.fire({\n                                icon: 'info',\n                                title: getString('upgrade_coming_soon', 'Upgrade Coming Soon'),\n                                html: '<p>Online payments are not yet configured for this installation.</p>' +\n                                      '<p>To upgrade to <strong>' + planName + '</strong>, please contact your administrator or email:</p>' +\n                                      '<p><a href=\"mailto:support@adeptus360.com?subject=Upgrade%20to%20' + planName + '\">support@adeptus360.com</a></p>',\n                                confirmButtonColor: '#2563eb',\n                                confirmButtonText: getString('ok', 'OK')\n                            });\n                        } else {\n                            Swal.fire({\n                                icon: 'error',\n                                title: getString('billing_portal_error', 'Billing Portal Error'),\n                                text: errorMessage,\n                                confirmButtonColor: '#3085d6'\n                            });\n                        }\n                    }\n                },\n                fail: function(error) {\n                    Swal.fire({\n                        icon: 'error',\n                        title: getString('connection_error', 'Connection Error'),\n                        text: getString('failed_open_billing', 'Failed to open billing portal. Please try again.'),\n                        confirmButtonColor: '#3085d6'\n                    });\n                }\n            }]);\n        },\n\n        /**\n         * Create Stripe Checkout session for new subscriptions\n         * @param {string} planId - The plan ID\n         * @param {string} stripePriceId - The Stripe price ID\n         * @param {string} planName - The plan name for display\n         */\n        createCheckoutSession: function(planId, stripePriceId, planName) {\n            Swal.fire({\n                title: getString('preparing_checkout', 'Preparing Checkout...'),\n                html: '<p>Setting up payment for ' + planName + '...</p>',\n                allowOutsideClick: false,\n                showConfirmButton: false,\n                didOpen: function() {\n                    Swal.showLoading();\n                }\n            });\n\n            var returnUrl = window.location.href;\n            var args = {\n                plan_id: parseInt(planId),\n                stripe_price_id: stripePriceId,\n                return_url: returnUrl,\n                sesskey: M.cfg.sesskey\n            };\n\n            Ajax.call([{\n                methodname: 'report_adeptus_insights_create_checkout_session',\n                args: args,\n                done: function(response) {\n                    if (response && response.success && response.checkout_url) {\n                        Swal.fire({\n                            icon: 'success',\n                            title: getString('redirecting_checkout', 'Redirecting to Checkout...'),\n                            html: '<p>You will be redirected to complete your payment.</p>',\n                            timer: 2000,\n                            timerProgressBar: true,\n                            showConfirmButton: false,\n                            allowOutsideClick: false\n                        });\n\n                        setTimeout(function() {\n                            window.location.href = response.checkout_url;\n                        }, 1000);\n                    } else {\n                        var errorMessage = (response && response.message) || getString('failed_checkout', 'Failed to create checkout session.');\n                        var errorCode = (response && response.error_code) || '';\n\n                        // Handle specific error codes\n                        if (errorCode === 'STRIPE_NOT_CONFIGURED') {\n                            Swal.fire({\n                                icon: 'info',\n                                title: getString('payment_not_available', 'Payment Not Available'),\n                                html: '<p>Stripe is not yet configured for the <strong>' + planName + '</strong> plan.</p>' +\n                                      '<p>Please contact your administrator or email:</p>' +\n                                      '<p><a href=\"mailto:support@adeptus360.com?subject=Upgrade%20to%20' + planName + '\">support@adeptus360.com</a></p>',\n                                confirmButtonColor: '#2563eb',\n                                confirmButtonText: getString('ok', 'OK')\n                            });\n                        } else {\n                            Swal.fire({\n                                icon: 'error',\n                                title: getString('checkout_error', 'Checkout Error'),\n                                text: errorMessage,\n                                confirmButtonColor: '#3085d6'\n                            });\n                        }\n                    }\n                },\n                fail: function(error) {\n                    Swal.fire({\n                        icon: 'error',\n                        title: getString('connection_error', 'Connection Error'),\n                        text: getString('failed_checkout', 'Failed to create checkout session. Please try again.'),\n                        confirmButtonColor: '#3085d6'\n                    });\n                }\n            }]);\n        },\n\n        /**\n         * Handle select plan (for new subscriptions)\n         */\n        handleSelectPlan: function($button, planId, planName) {\n            if (!planId) {\n                Swal.fire({\n                    icon: 'error',\n                    title: getString('error', 'Error'),\n                    text: getString('plan_id_not_available', 'Plan ID not available. Please try again.'),\n                    confirmButtonColor: '#3085d6'\n                });\n                return;\n            }\n\n            // Show confirmation dialog\n            Swal.fire({\n                icon: 'info',\n                title: getString('subscribe_to', 'Subscribe to ' + planName + '?').replace('{$a}', planName),\n                html: '<p>You will be redirected to complete your subscription.</p>',\n                showCancelButton: true,\n                confirmButtonColor: '#3498db',\n                cancelButtonColor: '#95a5a6',\n                confirmButtonText: '<i class=\"fa fa-credit-card\"></i> Subscribe Now',\n                cancelButtonText: getString('cancel', 'Cancel')\n            }).then(function(result) {\n                if (result.isConfirmed) {\n                    Subscription.createBillingPortalSession(planId, 'subscribe');\n                }\n            });\n        },\n\n        /**\n         * Handle renew subscription\n         */\n        handleRenewSubscription: function() {\n            Swal.fire({\n                icon: 'success',\n                title: getString('renew_subscription', 'Renew Your Subscription?'),\n                html: '<p>Welcome back! Renew your subscription to regain access to all premium features.</p>',\n                showCancelButton: true,\n                confirmButtonColor: '#27ae60',\n                cancelButtonColor: '#95a5a6',\n                confirmButtonText: '<i class=\"fa fa-refresh\"></i> Renew Subscription',\n                cancelButtonText: 'Not Now'\n            }).then(function(result) {\n                if (result.isConfirmed) {\n                    // Open billing portal for renewal\n                    Subscription.createBillingPortalSession(null, 'renew');\n                }\n            });\n        }\n    };\n\n    return Subscription;\n});\n"],"names":["define","$","Ajax","Notification","Str","Swal","window","strings","getString","key","fallback","Subscription","planId","subscriptionData","init","self","this","get_strings","component","then","results","verifying_payment","verifying_payment_text","upgrade_successful","verification_issue","verification_issue_text","processing_payment","processing_payment_text","checkout_cancelled","checkout_cancelled_text","cancel_subscription_title","cancel_subscription_text","yes_cancel","upgrade_to","downgrade_to","choose_your_plan","redirecting","popup_blocked","popup_blocked_text","portal_creation_failed","connection_error","preparing_checkout","redirecting_checkout","upgrade_coming_soon","billing_portal_error","opening_billing_portal","loading_plans","continue_text","error","cancel","ok","plan_id_not_available","failed_billing_portal","failed_load_plans","failed_open_billing","failed_checkout","payment_not_available","checkout_error","subscribe_to","renew_subscription","keep_subscription","yes_cancel_subscription","_initAfterStrings","catch","initEventHandlers","checkForCheckoutSuccess","updateSubscriptionDisplay","urlParams","URLSearchParams","location","search","checkoutStatus","get","sessionId","fire","title","html","allowOutsideClick","showConfirmButton","didOpen","showLoading","call","methodname","args","session_id","sesskey","M","cfg","done","response","success","planName","plan_name","icon","replace","confirmButtonColor","confirmButtonText","cleanUrl","href","split","message","fail","history","replaceState","document","text","cancelUrl","on","e","preventDefault","handleUpgradeFromFree","handleDowngradePlan","handleCancelSubscription","openBillingPortal","data","handleSelectPlan","handleRenewSubscription","handleUpgradePlan","$button","showCancelButton","cancelButtonColor","cancelButtonText","result","isConfirmed","createBillingPortalSession","focusCancel","plan_id","action","return_url","portal_url","timer","timerProgressBar","setTimeout","newWindow","open","closed","renderSubscriptionInfo","$container","length","statusClass","statusText","status","should_disable_api_access","is_cancelled","has_payment_issues","status_message","messageClass","cancel_at_period_end","Date","current_period_end","toLocaleDateString","failed_payment_attempts","updateApiAccessStatus","apiAccessDisabled","adeptusApiAccessDisabled","adeptusSubscriptionStatus","prop","attr","showApiAccessWarning","removeAttr","hideApiAccessWarning","warningHtml","prepend","remove","refresh","plansData","currentInterval","fetch","wwwroot","json","monthly_plans","yearly_plans","monthly","yearly","showPlansModal","hasYearlyPlans","has_yearly_plans","maxYearlySavings","max_yearly_savings","modalHtml","buildPlansGrid","width","customClass","popup","initPlansModalHandlers","plans","interval","forEach","plan","borderColor","is_current","is_popular","bgColor","short_name","description","is_free","price_formatted","has_savings","savings_percent","tokens_limit","exports_limit","reports_limit","export_formats","features","feature","stripePriceId","stripe_price_id","stripeConfigured","stripe_configured","id","querySelectorAll","btn","addEventListener","getAttribute","b","classList","style","background","color","boxShadow","add","container","getElementById","innerHTML","initPlanButtonHandlers","createCheckoutSession","openBillingPortalForUpgrade","transform","errorMessage","indexOf","returnUrl","parseInt","checkout_url","error_code"],"mappings":"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"}