define(["jquery","core/ajax","core/notification"],function(i,t,e){"use strict";return{initializeFromMoodle:function(t){t&&(t.subscription&&(void 0!==t.subscription.ai_credits_used_this_month&&(t.subscription.total_credits_used_this_month=t.subscription.ai_credits_used_this_month),void 0!==t.subscription.plan_ai_credits_limit&&(t.subscription.plan_total_credits_limit=t.subscription.plan_ai_credits_limit),t.plan&&t.plan.ai_credits&&(t.subscription.plan_total_credits_limit=t.plan.ai_credits)),window.adeptusAuthData=t,this.checkReadOnlyMode(t),this.initializeAuthFeatures(t))},checkReadOnlyMode:function(t){t&&t.user_authorized&&t.has_api_key&&!(t.auth_errors&&0<t.auth_errors)||i(document).trigger("adeptus:enableReadOnly")},initializeAuthFeatures:function(t){t&&t.user_authorized&&t.has_api_key&&(i(document).trigger("adeptus:enableInteractiveFeatures"),void 0!==window.AdeptusAI&&window.AdeptusAI.init())},isAuthenticated:function(){return window.adeptusAuthData&&window.adeptusAuthData.user_authorized&&window.adeptusAuthData.has_api_key},getAuthData:function(){return window.adeptusAuthData||null},getAuthStatus:function(){return window.adeptusAuthData||null},getAuthHeaders:function(){var t=this.getAuthData();return t&&t.api_key?{Authorization:"Bearer "+t.api_key,"X-API-Key":t.api_key}:{}},setAuthStatus:function(t){t&&(t.subscription&&(void 0!==t.subscription.ai_credits_used_this_month&&(t.subscription.total_credits_used_this_month=t.subscription.ai_credits_used_this_month),void 0!==t.subscription.plan_ai_credits_limit&&(t.subscription.plan_total_credits_limit=t.subscription.plan_ai_credits_limit),t.plan&&t.plan.ai_credits&&(t.subscription.plan_total_credits_limit=t.plan.ai_credits)),window.adeptusAuthData=t)},clearAuthData:function(){window.adeptusAuthData=null},showAuthError:function(t){e?e.addNotification({message:t||"Authentication required",type:"error"}):alert(t||"Authentication required")},refreshAuthStatus:function(){}}});