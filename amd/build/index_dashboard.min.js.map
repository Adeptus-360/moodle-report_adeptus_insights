{"version":3,"file":"index_dashboard.min.js","sources":["../src/index_dashboard.js"],"sourcesContent":["// This file is part of Moodle - http://moodle.org/\n//\n// Moodle is free software: you can redistribute it and/or modify\n// it under the terms of the GNU General Public License as published by\n// the Free Software Foundation, either version 3 of the License, or\n// (at your option) any later version.\n//\n// Moodle is distributed in the hope that it will be useful,\n// but WITHOUT ANY WARRANTY; without even the implied warranty of\n// MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n// GNU General Public License for more details.\n//\n// You should have received a copy of the GNU General Public License\n// along with Moodle.  If not, see <http://www.gnu.org/licenses/>.\n\n/**\n * Dashboard Index JavaScript Module.\n *\n * Handles counter animations for subscription stats using IntersectionObserver.\n *\n * @module     report_adeptus_insights/index_dashboard\n * @package    report_adeptus_insights\n * @copyright  2026 Adeptus 360 <info@adeptus360.com>\n * @license    http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later\n */\ndefine([], function() {\n    'use strict';\n\n    /**\n     * Check if user prefers reduced motion.\n     * @type {boolean}\n     */\n    var prefersReduced = window.matchMedia && window.matchMedia('(prefers-reduced-motion: reduce)').matches;\n\n    /**\n     * Format large numbers in compact form (e.g., 1.5k, 2.3M).\n     * @param {number} n - The number to format\n     * @returns {string} Formatted number string\n     */\n    var numberFormatter = function(n) {\n        var v = +n;\n        if (!isFinite(v)) {\n            return String(n);\n        }\n        // Compact for big numbers\n        if (v >= 1000000) {\n            return (Math.round(v / 100000) / 10) + 'M';\n        }\n        if (v >= 1000) {\n            return (Math.round(v / 100) / 10) + 'k';\n        }\n        return v.toString();\n    };\n\n    /**\n     * Animate a counter element from 0 to target value.\n     * @param {HTMLElement} el - The element to animate\n     * @param {string|number} to - Target value\n     * @param {Object} opts - Animation options\n     * @param {number} opts.duration - Animation duration in ms\n     * @param {Function} opts.format - Number formatting function\n     */\n    var animateCount = function(el, to, opts) {\n        var dur = (opts && opts.duration) || 1400;\n        var fmt = (opts && opts.format) || function(v) {\n            return v.toString();\n        };\n        var start = 0;\n        var end = +to; // Coerce to number\n\n        if (!isFinite(end)) {\n            // Non-numeric target: show raw text and stop\n            el.textContent = (to === null || typeof to === 'undefined') ? '-' : String(to);\n            el.classList.add('no-animate');\n            return;\n        }\n\n        if (prefersReduced) {\n            el.textContent = fmt(end);\n            return;\n        }\n\n        var t0 = null;\n\n        var step = function(ts) {\n            if (!t0) {\n                t0 = ts;\n            }\n            var p = Math.min(1, (ts - t0) / dur);\n            // easeOutCubic\n            var eased = 1 - Math.pow(1 - p, 3);\n            var current = Math.round(start + (end - start) * eased);\n            el.textContent = fmt(current);\n\n            if (p < 1) {\n                requestAnimationFrame(step);\n            } else {\n                el.textContent = fmt(end);\n                el.classList.add('counted');\n            }\n        };\n\n        requestAnimationFrame(step);\n    };\n\n    /**\n     * Initialize counters with IntersectionObserver.\n     */\n    var bootCounters = function() {\n        var nodes = [].slice.call(document.querySelectorAll('.adeptus-stat-value[data-count-to]'));\n        if (!nodes.length) {\n            return;\n        }\n\n        // Fallback if IntersectionObserver not available\n        if (!('IntersectionObserver' in window)) {\n            nodes.forEach(function(el) {\n                animateCount(el, el.getAttribute('data-count-to'), {\n                    duration: 1400,\n                    format: numberFormatter\n                });\n            });\n            return;\n        }\n\n        var once = new IntersectionObserver(function(entries, obs) {\n            entries.forEach(function(e) {\n                if (e.isIntersecting) {\n                    var el = e.target;\n                    animateCount(el, el.getAttribute('data-count-to'), {\n                        duration: 1400,\n                        format: numberFormatter\n                    });\n                    obs.unobserve(el);\n                }\n            });\n        }, {threshold: 0.4});\n\n        nodes.forEach(function(el) {\n            once.observe(el);\n        });\n    };\n\n    return {\n        /**\n         * Initialize the dashboard module.\n         */\n        init: function() {\n            // Start after DOM ready\n            if (document.readyState === 'loading') {\n                document.addEventListener('DOMContentLoaded', bootCounters);\n            } else {\n                bootCounters();\n            }\n        }\n    };\n});\n"],"names":["define","prefersReduced","window","matchMedia","matches","numberFormatter","n","v","isFinite","Math","round","toString","String","animateCount","el","to","opts","dur","duration","fmt","format","end","textContent","classList","add","t0","step","ts","p","min","eased","pow","current","requestAnimationFrame","bootCounters","nodes","slice","call","document","querySelectorAll","length","once","IntersectionObserver","entries","obs","forEach","e","isIntersecting","target","getAttribute","unobserve","threshold","observe","init","readyState","addEventListener"],"mappings":";;;;;;;;;;AAyBAA,iDAAO,IAAI,eAOHC,eAAiBC,OAAOC,YAAcD,OAAOC,WAAW,oCAAoCC,QAO5FC,gBAAkB,SAASC,OACvBC,GAAKD,SACJE,SAASD,GAIVA,GAAK,IACGE,KAAKC,MAAMH,EAAI,KAAU,GAAM,IAEvCA,GAAK,IACGE,KAAKC,MAAMH,EAAI,KAAO,GAAM,IAEjCA,EAAEI,WATEC,OAAON,IAoBlBO,aAAe,SAASC,GAAIC,GAAIC,UAC5BC,IAAOD,MAAQA,KAAKE,UAAa,KACjCC,IAAOH,MAAQA,KAAKI,QAAW,SAASb,UACjCA,EAAEI,YAGTU,KAAON,OAENP,SAASa,YAEVP,GAAGQ,YAAeP,MAAAA,GAA4C,IAAMH,OAAOG,SAC3ED,GAAGS,UAAUC,IAAI,iBAIjBvB,eACAa,GAAGQ,YAAcH,IAAIE,cAIrBI,GAAK,KAELC,KAAO,SAASC,IACXF,KACDA,GAAKE,QAELC,EAAInB,KAAKoB,IAAI,GAAIF,GAAKF,IAAMR,KAE5Ba,MAAQ,EAAIrB,KAAKsB,IAAI,EAAIH,EAAG,GAC5BI,QAAUvB,KAAKC,MAxBX,GAwB0BW,IAxB1B,GAwByCS,OACjDhB,GAAGQ,YAAcH,IAAIa,SAEjBJ,EAAI,EACJK,sBAAsBP,OAEtBZ,GAAGQ,YAAcH,IAAIE,KACrBP,GAAGS,UAAUC,IAAI,aAIzBS,sBAAsBP,QAMtBQ,aAAe,eACXC,MAAQ,GAAGC,MAAMC,KAAKC,SAASC,iBAAiB,0CAC/CJ,MAAMK,UAKL,yBAA0BtC,YAU5BuC,KAAO,IAAIC,sBAAqB,SAASC,QAASC,KAClDD,QAAQE,SAAQ,SAASC,MACjBA,EAAEC,eAAgB,KACdjC,GAAKgC,EAAEE,OACXnC,aAAaC,GAAIA,GAAGmC,aAAa,iBAAkB,CAC/C/B,SAAU,KACVE,OAAQf,kBAEZuC,IAAIM,UAAUpC,UAGvB,CAACqC,UAAW,KAEfhB,MAAMU,SAAQ,SAAS/B,IACnB2B,KAAKW,QAAQtC,YAvBbqB,MAAMU,SAAQ,SAAS/B,IACnBD,aAAaC,GAAIA,GAAGmC,aAAa,iBAAkB,CAC/C/B,SAAU,KACVE,OAAQf,4BAwBjB,CAIHgD,KAAM,WAE0B,YAAxBf,SAASgB,WACThB,SAASiB,iBAAiB,mBAAoBrB,cAE9CA"}