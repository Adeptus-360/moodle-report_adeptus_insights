{"version":3,"file":"registration.min.js","sources":["../src/registration.js"],"sourcesContent":["// This file is part of Moodle - http://moodle.org/\n//\n// Moodle is free software: you can redistribute it and/or modify\n// it under the terms of the GNU General Public License as published by\n// the Free Software Foundation, either version 3 of the License, or\n// (at your option) any later version.\n//\n// Moodle is distributed in the hope that it will be useful,\n// but WITHOUT ANY WARRANTY; without even the implied warranty of\n// MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n// GNU General Public License for more details.\n//\n// You should have received a copy of the GNU General Public License\n// along with Moodle.  If not, see <http://www.gnu.org/licenses/>.\n\n/**\n * Registration wizard functionality for Adeptus Insights plugin.\n *\n * @module     report_adeptus_insights/registration\n * @copyright  2026 Adeptus 360 <info@adeptus360.com>\n * @license    http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later\n */\n\ndefine(['jquery', 'core/ajax', 'core/notification', 'core/str'], function($, Ajax, Notification, Str) {\n    'use strict';\n\n    /**\n     * Registration wizard module.\n     */\n    var Registration = {\n        /**\n         * Current step in the wizard.\n         * @type {string}\n         */\n        currentStep: 'welcome',\n\n        /**\n         * Form data collected during registration.\n         * @type {Object}\n         */\n        formData: {},\n\n        /**\n         * Initialize the registration wizard.\n         */\n        init: function() {\n            this.bindEvents();\n            this.showStep('welcome');\n        },\n\n        /**\n         * Bind event handlers.\n         */\n        bindEvents: function() {\n            var self = this;\n\n            // Next step buttons.\n            $(document).on('click', '.btn-next-step', function(e) {\n                e.preventDefault();\n                var nextStep = $(this).data('step');\n                if (self.validateCurrentStep()) {\n                    self.showStep(nextStep);\n                }\n            });\n\n            // Previous step buttons.\n            $(document).on('click', '.btn-prev-step, .adeptus-btn-back', function(e) {\n                e.preventDefault();\n                var prevStep = $(this).data('step');\n                if (prevStep) {\n                    self.showStep(prevStep);\n                } else {\n                    // Handle back buttons without data-step.\n                    var currentStepId = $(this).closest('.adeptus-wizard-step').attr('id');\n                    if (currentStepId === 'step-admin-info') {\n                        self.showStep('welcome');\n                    } else if (currentStepId === 'step-verification') {\n                        self.showStep('admin-info');\n                    }\n                }\n            });\n\n            // Register installation button.\n            $(document).on('click', '#register-installation', function(e) {\n                e.preventDefault();\n                self.submitRegistration();\n            });\n\n            // Continue to subscription button.\n            $(document).on('click', '#continue-to-subscription', function(e) {\n                e.preventDefault();\n                window.location.href = M.cfg.wwwroot + '/report/adeptus_insights/subscription.php';\n            });\n\n            // Go to dashboard button.\n            $(document).on('click', '#go-to-dashboard', function(e) {\n                e.preventDefault();\n                window.location.href = M.cfg.wwwroot + '/report/adeptus_insights/index.php';\n            });\n\n            // Error close button.\n            $(document).on('click', '#error-close', function(e) {\n                e.preventDefault();\n                self.hideError();\n            });\n\n            // Form input changes - update summary.\n            $(document).on('input', '#admin_name, #admin_email', function() {\n                self.updateSummary();\n            });\n        },\n\n        /**\n         * Show a specific step.\n         *\n         * @param {string} stepName The step to show.\n         */\n        showStep: function(stepName) {\n            // Hide all steps.\n            $('.adeptus-wizard-step').removeClass('active');\n\n            // Show the requested step.\n            var stepId = 'step-' + stepName;\n            $('#' + stepId).addClass('active');\n\n            // Update current step.\n            this.currentStep = stepName;\n\n            // Update summary when showing verification step.\n            if (stepName === 'verification') {\n                this.updateSummary();\n            }\n        },\n\n        /**\n         * Validate the current step before proceeding.\n         *\n         * @return {boolean} True if validation passes.\n         */\n        validateCurrentStep: function() {\n            if (this.currentStep === 'admin-info') {\n                var adminName = $('#admin_name').val().trim();\n                var adminEmail = $('#admin_email').val().trim();\n\n                if (!adminName) {\n                    this.showFieldError('#admin_name', 'Please enter your name');\n                    return false;\n                }\n\n                if (!adminEmail) {\n                    this.showFieldError('#admin_email', 'Please enter your email address');\n                    return false;\n                }\n\n                if (!this.isValidEmail(adminEmail)) {\n                    this.showFieldError('#admin_email', 'Please enter a valid email address');\n                    return false;\n                }\n\n                // Store form data.\n                this.formData.admin_name = adminName;\n                this.formData.admin_email = adminEmail;\n            }\n\n            return true;\n        },\n\n        /**\n         * Show a field error.\n         *\n         * @param {string} selector The field selector.\n         * @param {string} message The error message.\n         */\n        showFieldError: function(selector, message) {\n            var $field = $(selector);\n            $field.addClass('is-invalid');\n\n            // Remove existing error message.\n            $field.next('.invalid-feedback').remove();\n\n            // Add error message.\n            $field.after('<div class=\"invalid-feedback\">' + message + '</div>');\n\n            // Remove error on input.\n            $field.one('input', function() {\n                $(this).removeClass('is-invalid');\n                $(this).next('.invalid-feedback').remove();\n            });\n        },\n\n        /**\n         * Validate email format.\n         *\n         * @param {string} email The email to validate.\n         * @return {boolean} True if valid.\n         */\n        isValidEmail: function(email) {\n            var emailRegex = /^[^\\s@]+@[^\\s@]+\\.[^\\s@]+$/;\n            return emailRegex.test(email);\n        },\n\n        /**\n         * Update the summary on the verification step.\n         */\n        updateSummary: function() {\n            var adminName = $('#admin_name').val() || '-';\n            var adminEmail = $('#admin_email').val() || '-';\n\n            $('#summary-admin-name').text(adminName);\n            $('#summary-admin-email').text(adminEmail);\n\n            // Also update hidden form fields.\n            $('#form-admin-name').val(adminName);\n            $('#form-admin-email').val(adminEmail);\n        },\n\n        /**\n         * Submit the registration.\n         */\n        submitRegistration: function() {\n            var self = this;\n\n            // Show loading overlay.\n            this.showLoading();\n\n            // Get form data.\n            var data = {\n                admin_name: this.formData.admin_name || $('#admin_name').val(),\n                admin_email: this.formData.admin_email || $('#admin_email').val()\n            };\n\n            // Make AJAX call to register.\n            Ajax.call([{\n                methodname: 'report_adeptus_insights_register_plugin',\n                args: data,\n                done: function(response) {\n                    self.hideLoading();\n                    if (response.success) {\n                        self.handleRegistrationSuccess(response);\n                    } else {\n                        self.showError(response.message || 'Registration failed');\n                    }\n                },\n                fail: function(error) {\n                    self.hideLoading();\n                    self.showError(error.message || 'An error occurred during registration');\n                }\n            }]);\n        },\n\n        /**\n         * Handle successful registration.\n         *\n         * @param {Object} response The registration response.\n         */\n        handleRegistrationSuccess: function(response) {\n            // Update success details.\n            if (response.data) {\n                if (response.data.installation_id) {\n                    $('#success-installation-id').text(response.data.installation_id);\n                }\n                if (response.data.api_key) {\n                    // Show masked API key.\n                    var maskedKey = response.data.api_key.substring(0, 8) + '...' +\n                        response.data.api_key.substring(response.data.api_key.length - 4);\n                    $('#success-api-key').text(maskedKey);\n                }\n            }\n\n            // Show success step.\n            this.showStep('success');\n        },\n\n        /**\n         * Show loading overlay.\n         */\n        showLoading: function() {\n            $('#loading-overlay').addClass('active');\n        },\n\n        /**\n         * Hide loading overlay.\n         */\n        hideLoading: function() {\n            $('#loading-overlay').removeClass('active');\n        },\n\n        /**\n         * Show error modal.\n         *\n         * @param {string} message The error message.\n         */\n        showError: function(message) {\n            $('#error-message').text(message);\n            $('#error-overlay').addClass('active');\n        },\n\n        /**\n         * Hide error modal.\n         */\n        hideError: function() {\n            $('#error-overlay').removeClass('active');\n        }\n    };\n\n    return Registration;\n});\n"],"names":["define","$","Ajax","Notification","Str","currentStep","formData","init","bindEvents","showStep","self","this","document","on","e","preventDefault","nextStep","data","validateCurrentStep","prevStep","currentStepId","closest","attr","submitRegistration","window","location","href","M","cfg","wwwroot","hideError","updateSummary","stepName","removeClass","addClass","adminName","val","trim","adminEmail","showFieldError","isValidEmail","admin_name","admin_email","selector","message","$field","next","remove","after","one","email","test","text","showLoading","call","methodname","args","done","response","hideLoading","success","handleRegistrationSuccess","showError","fail","error","installation_id","api_key","maskedKey","substring","length"],"mappings":"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"}