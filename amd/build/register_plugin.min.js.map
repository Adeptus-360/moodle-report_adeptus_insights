{"version":3,"file":"register_plugin.min.js","sources":["../src/register_plugin.js"],"sourcesContent":["// This file is part of Moodle - http://moodle.org/\n//\n// Moodle is free software: you can redistribute it and/or modify\n// it under the terms of the GNU General Public License as published by\n// the Free Software Foundation, either version 3 of the License, or\n// (at your option) any later version.\n//\n// Moodle is distributed in the hope that it will be useful,\n// but WITHOUT ANY WARRANTY; without even the implied warranty of\n// MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n// GNU General Public License for more details.\n//\n// You should have received a copy of the GNU General Public License\n// along with Moodle.  If not, see <http://www.gnu.org/licenses/>.\n\n/**\n * Plugin Registration JavaScript Module.\n *\n * Handles form validation and submission for the plugin registration wizard.\n *\n * @module     report_adeptus_insights/register_plugin\n * @package\n * @copyright  2026 Adeptus 360 <info@adeptus360.com>\n * @license    http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later\n */\ndefine(['jquery', 'core/str'], function($, Str) {\n    'use strict';\n\n    /**\n     * Localized strings loaded via core/str API.\n     * @type {Object}\n     */\n    var STRINGS = {};\n\n    /**\n     * Required field configuration.\n     * @type {Array}\n     */\n    var requiredFields = [];\n\n    /**\n     * Load all required localized strings.\n     * @returns {Promise} Promise resolved when strings are loaded\n     */\n    var loadStrings = function() {\n        return Str.get_strings([\n            {key: 'site_name_label', component: 'report_adeptus_insights'},\n            {key: 'site_url_label', component: 'report_adeptus_insights'},\n            {key: 'administrator_name', component: 'report_adeptus_insights'},\n            {key: 'administrator_email', component: 'report_adeptus_insights'},\n            {key: 'moodle_version', component: 'report_adeptus_insights'},\n            {key: 'php_version', component: 'report_adeptus_insights'},\n            {key: 'plugin_version', component: 'report_adeptus_insights'},\n            {key: 'missing_fields_message', component: 'report_adeptus_insights'},\n            {key: 'registration_disabled', component: 'report_adeptus_insights'},\n            {key: 'register_plugin', component: 'report_adeptus_insights'},\n            {key: 'registering', component: 'report_adeptus_insights'}\n        ]).then(function(results) {\n            STRINGS = {\n                siteName: results[0],\n                siteUrl: results[1],\n                administratorName: results[2],\n                administratorEmail: results[3],\n                moodleVersion: results[4],\n                phpVersion: results[5],\n                pluginVersion: results[6],\n                missingFieldsMessage: results[7],\n                registrationDisabled: results[8],\n                registerPlugin: results[9],\n                registering: results[10]\n            };\n            return STRINGS;\n        }).catch(function() {\n            // Fallback strings if loading fails\n            STRINGS = {\n                siteName: 'Site Name',\n                siteUrl: 'Site URL',\n                administratorName: 'Administrator Name',\n                administratorEmail: 'Administrator Email',\n                moodleVersion: 'Moodle Version',\n                phpVersion: 'PHP Version',\n                pluginVersion: 'Plugin Version',\n                missingFieldsMessage: 'The following required fields are missing: {fields}',\n                registrationDisabled: 'Registration Disabled',\n                registerPlugin: 'Register Plugin',\n                registering: 'Registering...'\n            };\n            return STRINGS;\n        });\n    };\n\n    /**\n     * Validate required fields.\n     * @returns {boolean} True if all fields are valid\n     */\n    var validateFields = function() {\n        var missingFields = [];\n        var submitBtn = $('#register-btn');\n        var validationError = $('#validation-error');\n        var validationMessage = $('#validation-message');\n\n        requiredFields.forEach(function(field) {\n            var value = field.value ? field.value.trim() : '';\n            if (!value || value === '' || value === 'undefined' || value === 'null') {\n                missingFields.push(field.name);\n            }\n        });\n\n        if (missingFields.length > 0) {\n            // Show validation error\n            validationError.css('display', 'block');\n            var message = STRINGS.missingFieldsMessage.replace('{fields}',\n                '<strong>' + missingFields.join(', ') + '</strong>');\n            validationMessage.html(message);\n\n            // Disable submit button\n            submitBtn.prop('disabled', true);\n            submitBtn.css({\n                'opacity': '0.5',\n                'cursor': 'not-allowed'\n            });\n            submitBtn.html('<i class=\"fa fa-ban\"></i> ' + STRINGS.registrationDisabled);\n\n            return false;\n        } else {\n            // Hide validation error\n            validationError.css('display', 'none');\n\n            // Enable submit button\n            submitBtn.prop('disabled', false);\n            submitBtn.css({\n                'opacity': '1',\n                'cursor': 'pointer'\n            });\n            submitBtn.html('<i class=\"fa fa-check\"></i> ' + STRINGS.registerPlugin);\n\n            return true;\n        }\n    };\n\n    /**\n     * Initialize event handlers.\n     */\n    var initEventHandlers = function() {\n        var form = $('#registration-form');\n        var submitBtn = $('#register-btn');\n        var loadingOverlay = $('#loading-overlay');\n\n        if (!form.length) {\n            return;\n        }\n\n        form.on('submit', function(e) {\n            // Validate before submitting\n            if (!validateFields()) {\n                e.preventDefault();\n                return false;\n            }\n\n            // Show loading overlay\n            loadingOverlay.css('display', 'block');\n            submitBtn.prop('disabled', true);\n            submitBtn.html('<i class=\"fa fa-spinner fa-spin\"></i> ' + STRINGS.registering);\n\n            // Form will submit normally\n            return true;\n        });\n    };\n\n    return {\n        /**\n         * Initialize the registration module.\n         * @param {Object} config - Configuration object from PHP\n         * @param {Object} config.fieldValues - Values for required fields\n         */\n        init: function(config) {\n            var fieldValues = config.fieldValues || {};\n\n            loadStrings().then(function() {\n                // Build required fields array with current values\n                requiredFields = [\n                    {id: 'site_name', name: STRINGS.siteName, value: fieldValues.siteName || ''},\n                    {id: 'site_url', name: STRINGS.siteUrl, value: fieldValues.siteUrl || ''},\n                    {id: 'admin_name', name: STRINGS.administratorName, value: fieldValues.adminName || ''},\n                    {id: 'admin_email', name: STRINGS.administratorEmail, value: fieldValues.adminEmail || ''},\n                    {id: 'moodle_version', name: STRINGS.moodleVersion, value: fieldValues.moodleVersion || ''},\n                    {id: 'php_version', name: STRINGS.phpVersion, value: fieldValues.phpVersion || ''},\n                    {id: 'plugin_version', name: STRINGS.pluginVersion, value: fieldValues.pluginVersion || ''}\n                ];\n\n                // Run initial validation\n                validateFields();\n\n                // Set up event handlers\n                initEventHandlers();\n            });\n        }\n    };\n});\n"],"names":["define","$","Str","STRINGS","requiredFields","validateFields","missingFields","submitBtn","validationError","validationMessage","forEach","field","value","trim","push","name","length","css","message","missingFieldsMessage","replace","join","html","prop","registrationDisabled","registerPlugin","init","config","fieldValues","get_strings","key","component","then","results","siteName","siteUrl","administratorName","administratorEmail","moodleVersion","phpVersion","pluginVersion","registering","catch","form","loadingOverlay","id","adminName","adminEmail","on","e","preventDefault"],"mappings":"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"}