{"version":3,"file":"lottie_bridge.min.js","sources":["../../src/lib/lottie_bridge.js"],"sourcesContent":["// This file is part of Moodle - http://moodle.org/\n//\n// Moodle is free software: you can redistribute it and/or modify\n// it under the terms of the GNU General Public License as published by\n// the Free Software Foundation, either version 3 of the License, or\n// (at your option) any later version.\n//\n// Moodle is distributed in the hope that it will be useful,\n// but WITHOUT ANY WARRANTY; without even the implied warranty of\n// MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n// GNU General Public License for more details.\n//\n// You should have received a copy of the GNU General Public License\n// along with Moodle.  If not, see <http://www.gnu.org/licenses/>.\n\n/**\n * Lottie bridge module - loads Lottie library dynamically.\n *\n * This module loads the locally bundled Lottie library while avoiding\n * RequireJS AMD conflicts by temporarily hiding the define function\n * during script load.\n *\n * @module     report_adeptus_insights/lib/lottie_bridge\n * @copyright  2026 Adeptus 360 <info@adeptus360.com>\n * @license    http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later\n */\n\ndefine([], function() {\n    'use strict';\n\n    // Return existing lottie if already loaded.\n    if (window.lottie) {\n        return window.lottie;\n    }\n\n    // Create a promise that resolves when Lottie is loaded.\n    var lottiePromise = new Promise(function(resolve) {\n        // Check if already loaded.\n        if (window.lottie) {\n            resolve(window.lottie);\n            return;\n        }\n\n        // Create script element using local bundled file.\n        var script = document.createElement('script');\n        script.src = M.cfg.wwwroot + '/report/adeptus_insights/lib/lottie_animation.js';\n        script.async = true;\n\n        // Temporarily hide define to prevent AMD registration.\n        var originalDefine = window.define;\n        window.define = undefined;\n\n        script.onload = function() {\n            // Restore define.\n            window.define = originalDefine;\n            resolve(window.lottie || window.bodymovin || null);\n        };\n\n        script.onerror = function() {\n            // Restore define on error.\n            window.define = originalDefine;\n            resolve(null);\n        };\n\n        document.head.appendChild(script);\n    });\n\n    // Return an object that proxies to the loaded lottie.\n    // This allows the module to be used synchronously while lottie loads.\n    var proxy = {\n        _ready: false,\n        _lottie: null,\n        _queue: [],\n\n        loadAnimation: function(config) {\n            var self = this;\n            if (self._ready && self._lottie) {\n                return self._lottie.loadAnimation(config);\n            }\n            // Queue the animation load until lottie is ready.\n            lottiePromise.then(function(lottie) {\n                self._ready = true;\n                self._lottie = lottie;\n                if (lottie && typeof lottie.loadAnimation === 'function') {\n                    lottie.loadAnimation(config);\n                }\n            });\n            return null;\n        }\n    };\n\n    // Initialize when lottie loads.\n    lottiePromise.then(function(lottie) {\n        proxy._ready = true;\n        proxy._lottie = lottie;\n    });\n\n    return proxy;\n});\n"],"names":["define","window","lottie","lottiePromise","Promise","resolve","script","document","createElement","src","M","cfg","wwwroot","async","originalDefine","undefined","onload","bodymovin","onerror","head","appendChild","proxy","_ready","_lottie","_queue","loadAnimation","config","self","this","then"],"mappings":";;;;;;;;;;;AA2BAA,mDAAO,IAAI,cAIHC,OAAOC,cACAD,OAAOC,WAIdC,cAAgB,IAAIC,SAAQ,SAASC,YAEjCJ,OAAOC,OACPG,QAAQJ,OAAOC,iBAKfI,OAASC,SAASC,cAAc,UACpCF,OAAOG,IAAMC,EAAEC,IAAIC,QAAU,mDAC7BN,OAAOO,OAAQ,MAGXC,eAAiBb,OAAOD,OAC5BC,OAAOD,YAASe,EAEhBT,OAAOU,OAAS,WAEZf,OAAOD,OAASc,eAChBT,QAAQJ,OAAOC,QAAUD,OAAOgB,WAAa,OAGjDX,OAAOY,QAAU,WAEbjB,OAAOD,OAASc,eAChBT,QAAQ,OAGZE,SAASY,KAAKC,YAAYd,YAK1Be,MAAQ,CACRC,QAAQ,EACRC,QAAS,KACTC,OAAQ,GAERC,cAAe,SAASC,YAChBC,KAAOC,YACPD,KAAKL,QAAUK,KAAKJ,QACbI,KAAKJ,QAAQE,cAAcC,SAGtCvB,cAAc0B,MAAK,SAAS3B,QACxByB,KAAKL,QAAS,EACdK,KAAKJ,QAAUrB,OACXA,QAA0C,mBAAzBA,OAAOuB,eACxBvB,OAAOuB,cAAcC,WAGtB,eAKfvB,cAAc0B,MAAK,SAAS3B,QACxBmB,MAAMC,QAAS,EACfD,MAAME,QAAUrB,UAGbmB"}