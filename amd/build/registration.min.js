/**
 * Registration wizard functionality for Adeptus Insights plugin.
 *
 * @module     report_adeptus_insights/registration
 * @copyright  2026 Adeptus 360 <info@adeptus360.com>
 * @license    http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later
 */
define("report_adeptus_insights/registration",["jquery","core/ajax","core/notification","core/str"],(function($,Ajax,Notification,Str){return{currentStep:"welcome",formData:{},init:function(){this.bindEvents(),this.showStep("welcome")},bindEvents:function(){var self=this;$(document).on("click",".btn-next-step",(function(e){e.preventDefault();var nextStep=$(this).data("step");self.validateCurrentStep()&&self.showStep(nextStep)})),$(document).on("click",".btn-prev-step, .adeptus-btn-back",(function(e){e.preventDefault();var prevStep=$(this).data("step");if(prevStep)self.showStep(prevStep);else{var currentStepId=$(this).closest(".adeptus-wizard-step").attr("id");"step-admin-info"===currentStepId?self.showStep("welcome"):"step-verification"===currentStepId&&self.showStep("admin-info")}})),$(document).on("click","#register-installation",(function(e){e.preventDefault(),self.submitRegistration()})),$(document).on("click","#continue-to-subscription",(function(e){e.preventDefault(),window.location.href=M.cfg.wwwroot+"/report/adeptus_insights/subscription.php"})),$(document).on("click","#go-to-dashboard",(function(e){e.preventDefault(),window.location.href=M.cfg.wwwroot+"/report/adeptus_insights/index.php"})),$(document).on("click","#error-close",(function(e){e.preventDefault(),self.hideError()})),$(document).on("input","#admin_name, #admin_email",(function(){self.updateSummary()}))},showStep:function(stepName){$(".adeptus-wizard-step").removeClass("active"),$("#"+("step-"+stepName)).addClass("active"),this.currentStep=stepName,"verification"===stepName&&this.updateSummary()},validateCurrentStep:function(){if("admin-info"===this.currentStep){var adminName=$("#admin_name").val().trim(),adminEmail=$("#admin_email").val().trim();if(!adminName)return this.showFieldError("#admin_name","Please enter your name"),!1;if(!adminEmail)return this.showFieldError("#admin_email","Please enter your email address"),!1;if(!this.isValidEmail(adminEmail))return this.showFieldError("#admin_email","Please enter a valid email address"),!1;this.formData.admin_name=adminName,this.formData.admin_email=adminEmail}return!0},showFieldError:function(selector,message){var $field=$(selector);$field.addClass("is-invalid"),$field.next(".invalid-feedback").remove(),$field.after('<div class="invalid-feedback">'+message+"</div>"),$field.one("input",(function(){$(this).removeClass("is-invalid"),$(this).next(".invalid-feedback").remove()}))},isValidEmail:function(email){return/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(email)},updateSummary:function(){var adminName=$("#admin_name").val()||"-",adminEmail=$("#admin_email").val()||"-";$("#summary-admin-name").text(adminName),$("#summary-admin-email").text(adminEmail),$("#form-admin-name").val(adminName),$("#form-admin-email").val(adminEmail)},submitRegistration:function(){var self=this;this.showLoading();var data={admin_name:this.formData.admin_name||$("#admin_name").val(),admin_email:this.formData.admin_email||$("#admin_email").val()};Ajax.call([{methodname:"report_adeptus_insights_register_plugin",args:data,done:function(response){self.hideLoading(),response.success?self.handleRegistrationSuccess(response):self.showError(response.message||"Registration failed")},fail:function(error){self.hideLoading(),self.showError(error.message||"An error occurred during registration")}}])},handleRegistrationSuccess:function(response){if(response.data&&(response.data.installation_id&&$("#success-installation-id").text(response.data.installation_id),response.data.api_key)){var maskedKey=response.data.api_key.substring(0,8)+"..."+response.data.api_key.substring(response.data.api_key.length-4);$("#success-api-key").text(maskedKey)}this.showStep("success")},showLoading:function(){$("#loading-overlay").addClass("active")},hideLoading:function(){$("#loading-overlay").removeClass("active")},showError:function(message){$("#error-message").text(message),$("#error-overlay").addClass("active")},hideError:function(){$("#error-overlay").removeClass("active")}}}));

//# sourceMappingURL=registration.min.js.map