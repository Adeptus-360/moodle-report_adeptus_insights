{"version":3,"file":"generated_reports.min.js","sources":["../src/generated_reports.js"],"sourcesContent":["// This file is part of Moodle - http://moodle.org/\n//\n// Moodle is free software: you can redistribute it and/or modify\n// it under the terms of the GNU General Public License as published by\n// the Free Software Foundation, either version 3 of the License, or\n// (at your option) any later version.\n//\n// Moodle is distributed in the hope that it will be useful,\n// but WITHOUT ANY WARRANTY; without even the implied warranty of\n// MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n// GNU General Public License for more details.\n//\n// You should have received a copy of the GNU General Public License\n// along with Moodle.  If not, see <http://www.gnu.org/licenses/>.\n\n/**\n * Generated Reports AMD module for Adeptus Insights.\n *\n * @module     report_adeptus_insights/generated_reports\n * @copyright  2026 Adeptus 360 <info@adeptus360.com>\n * @license    http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later\n */\n\ndefine(['jquery', 'core/ajax', 'core/str', 'core/chartjs'], function($, Ajax, Str, Chart) {\n    'use strict';\n\n    /**\n     * String storage object - populated from core/str.\n     * @type {Object}\n     */\n    var STRINGS = {};\n\n    /**\n     * Load all localized strings from Moodle's language API.\n     * @returns {Promise}\n     */\n    var loadStrings = function() {\n        return Str.get_strings([\n            // General\n            {key: 'general', component: 'report_adeptus_insights'},\n            {key: 'wizard', component: 'report_adeptus_insights'},\n            {key: 'ai', component: 'report_adeptus_insights'},\n            {key: 'report', component: 'report_adeptus_insights'},\n            {key: 'report_details', component: 'report_adeptus_insights'},\n            {key: 'untitled_report', component: 'report_adeptus_insights'},\n            {key: 'unknown', component: 'report_adeptus_insights'},\n            {key: 'rows', component: 'report_adeptus_insights'},\n            {key: 'table', component: 'report_adeptus_insights'},\n            {key: 'chart', component: 'report_adeptus_insights'},\n            {key: 'retry', component: 'report_adeptus_insights'},\n            {key: 'cancel', component: 'report_adeptus_insights'},\n            {key: 'error', component: 'report_adeptus_insights'},\n            // Export\n            {key: 'export_pdf', component: 'report_adeptus_insights'},\n            {key: 'export_csv', component: 'report_adeptus_insights'},\n            {key: 'export_json', component: 'report_adeptus_insights'},\n            {key: 'exporting_as', component: 'report_adeptus_insights'},\n            {key: 'export_not_available', component: 'report_adeptus_insights'},\n            {key: 'export_not_eligible', component: 'report_adeptus_insights'},\n            {key: 'export_failed', component: 'report_adeptus_insights'},\n            {key: 'export_failed_message', component: 'report_adeptus_insights'},\n            {key: 'file_downloaded_success', component: 'report_adeptus_insights'},\n            {key: 'no_data', component: 'report_adeptus_insights'},\n            {key: 'no_data_to_export', component: 'report_adeptus_insights'},\n            {key: 'no_data_available', component: 'report_adeptus_insights'},\n            {key: 'no_data_rows', component: 'report_adeptus_insights'},\n            // Premium\n            {key: 'premium_export_format', component: 'report_adeptus_insights'},\n            {key: 'premium_feature', component: 'report_adeptus_insights'},\n            {key: 'upgrade_now', component: 'report_adeptus_insights'},\n            {key: 'free_plan_label', component: 'report_adeptus_insights'},\n            {key: 'free_plan_pdf_only', component: 'report_adeptus_insights'},\n            {key: 'paid_plans_label', component: 'report_adeptus_insights'},\n            {key: 'paid_plans_all_formats', component: 'report_adeptus_insights'},\n            {key: 'export_upgrade_message', component: 'report_adeptus_insights'},\n            // Categories\n            {key: 'categories', component: 'report_adeptus_insights'},\n            {key: 'create_new_category', component: 'report_adeptus_insights'},\n            {key: 'custom_color', component: 'report_adeptus_insights'},\n            {key: 'your_categories', component: 'report_adeptus_insights'},\n            {key: 'default_categories', component: 'report_adeptus_insights'},\n            {key: 'read_only', component: 'report_adeptus_insights'},\n            {key: 'no_custom_categories', component: 'report_adeptus_insights'},\n            {key: 'create_first_category', component: 'report_adeptus_insights'},\n            {key: 'category_created', component: 'report_adeptus_insights'},\n            {key: 'category_updated', component: 'report_adeptus_insights'},\n            {key: 'category_deleted', component: 'report_adeptus_insights'},\n            {key: 'edit_category', component: 'report_adeptus_insights'},\n            {key: 'delete_category', component: 'report_adeptus_insights'},\n            {key: 'delete_category_confirm', component: 'report_adeptus_insights'},\n            {key: 'delete_category_warning', component: 'report_adeptus_insights'},\n            {key: 'yes_delete', component: 'report_adeptus_insights'},\n            {key: 'category_name', component: 'report_adeptus_insights'},\n            {key: 'please_enter_category_name', component: 'report_adeptus_insights'},\n            {key: 'name', component: 'report_adeptus_insights'},\n            {key: 'color', component: 'report_adeptus_insights'},\n            {key: 'custom', component: 'report_adeptus_insights'},\n            {key: 'save_changes', component: 'report_adeptus_insights'},\n            // Reports\n            {key: 'select_a_report', component: 'report_adeptus_insights'},\n            {key: 'no_report_selected', component: 'report_adeptus_insights'},\n            {key: 'delete_report', component: 'report_adeptus_insights'},\n            {key: 'delete_report_confirm', component: 'report_adeptus_insights'},\n            {key: 'delete_report_warning', component: 'report_adeptus_insights'},\n            {key: 'deleting_report', component: 'report_adeptus_insights'},\n            {key: 'deleting_report_wait', component: 'report_adeptus_insights'},\n            {key: 'delete_failed', component: 'report_adeptus_insights'},\n            {key: 'report_deleted_success', component: 'report_adeptus_insights'},\n            {key: 'report_count', component: 'report_adeptus_insights'},\n            {key: 'reports_count', component: 'report_adeptus_insights'},\n            {key: 'you_have_reports_saved', component: 'report_adeptus_insights'},\n            // Loading/Errors\n            {key: 'session_expired', component: 'report_adeptus_insights'},\n            {key: 'refresh_page', component: 'report_adeptus_insights'},\n            {key: 'refresh_page_to_continue', component: 'report_adeptus_insights'},\n            {key: 'failed_to_load_reports', component: 'report_adeptus_insights'},\n            {key: 'try_again_later', component: 'report_adeptus_insights'},\n            {key: 'failed_to_execute_report', component: 'report_adeptus_insights'},\n            {key: 'failed_to_load_report_details', component: 'report_adeptus_insights'},\n            {key: 'failed_to_generate_report', component: 'report_adeptus_insights'},\n            {key: 'failed_to_execute_wizard_report', component: 'report_adeptus_insights'},\n            {key: 'authentication_required', component: 'report_adeptus_insights'},\n            {key: 'authentication_required_message', component: 'report_adeptus_insights'},\n            // DataTable\n            {key: 'search_reports', component: 'report_adeptus_insights'},\n            {key: 'no_reports_found', component: 'report_adeptus_insights'},\n            {key: 'showing_reports', component: 'report_adeptus_insights'},\n            {key: 'showing_first_rows', component: 'report_adeptus_insights'},\n            {key: 'export_to_see_all', component: 'report_adeptus_insights'},\n            // Chart\n            {key: 'chart_type', component: 'report_adeptus_insights'},\n            {key: 'bar_chart', component: 'report_adeptus_insights'},\n            {key: 'line_chart', component: 'report_adeptus_insights'},\n            {key: 'pie_chart', component: 'report_adeptus_insights'},\n            {key: 'doughnut_chart', component: 'report_adeptus_insights'},\n            {key: 'x_axis_labels', component: 'report_adeptus_insights'},\n            {key: 'y_axis_values', component: 'report_adeptus_insights'},\n            {key: 'error_rendering_chart', component: 'report_adeptus_insights'},\n            {key: 'loading', component: 'report_adeptus_insights'}\n        ]).then(function(results) {\n            // Map results to keys\n            var keys = [\n                'general', 'wizard', 'ai', 'report', 'reportDetails', 'untitledReport',\n                'unknown', 'rows', 'table', 'chart', 'retry', 'cancel', 'error',\n                'exportPdf', 'exportCsv', 'exportJson', 'exportingAs', 'exportNotAvailable',\n                'exportNotEligible', 'exportFailed', 'exportFailedMessage', 'fileDownloadedSuccess',\n                'noData', 'noDataToExport', 'noDataAvailable', 'noDataRows',\n                'premiumExportFormat', 'premiumFeature', 'upgradeNow', 'freePlan',\n                'freePlanPdfOnly', 'paidPlans', 'paidPlansAllFormats', 'exportUpgradeMessage',\n                'categories', 'createNewCategory', 'customColor', 'yourCategories',\n                'defaultCategories', 'readOnly', 'noCustomCategories', 'createFirstCategory',\n                'categoryCreated', 'categoryUpdated', 'categoryDeleted', 'editCategory',\n                'deleteCategory', 'deleteCategoryConfirm', 'deleteCategoryWarning', 'yesDelete',\n                'categoryName', 'pleaseEnterCategoryName', 'name', 'color', 'custom', 'saveChanges',\n                'selectAReport', 'noReportSelected', 'deleteReport', 'deleteReportConfirm',\n                'deleteReportWarning', 'deletingReport', 'deletingReportWait', 'deleteFailed',\n                'reportDeletedSuccess', 'reportCount', 'reportsCount', 'youHaveReportsSaved',\n                'sessionExpired', 'refreshPage', 'refreshPageToContinue', 'failedToLoadReports',\n                'tryAgainLater', 'failedToExecuteReport', 'failedToLoadReportDetails',\n                'failedToGenerateReport', 'failedToExecuteWizardReport',\n                'authenticationRequired', 'authenticationRequiredMessage',\n                'searchReports', 'noReportsFound', 'showingReports', 'showingFirstRows', 'exportToSeeAll',\n                'chartType', 'barChart', 'lineChart', 'pieChart', 'doughnutChart',\n                'xAxisLabels', 'yAxisValues', 'errorRenderingChart', 'loading'\n            ];\n            keys.forEach(function(key, index) {\n                STRINGS[key] = results[index] || key;\n            });\n            return STRINGS;\n        }).catch(function() {\n            // Provide fallback strings if loading fails\n            STRINGS = {\n                general: 'General',\n                wizard: 'Wizard',\n                ai: 'AI',\n                report: 'Report',\n                reportDetails: 'Report Details',\n                untitledReport: 'Untitled Report',\n                unknown: 'Unknown',\n                rows: 'rows',\n                table: 'Table',\n                chart: 'Chart',\n                retry: 'Retry',\n                cancel: 'Cancel',\n                error: 'Error',\n                exportPdf: 'Export PDF',\n                exportCsv: 'Export CSV',\n                exportJson: 'Export JSON',\n                exportingAs: 'Exporting as {format}...',\n                exportNotAvailable: 'Export Not Available',\n                exportNotEligible: 'Export not eligible',\n                exportFailed: 'Export Failed',\n                exportFailedMessage: 'Failed to export report',\n                fileDownloadedSuccess: 'file downloaded successfully',\n                noData: 'No Data',\n                noDataToExport: 'No data to export',\n                noDataAvailable: 'No data available',\n                noDataRows: 'This report contains no data rows',\n                premiumExportFormat: 'Premium Export Format',\n                premiumFeature: 'Premium Feature',\n                upgradeNow: 'Upgrade Now',\n                freePlan: 'Free Plan:',\n                freePlanPdfOnly: 'PDF export only',\n                paidPlans: 'Paid Plans:',\n                paidPlansAllFormats: 'All formats (PDF, CSV, JSON)',\n                exportUpgradeMessage: '{format} export requires a paid plan',\n                categories: 'Categories',\n                createNewCategory: 'Create New Category',\n                customColor: 'Custom color',\n                yourCategories: 'Your Categories',\n                defaultCategories: 'Default Categories',\n                readOnly: 'Read Only',\n                noCustomCategories: 'No custom categories yet',\n                createFirstCategory: 'Create your first category above',\n                categoryCreated: 'Category Created',\n                categoryUpdated: 'Category Updated',\n                categoryDeleted: 'Category Deleted',\n                editCategory: 'Edit Category',\n                deleteCategory: 'Delete Category',\n                deleteCategoryConfirm: 'Delete Category?',\n                deleteCategoryWarning: 'Are you sure you want to delete {name}?',\n                yesDelete: 'Yes, Delete',\n                categoryName: 'Category name',\n                pleaseEnterCategoryName: 'Please enter a category name',\n                name: 'Name',\n                color: 'Color',\n                custom: 'Custom',\n                saveChanges: 'Save Changes',\n                selectAReport: 'Select a Report',\n                noReportSelected: 'No Report Selected',\n                deleteReport: 'Delete Report',\n                deleteReportConfirm: 'Delete Report?',\n                deleteReportWarning: 'Are you sure you want to delete {name}?',\n                deletingReport: 'Deleting Report',\n                deletingReportWait: 'Please wait...',\n                deleteFailed: 'Delete Failed',\n                reportDeletedSuccess: 'Report deleted successfully',\n                reportCount: '1 report',\n                reportsCount: 'reports',\n                youHaveReportsSaved: 'You have {count} saved',\n                sessionExpired: 'Session Expired',\n                refreshPage: 'Refresh Page',\n                refreshPageToContinue: 'Please refresh the page to continue',\n                failedToLoadReports: 'Failed to Load Reports',\n                tryAgainLater: 'Please try again later',\n                failedToExecuteReport: 'Failed to execute report',\n                failedToLoadReportDetails: 'Failed to load report details',\n                failedToGenerateReport: 'Failed to generate report',\n                failedToExecuteWizardReport: 'Failed to execute wizard report',\n                authenticationRequired: 'Authentication Required',\n                authenticationRequiredMessage: 'Please ensure you are logged in',\n                searchReports: 'Search reports...',\n                noReportsFound: 'No reports found',\n                showingReports: 'Showing reports',\n                showingFirstRows: 'Showing first {first} of {total} rows',\n                exportToSeeAll: 'Export to see all data',\n                chartType: 'Chart Type',\n                barChart: 'Bar Chart',\n                lineChart: 'Line Chart',\n                pieChart: 'Pie Chart',\n                doughnutChart: 'Doughnut Chart',\n                xAxisLabels: 'X-Axis (Labels)',\n                yAxisValues: 'Y-Axis (Values)',\n                errorRenderingChart: 'Error rendering chart',\n                loading: 'Loading...'\n            };\n            return STRINGS;\n        });\n    };\n\n    /**\n     * Main GeneratedReports object.\n     * @type {Object}\n     */\n    var GeneratedReports = {\n        backendUrl: '',\n        cachedReports: [],\n        cachedCategories: [],\n        currentReport: null,\n        currentReportData: null,\n        reportsDataTable: null,\n        retryCount: 0,\n        maxRetries: 3,\n        currentView: 'table',\n        chartInstance: null,\n        Chart: Chart,\n        strings: STRINGS,\n        isFreePlan: true,\n\n        /**\n         * Initialize the module.\n         * @param {Object} config - Configuration object from PHP.\n         */\n        init: function(config) {\n            var self = this;\n            self.backendUrl = config.backendUrl || '';\n            self.isFreePlan = config.isFreePlan !== false;\n            self.strings = STRINGS;\n\n            self.loadReports();\n            self.loadCategories();\n            self.bindViewToggle();\n            self.bindCategoryManagement();\n        },\n\n        /**\n         * Show upgrade prompt for premium export formats.\n         * @param {string} format - The export format.\n         */\n        showExportUpgradePrompt: function(format) {\n            var subscriptionUrl = M.cfg.wwwroot + '/report/adeptus_insights/subscription.php';\n            var formatNames = {\n                'csv': 'CSV',\n                'excel': 'Excel',\n                'json': 'JSON'\n            };\n            var formatName = formatNames[format] || format.toUpperCase();\n\n            Swal.fire({\n                title: STRINGS.premiumExportFormat,\n                html: '<div style=\"text-align: center; padding: 20px;\">' +\n                    '<div style=\"font-size: 48px; color: #f39c12; margin-bottom: 15px;\">' +\n                    '<i class=\"fa fa-crown\"></i></div>' +\n                    '<h3 style=\"color: #2c3e50; margin-bottom: 15px;\">' + formatName + ' ' + STRINGS.premiumFeature + '</h3>' +\n                    '<p style=\"color: #7f8c8d; font-size: 16px; line-height: 1.6; margin-bottom: 25px;\">' +\n                    STRINGS.exportUpgradeMessage.replace('{format}', formatName) + '</p>' +\n                    '<div style=\"background: #ecf0f1; padding: 15px; border-radius: 8px; margin-bottom: 20px;\">' +\n                    '<p style=\"margin: 0; font-size: 14px; color: #34495e;\">' +\n                    '<strong>' + STRINGS.freePlan + '</strong> ' + STRINGS.freePlanPdfOnly + '<br>' +\n                    '<strong>' + STRINGS.paidPlans + '</strong> ' + STRINGS.paidPlansAllFormats + '</p></div></div>',\n                showCancelButton: true,\n                confirmButtonText: '<i class=\"fa fa-arrow-up\"></i> ' + STRINGS.upgradeNow,\n                cancelButtonText: '<i class=\"fa fa-times\"></i> ' + STRINGS.cancel,\n                confirmButtonColor: '#3498db',\n                cancelButtonColor: '#95a5a6',\n                width: 500\n            }).then(function(result) {\n                if (result.isConfirmed) {\n                    window.open(subscriptionUrl, '_blank');\n                }\n            });\n        },\n\n        /**\n         * Check export eligibility before exporting using external service.\n         * @param {string} format - The export format.\n         * @returns {Promise}\n         */\n        checkExportEligibility: function(format) {\n            return new Promise(function(resolve) {\n                Ajax.call([{\n                    methodname: 'report_adeptus_insights_check_export_eligibility',\n                    args: {format: format}\n                }])[0].done(function(result) {\n                    var data = result.data ? result.data : result;\n                    resolve(data);\n                }).fail(function(error) {\n                    window.console.error('Error checking export eligibility:', error);\n                    resolve({success: false, eligible: false, message: 'Unable to verify export eligibility.'});\n                });\n            });\n        },\n\n        /**\n         * Capture chart as image for PDF export.\n         * Uses native toDataURL with html2canvas fallback.\n         * @returns {Promise}\n         */\n        captureChartImage: function() {\n            var self = this;\n\n            return new Promise(function(resolve) {\n                // Wait for chart animation to complete\n                setTimeout(function() {\n                    var chartCanvas = document.getElementById('report-chart');\n                    if (!chartCanvas) {\n                        window.console.warn('[GeneratedReports] Chart canvas not found');\n                        resolve(null);\n                        return;\n                    }\n\n                    // Method 1: Native canvas toDataURL (fastest, most reliable)\n                    try {\n                        var dataUrl = chartCanvas.toDataURL('image/png', 0.8);\n                        if (dataUrl && dataUrl.length > 100 && dataUrl.length < 2000000) {\n                            window.console.log('[GeneratedReports] Chart captured via toDataURL, size:', dataUrl.length);\n                            resolve(dataUrl);\n                            return;\n                        }\n                    } catch (e) {\n                        window.console.warn('[GeneratedReports] Native canvas capture failed:', e);\n                    }\n\n                    // Method 2: html2canvas fallback (handles CORS/tainted canvas)\n                    self.loadHtml2Canvas().then(function() {\n                        if (window.html2canvas) {\n                            window.html2canvas(chartCanvas, {\n                                backgroundColor: '#ffffff',\n                                scale: 1.5,\n                                useCORS: true,\n                                allowTaint: true,\n                                logging: false\n                            }).then(function(capturedCanvas) {\n                                var dataUrl = capturedCanvas.toDataURL('image/png', 0.8);\n                                if (dataUrl && dataUrl.length > 100 && dataUrl.length < 2000000) {\n                                    window.console.log('[GeneratedReports] Chart captured via html2canvas, size:', dataUrl.length);\n                                    resolve(dataUrl);\n                                    return;\n                                }\n                                resolve(null);\n                            }).catch(function() {\n                                resolve(null);\n                            });\n                        } else {\n                            resolve(null);\n                        }\n                    }).catch(function() {\n                        resolve(null);\n                    });\n                }, 300);\n            });\n        },\n\n        /**\n         * Load html2canvas library bundled with the plugin.\n         * @returns {Promise}\n         */\n        loadHtml2Canvas: function() {\n            return new Promise(function(resolve, reject) {\n                if (window.html2canvas) {\n                    resolve();\n                    return;\n                }\n                var script = document.createElement('script');\n                script.src = M.cfg.wwwroot + '/report/adeptus_insights/lib/html2canvas/html2canvas.min.js';\n                script.onload = function() {\n                    resolve();\n                };\n                script.onerror = function() {\n                    reject(new Error('Failed to load html2canvas'));\n                };\n                document.head.appendChild(script);\n            });\n        },\n\n        /**\n         * Show toast notification.\n         * @param {string} message - The message to display.\n         * @param {string} type - The type of toast (success, error, warning, info).\n         */\n        showToast: function(message, type) {\n            type = type || 'success';\n            var toastContainer = document.getElementById('adeptus-toast-container');\n            if (!toastContainer) {\n                toastContainer = document.createElement('div');\n                toastContainer.id = 'adeptus-toast-container';\n                toastContainer.style.cssText = 'position: fixed; top: 20px; right: 20px; z-index: 10000;';\n                document.body.appendChild(toastContainer);\n            }\n\n            var iconMap = {\n                'success': 'fa-check-circle',\n                'error': 'fa-times-circle',\n                'warning': 'fa-exclamation-triangle',\n                'info': 'fa-info-circle'\n            };\n            var bgColorMap = {\n                'success': '#28a745',\n                'error': '#dc3545',\n                'warning': '#ffc107',\n                'info': '#17a2b8'\n            };\n            var textColorMap = {\n                'success': 'white',\n                'error': 'white',\n                'warning': '#212529',\n                'info': 'white'\n            };\n\n            var toast = document.createElement('div');\n            toast.style.cssText = 'background: ' + bgColorMap[type] + '; color: ' + textColorMap[type] +\n                '; padding: 12px 20px; border-radius: 8px; margin-bottom: 10px; box-shadow: 0 4px 12px rgba(0,0,0,0.15);' +\n                ' display: flex; align-items: center; gap: 10px; animation: slideIn 0.3s ease; min-width: 280px;';\n            toast.innerHTML = '<i class=\"fa ' + iconMap[type] + '\"></i><span>' + message + '</span>';\n            toastContainer.appendChild(toast);\n\n            setTimeout(function() {\n                toast.style.animation = 'slideOut 0.3s ease forwards';\n                setTimeout(function() {\n                    if (toast.parentNode) {\n                        toast.parentNode.removeChild(toast);\n                    }\n                }, 300);\n            }, 3000);\n        },\n\n        /**\n         * Track export for usage monitoring.\n         * @param {string} format - The export format.\n         * @param {string} reportName - The report name.\n         */\n        trackExport: function(format, reportName) {\n            fetch(M.cfg.wwwroot + '/report/adeptus_insights/ajax/track_export.php', {\n                method: 'POST',\n                headers: {\n                    'Content-Type': 'application/x-www-form-urlencoded',\n                },\n                body: 'format=' + encodeURIComponent(format) + '&report_name=' + encodeURIComponent(reportName) +\n                    '&sesskey=' + M.cfg.sesskey\n            })\n            .then(function(response) {\n                return response.json();\n            })\n            .then(function(data) {\n                window.console.log('[GeneratedReports] Export tracked:', data);\n            })\n            .catch(function(error) {\n                window.console.error('[GeneratedReports] Error tracking export:', error);\n            });\n        },\n\n        /**\n         * Bind view toggle button handlers.\n         */\n        bindViewToggle: function() {\n            var self = this;\n            $(document).on('click', '.adeptus-view-toggle-btn', function() {\n                var view = $(this).data('view');\n                self.switchView(view);\n            });\n            $(document).on('change', '#chart-type-select, #chart-x-axis, #chart-y-axis', function() {\n                self.renderChart();\n            });\n        },\n\n        /**\n         * Bind category management button handler.\n         */\n        bindCategoryManagement: function() {\n            var self = this;\n            $('#manage-categories-btn').on('click', function() {\n                self.showCategoryManagementModal();\n            });\n        },\n\n        /**\n         * Load categories from server.\n         */\n        loadCategories: function() {\n            var self = this;\n\n            $.ajax({\n                url: M.cfg.wwwroot + '/report/adeptus_insights/ajax/manage_category.php',\n                method: 'POST',\n                dataType: 'json',\n                data: {\n                    action: 'list',\n                    sesskey: M.cfg.sesskey\n                },\n                success: function(response) {\n                    if (response.success && response.data) {\n                        self.cachedCategories = response.data;\n                        // Enrich reports with category info now that categories are loaded.\n                        if (self.cachedReports && self.cachedReports.length > 0) {\n                            self.enrichReportsWithCategoryInfo();\n                        }\n                    }\n                },\n                error: function() {\n                    self.cachedCategories = [];\n                }\n            });\n        },\n\n        /**\n         * Enrich cached reports with category_info from cached categories.\n         * This ensures category colors and full info are available after page refresh.\n         */\n        enrichReportsWithCategoryInfo: function() {\n            var self = this;\n            if (!this.cachedCategories || this.cachedCategories.length === 0) {\n                return;\n            }\n\n            this.cachedReports.forEach(function(report) {\n                // Skip if already has full category_info.\n                if (report.category_info && report.category_info.id && report.category_info.color) {\n                    return;\n                }\n\n                var matchedCategory = null;\n\n                // Try to match by category_id first.\n                if (report.category_id) {\n                    matchedCategory = self.cachedCategories.find(function(c) {\n                        return c.id === report.category_id || c.id === parseInt(report.category_id, 10);\n                    });\n                }\n\n                // Try to match by category name if no id match.\n                if (!matchedCategory && report.category) {\n                    matchedCategory = self.cachedCategories.find(function(c) {\n                        return c.name && c.name.toLowerCase() === report.category.toLowerCase();\n                    });\n                }\n\n                // Try to match by category_info.name if available.\n                if (!matchedCategory && report.category_info && report.category_info.name) {\n                    matchedCategory = self.cachedCategories.find(function(c) {\n                        return c.name && c.name.toLowerCase() === report.category_info.name.toLowerCase();\n                    });\n                }\n\n                // Build category_info from matched category or defaults.\n                if (matchedCategory) {\n                    report.category_info = {\n                        id: matchedCategory.id,\n                        name: matchedCategory.name,\n                        color: matchedCategory.color || '#6c757d'\n                    };\n                    report.category = matchedCategory.name;\n                    report.category_id = matchedCategory.id;\n                } else {\n                    // Default to General if no match found.\n                    var generalCat = self.cachedCategories.find(function(c) {\n                        return c.name && c.name.toLowerCase() === 'general';\n                    });\n                    if (generalCat) {\n                        report.category_info = {\n                            id: generalCat.id,\n                            name: generalCat.name,\n                            color: generalCat.color || '#6c757d'\n                        };\n                    }\n                }\n            });\n        },\n\n        /**\n         * Show category management modal.\n         */\n        showCategoryManagementModal: function() {\n            var self = this;\n\n            // Separate system and custom categories\n            var systemCategories = self.cachedCategories.filter(function(c) {\n                return c.is_system;\n            });\n            var customCategories = self.cachedCategories.filter(function(c) {\n                return !c.is_system;\n            });\n\n            // Preset colors for quick selection\n            var presetColors = ['#3b82f6', '#10b981', '#f59e0b', '#ef4444', '#8b5cf6', '#ec4899', '#06b6d4', '#84cc16'];\n\n            // Build custom categories HTML\n            var customCategoriesHtml = customCategories.length > 0 ?\n                customCategories.map(function(cat) {\n                    return '<div class=\"adeptus-cat-card\" data-id=\"' + cat.id + '\">' +\n                        '<div class=\"adeptus-cat-card-color\" style=\"background: ' + (cat.color || '#6c757d') + ';\"></div>' +\n                        '<div class=\"adeptus-cat-card-content\">' +\n                            '<div class=\"adeptus-cat-card-name\">' + cat.name + '</div>' +\n                            '<div class=\"adeptus-cat-card-meta\">' + (cat.report_count || 0) + ' report' +\n                            (cat.report_count !== 1 ? 's' : '') + '</div>' +\n                        '</div>' +\n                        '<div class=\"adeptus-cat-card-actions\">' +\n                            '<button class=\"adeptus-cat-action-btn edit-cat-btn\" data-id=\"' + cat.id + '\" title=\"Edit\">' +\n                                '<svg width=\"16\" height=\"16\" viewBox=\"0 0 24 24\" fill=\"none\" stroke=\"currentColor\" ' +\n                                'stroke-width=\"2\"><path d=\"M11 4H4a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2v-7\">' +\n                                '</path><path d=\"M18.5 2.5a2.121 2.121 0 0 1 3 3L12 15l-4 1 1-4 9.5-9.5z\"></path></svg>' +\n                            '</button>' +\n                            '<button class=\"adeptus-cat-action-btn adeptus-cat-action-btn-danger delete-cat-btn\" ' +\n                            'data-id=\"' + cat.id + '\" title=\"Delete\">' +\n                                '<svg width=\"16\" height=\"16\" viewBox=\"0 0 24 24\" fill=\"none\" stroke=\"currentColor\" ' +\n                                'stroke-width=\"2\"><polyline points=\"3 6 5 6 21 6\"></polyline><path d=\"M19 6v14a2 2 0 ' +\n                                '0 1-2 2H7a2 2 0 0 1-2-2V6m3 0V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2\"></path></svg>' +\n                            '</button>' +\n                        '</div>' +\n                    '</div>';\n                }).join('') :\n                '<div class=\"adeptus-cat-empty-state\">' +\n                    '<div class=\"adeptus-cat-empty-icon\">' +\n                        '<svg width=\"48\" height=\"48\" viewBox=\"0 0 24 24\" fill=\"none\" stroke=\"currentColor\" ' +\n                        'stroke-width=\"1.5\"><path d=\"M22 19a2 2 0 0 1-2 2H4a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h5l2 3h9a2 ' +\n                        '2 0 0 1 2 2z\"></path><line x1=\"12\" y1=\"11\" x2=\"12\" y2=\"17\"></line><line x1=\"9\" y1=\"14\" ' +\n                        'x2=\"15\" y2=\"14\"></line></svg>' +\n                    '</div>' +\n                    '<div class=\"adeptus-cat-empty-text\">' + STRINGS.noCustomCategories + '</div>' +\n                    '<div class=\"adeptus-cat-empty-hint\">' + STRINGS.createFirstCategory + '</div>' +\n                '</div>';\n\n            // Build system categories HTML\n            var systemCategoriesHtml = systemCategories.map(function(cat) {\n                return '<div class=\"adeptus-cat-system-item\">' +\n                    '<span class=\"adeptus-cat-system-dot\" style=\"background: ' + (cat.color || '#6c757d') + ';\"></span>' +\n                    '<span class=\"adeptus-cat-system-name\">' + cat.name + '</span>' +\n                    '<span class=\"adeptus-cat-system-count\">' + (cat.report_count || 0) + '</span>' +\n                '</div>';\n            }).join('');\n\n            // Build color swatches HTML\n            var colorSwatchesHtml = presetColors.map(function(color) {\n                return '<button type=\"button\" class=\"adeptus-cat-color-swatch\" data-color=\"' + color +\n                    '\" style=\"background: ' + color + ';\"></button>';\n            }).join('');\n\n            Swal.fire({\n                title: STRINGS.categories,\n                html: '<div class=\"adeptus-cat-modal\">' +\n                    '<div class=\"adeptus-cat-add-section\">' +\n                        '<div class=\"adeptus-cat-add-header\">' + STRINGS.createNewCategory + '</div>' +\n                        '<div class=\"adeptus-cat-add-form\">' +\n                            '<div class=\"adeptus-cat-add-input-wrapper\">' +\n                                '<input type=\"text\" id=\"new-category-name\" class=\"adeptus-cat-add-input\" ' +\n                                'placeholder=\"' + STRINGS.categoryName + '\">' +\n                                '<div class=\"adeptus-cat-add-color-wrapper\">' +\n                                    '<button type=\"button\" class=\"adeptus-cat-add-color-btn\" id=\"color-picker-toggle\">' +\n                                        '<span class=\"adeptus-cat-add-color-preview\" id=\"selected-color-preview\" ' +\n                                        'style=\"background: #3b82f6;\"></span>' +\n                                        '<svg width=\"12\" height=\"12\" viewBox=\"0 0 24 24\" fill=\"none\" ' +\n                                        'stroke=\"currentColor\" stroke-width=\"2\"><polyline points=\"6 9 12 15 18 9\">' +\n                                        '</polyline></svg>' +\n                                    '</button>' +\n                                    '<div class=\"adeptus-cat-color-dropdown\" id=\"color-dropdown\">' +\n                                        '<div class=\"adeptus-cat-color-swatches\">' + colorSwatchesHtml + '</div>' +\n                                        '<div class=\"adeptus-cat-color-custom\">' +\n                                            '<input type=\"color\" id=\"new-category-color\" value=\"#3b82f6\">' +\n                                            '<span>' + STRINGS.customColor + '</span>' +\n                                        '</div>' +\n                                    '</div>' +\n                                '</div>' +\n                            '</div>' +\n                            '<button type=\"button\" class=\"adeptus-cat-add-btn\" id=\"add-category-btn\">' +\n                                '<svg width=\"18\" height=\"18\" viewBox=\"0 0 24 24\" fill=\"none\" stroke=\"currentColor\" ' +\n                                'stroke-width=\"2.5\"><line x1=\"12\" y1=\"5\" x2=\"12\" y2=\"19\"></line><line x1=\"5\" y1=\"12\" ' +\n                                'x2=\"19\" y2=\"12\"></line></svg> Add' +\n                            '</button>' +\n                        '</div>' +\n                    '</div>' +\n                    '<div class=\"adeptus-cat-section\">' +\n                        '<div class=\"adeptus-cat-section-header\">' +\n                            '<span class=\"adeptus-cat-section-title\">' + STRINGS.yourCategories + '</span>' +\n                            '<span class=\"adeptus-cat-section-count\">' + customCategories.length + '</span>' +\n                        '</div>' +\n                        '<div class=\"adeptus-cat-cards-list\">' + customCategoriesHtml + '</div>' +\n                    '</div>' +\n                    '<div class=\"adeptus-cat-section adeptus-cat-section-system\">' +\n                        '<div class=\"adeptus-cat-section-header\">' +\n                            '<span class=\"adeptus-cat-section-title\">' + STRINGS.defaultCategories + '</span>' +\n                            '<span class=\"adeptus-cat-section-badge\">' + STRINGS.readOnly + '</span>' +\n                        '</div>' +\n                        '<div class=\"adeptus-cat-system-list\">' + systemCategoriesHtml + '</div>' +\n                    '</div>' +\n                '</div>',\n                showConfirmButton: false,\n                showCloseButton: true,\n                width: '480px',\n                customClass: {\n                    popup: 'adeptus-cat-modal-popup',\n                    title: 'adeptus-cat-modal-title',\n                    closeButton: 'adeptus-cat-modal-close',\n                    htmlContainer: 'adeptus-cat-modal-container'\n                },\n                didOpen: function() {\n                    var selectedColor = '#3b82f6';\n\n                    $('#color-picker-toggle').on('click', function(e) {\n                        e.preventDefault();\n                        e.stopPropagation();\n                        var dropdown = $('#color-dropdown');\n                        dropdown.toggleClass('show');\n                    });\n\n                    $('#color-dropdown').on('click', function(e) {\n                        e.stopPropagation();\n                    });\n\n                    $(document).on('click.colorDropdown', function(e) {\n                        if (!$(e.target).closest('.adeptus-cat-add-color-wrapper').length) {\n                            $('#color-dropdown').removeClass('show');\n                        }\n                    });\n\n                    $('.adeptus-cat-color-swatch').on('click', function(e) {\n                        e.preventDefault();\n                        e.stopPropagation();\n                        selectedColor = $(this).data('color');\n                        $('#selected-color-preview').css('background', selectedColor);\n                        $('#new-category-color').val(selectedColor);\n                        $('#color-dropdown').removeClass('show');\n                    });\n\n                    $('#new-category-color').on('input change', function(e) {\n                        e.stopPropagation();\n                        selectedColor = $(this).val();\n                        $('#selected-color-preview').css('background', selectedColor);\n                    });\n\n                    $('#add-category-btn').on('click', function() {\n                        var name = $('#new-category-name').val().trim();\n                        if (name) {\n                            self.createCategory(name, selectedColor);\n                        } else {\n                            $('#new-category-name').addClass('error').focus();\n                            setTimeout(function() {\n                                $('#new-category-name').removeClass('error');\n                            }, 500);\n                        }\n                    });\n\n                    $('#new-category-name').on('keypress', function(e) {\n                        if (e.which === 13) {\n                            $('#add-category-btn').click();\n                        }\n                    });\n\n                    $('.edit-cat-btn').on('click', function(e) {\n                        e.stopPropagation();\n                        var catId = $(this).data('id');\n                        var cat = self.cachedCategories.find(function(c) {\n                            return c.id == catId;\n                        });\n                        if (cat) {\n                            $(document).off('click.colorDropdown');\n                            self.showEditCategoryDialog(cat);\n                        }\n                    });\n\n                    $('.delete-cat-btn').on('click', function(e) {\n                        e.stopPropagation();\n                        var catId = $(this).data('id');\n                        var cat = self.cachedCategories.find(function(c) {\n                            return c.id == catId;\n                        });\n                        if (cat) {\n                            $(document).off('click.colorDropdown');\n                            self.confirmDeleteCategory(cat);\n                        }\n                    });\n                },\n                willClose: function() {\n                    $(document).off('click.colorDropdown');\n                }\n            });\n        },\n\n        /**\n         * Create a new category.\n         * @param {string} name - The category name.\n         * @param {string} color - The category color.\n         */\n        createCategory: function(name, color) {\n            var self = this;\n\n            $.ajax({\n                url: M.cfg.wwwroot + '/report/adeptus_insights/ajax/manage_category.php',\n                method: 'POST',\n                dataType: 'json',\n                data: {\n                    action: 'create',\n                    name: name,\n                    color: color,\n                    sesskey: M.cfg.sesskey\n                },\n                success: function(response) {\n                    if (response.success) {\n                        self.cachedCategories.push(response.data);\n                        Swal.close();\n                        Swal.fire({\n                            icon: 'success',\n                            title: STRINGS.categoryCreated,\n                            timer: 1500,\n                            showConfirmButton: false\n                        }).then(function() {\n                            self.showCategoryManagementModal();\n                        });\n                    } else {\n                        Swal.showValidationMessage(response.message);\n                    }\n                },\n                error: function(xhr) {\n                    var msg = (xhr.responseJSON && xhr.responseJSON.message) || 'Failed to create category';\n                    Swal.fire({icon: 'error', title: STRINGS.error, text: msg});\n                }\n            });\n        },\n\n        /**\n         * Show edit category dialog.\n         * @param {Object} category - The category to edit.\n         */\n        showEditCategoryDialog: function(category) {\n            var self = this;\n            var presetColors = ['#3b82f6', '#10b981', '#f59e0b', '#ef4444', '#8b5cf6', '#ec4899', '#06b6d4', '#84cc16'];\n\n            var colorSwatchesHtml = presetColors.map(function(color) {\n                var isSelected = color.toLowerCase() === (category.color || '#6c757d').toLowerCase();\n                return '<button type=\"button\" class=\"adeptus-edit-color-swatch' + (isSelected ? ' selected' : '') +\n                    '\" data-color=\"' + color + '\" style=\"background: ' + color + ';\"></button>';\n            }).join('');\n\n            Swal.fire({\n                title: STRINGS.editCategory,\n                html: '<div class=\"adeptus-cat-edit-modal\">' +\n                    '<div class=\"adeptus-cat-edit-preview\" id=\"edit-preview\">' +\n                        '<div class=\"adeptus-cat-edit-preview-color\" id=\"edit-preview-color\" style=\"background: ' +\n                        (category.color || '#6c757d') + ';\"></div>' +\n                        '<span class=\"adeptus-cat-edit-preview-name\" id=\"edit-preview-name\">' + category.name +\n                        '</span>' +\n                    '</div>' +\n                    '<div class=\"adeptus-cat-edit-field\">' +\n                        '<label class=\"adeptus-cat-edit-label\">' + STRINGS.name + '</label>' +\n                        '<input type=\"text\" id=\"edit-cat-name\" class=\"adeptus-cat-edit-input\" value=\"' +\n                        category.name.replace(/\"/g, '&quot;') + '\">' +\n                    '</div>' +\n                    '<div class=\"adeptus-cat-edit-field\">' +\n                        '<label class=\"adeptus-cat-edit-label\">' + STRINGS.color + '</label>' +\n                        '<div class=\"adeptus-cat-edit-colors\">' +\n                            '<div class=\"adeptus-cat-edit-swatches\">' + colorSwatchesHtml + '</div>' +\n                            '<div class=\"adeptus-cat-edit-custom\">' +\n                                '<input type=\"color\" id=\"edit-adeptus-cat-color\" value=\"' +\n                                (category.color || '#6c757d') + '\">' +\n                                '<span>' + STRINGS.custom + '</span>' +\n                            '</div>' +\n                        '</div>' +\n                    '</div>' +\n                '</div>',\n                showCancelButton: true,\n                confirmButtonText: STRINGS.saveChanges,\n                cancelButtonText: STRINGS.cancel,\n                customClass: {\n                    popup: 'adeptus-cat-edit-popup',\n                    confirmButton: 'adeptus-cat-edit-confirm-btn',\n                    cancelButton: 'adeptus-cat-edit-cancel-btn'\n                },\n                didOpen: function() {\n                    var selectedColor = category.color || '#6c757d';\n\n                    $('#edit-cat-name').on('input', function() {\n                        $('#edit-preview-name').text($(this).val() || 'Category');\n                    });\n\n                    $('.adeptus-edit-color-swatch').on('click', function() {\n                        selectedColor = $(this).data('color');\n                        $('.adeptus-edit-color-swatch').removeClass('selected');\n                        $(this).addClass('selected');\n                        $('#edit-preview-color').css('background', selectedColor);\n                        $('#edit-adeptus-cat-color').val(selectedColor);\n                    });\n\n                    $('#edit-adeptus-cat-color').on('input', function() {\n                        selectedColor = $(this).val();\n                        $('.adeptus-edit-color-swatch').removeClass('selected');\n                        $('#edit-preview-color').css('background', selectedColor);\n                    });\n                },\n                preConfirm: function() {\n                    var name = document.getElementById('edit-cat-name').value.trim();\n                    var color = document.getElementById('edit-adeptus-cat-color').value;\n                    if (!name) {\n                        Swal.showValidationMessage(STRINGS.pleaseEnterCategoryName);\n                        return false;\n                    }\n                    return {name: name, color: color};\n                }\n            }).then(function(result) {\n                if (result.isConfirmed) {\n                    self.updateCategory(category.id, result.value.name, result.value.color);\n                }\n            });\n        },\n\n        /**\n         * Update a category.\n         * @param {number} categoryId - The category ID.\n         * @param {string} name - The new name.\n         * @param {string} color - The new color.\n         */\n        updateCategory: function(categoryId, name, color) {\n            var self = this;\n\n            $.ajax({\n                url: M.cfg.wwwroot + '/report/adeptus_insights/ajax/manage_category.php',\n                method: 'POST',\n                dataType: 'json',\n                data: {\n                    action: 'update',\n                    category_id: categoryId,\n                    name: name,\n                    color: color,\n                    sesskey: M.cfg.sesskey\n                },\n                success: function(response) {\n                    if (response.success) {\n                        var idx = self.cachedCategories.findIndex(function(c) {\n                            return c.id == categoryId;\n                        });\n                        if (idx !== -1) {\n                            self.cachedCategories[idx] = response.data;\n                        }\n                        Swal.fire({\n                            icon: 'success',\n                            title: STRINGS.categoryUpdated,\n                            timer: 1500,\n                            showConfirmButton: false\n                        }).then(function() {\n                            self.showCategoryManagementModal();\n                        });\n                    } else {\n                        Swal.fire({icon: 'error', title: STRINGS.error, text: response.message});\n                    }\n                },\n                error: function(xhr) {\n                    var msg = (xhr.responseJSON && xhr.responseJSON.message) || '';\n                    Swal.fire({icon: 'error', title: STRINGS.error, text: msg});\n                }\n            });\n        },\n\n        /**\n         * Confirm delete category dialog.\n         * @param {Object} category - The category to delete.\n         */\n        confirmDeleteCategory: function(category) {\n            var self = this;\n\n            Swal.fire({\n                title: STRINGS.deleteCategoryConfirm,\n                html: '<p>' + STRINGS.deleteCategoryWarning.replace('{name}', '<strong>' + category.name +\n                    '</strong>') + '</p>',\n                icon: 'warning',\n                showCancelButton: true,\n                confirmButtonColor: '#dc3545',\n                confirmButtonText: STRINGS.yesDelete,\n                cancelButtonText: STRINGS.cancel\n            }).then(function(result) {\n                if (result.isConfirmed) {\n                    self.deleteCategory(category.id);\n                }\n            });\n        },\n\n        /**\n         * Delete a category.\n         * @param {number} categoryId - The category ID to delete.\n         */\n        deleteCategory: function(categoryId) {\n            var self = this;\n\n            $.ajax({\n                url: M.cfg.wwwroot + '/report/adeptus_insights/ajax/manage_category.php',\n                method: 'POST',\n                dataType: 'json',\n                data: {\n                    action: 'delete',\n                    category_id: categoryId,\n                    sesskey: M.cfg.sesskey\n                },\n                success: function(response) {\n                    if (response.success) {\n                        self.cachedCategories = self.cachedCategories.filter(function(c) {\n                            return c.id != categoryId;\n                        });\n                        Swal.fire({\n                            icon: 'success',\n                            title: STRINGS.categoryDeleted,\n                            timer: 2000,\n                            showConfirmButton: false\n                        }).then(function() {\n                            self.showCategoryManagementModal();\n                        });\n                    } else {\n                        Swal.fire({icon: 'error', title: STRINGS.error, text: response.message});\n                    }\n                },\n                error: function(xhr) {\n                    var msg = (xhr.responseJSON && xhr.responseJSON.message) || 'Failed to delete category';\n                    Swal.fire({icon: 'error', title: STRINGS.error, text: msg});\n                }\n            });\n        },\n\n        /**\n         * Show delete confirmation dialog for a report.\n         * @param {Object} report - The report to delete.\n         */\n        confirmDeleteReport: function(report) {\n            var self = this;\n\n            if (!report) {\n                report = self.currentReport;\n            }\n\n            if (!report || !report.slug) {\n                Swal.fire({\n                    icon: 'warning',\n                    title: STRINGS.noReportSelected,\n                    text: STRINGS.selectAReport\n                });\n                return;\n            }\n\n            var reportName = report.description || report.name || STRINGS.untitledReport;\n            var source = (report.source || 'assistant').toLowerCase();\n\n            Swal.fire({\n                title: STRINGS.deleteReportConfirm,\n                html: '<p>' + STRINGS.deleteReportWarning.replace('{name}', '<strong>' + reportName +\n                    '</strong>') + '</p>',\n                icon: 'warning',\n                showCancelButton: true,\n                confirmButtonColor: '#dc3545',\n                confirmButtonText: '<i class=\"fa fa-trash\"></i> ' + STRINGS.yesDelete,\n                cancelButtonText: STRINGS.cancel\n            }).then(function(result) {\n                if (result.isConfirmed) {\n                    self.deleteReport(report.slug, source, reportName);\n                }\n            });\n        },\n\n        /**\n         * Delete a report.\n         * @param {string} slug - The report slug/identifier.\n         * @param {string} source - The report source ('assistant' or 'wizard').\n         * @param {string} reportName - The report name for display.\n         */\n        deleteReport: function(slug, source, reportName) {\n            var self = this;\n\n            Swal.fire({\n                title: STRINGS.deletingReport,\n                text: STRINGS.deletingReportWait,\n                allowOutsideClick: false,\n                allowEscapeKey: false,\n                didOpen: function() {\n                    Swal.showLoading();\n                }\n            });\n\n            var deletePromise = $.ajax({\n                url: M.cfg.wwwroot + '/report/adeptus_insights/ajax/manage_generated_reports.php',\n                method: 'POST',\n                dataType: 'json',\n                data: {\n                    action: 'remove_single',\n                    slug: slug,\n                    source: source,\n                    sesskey: M.cfg.sesskey\n                }\n            });\n\n            deletePromise.then(function(response) {\n                if (!response.success) {\n                    Swal.close();\n                    Swal.fire({\n                        icon: 'error',\n                        title: STRINGS.deleteFailed,\n                        text: response.message\n                    });\n                    return;\n                }\n\n                self.trackReportDeleted(reportName, source === 'assistant');\n\n                self.cachedReports = self.cachedReports.filter(function(r) {\n                    return r.slug !== slug;\n                });\n\n                if (self.currentReport && self.currentReport.slug === slug) {\n                    self.currentReport = null;\n                    self.currentReportData = null;\n                }\n\n                self.renderReportsList(self.cachedReports);\n                self.updateReportCount(self.cachedReports.length);\n\n                $('#report-content').addClass('d-none');\n                $('#report-placeholder').removeClass('d-none');\n                $('#report-category-selector').addClass('d-none');\n                $('.adeptus-report-view-title').text(STRINGS.selectAReport);\n\n                Swal.close();\n                self.showToast(STRINGS.reportDeletedSuccess, 'success');\n\n            }).catch(function(xhr) {\n                Swal.close();\n                var errorMsg = '';\n                try {\n                    var response = JSON.parse(xhr.responseText);\n                    errorMsg = response.message || '';\n                } catch (e) {\n                    if (xhr.responseJSON && xhr.responseJSON.message) {\n                        errorMsg = xhr.responseJSON.message;\n                    }\n                }\n                Swal.fire({\n                    icon: 'error',\n                    title: STRINGS.deleteFailed,\n                    text: errorMsg\n                });\n            });\n        },\n\n        /**\n         * Track report deletion to update quota.\n         * @param {string} reportName - The name of the deleted report.\n         * @param {boolean} isAiGenerated - Whether the report was AI-generated.\n         */\n        trackReportDeleted: function(reportName, isAiGenerated) {\n            $.ajax({\n                url: M.cfg.wwwroot + '/report/adeptus_insights/ajax/track_report_deleted.php',\n                method: 'POST',\n                dataType: 'json',\n                data: {\n                    report_name: reportName,\n                    is_ai_generated: isAiGenerated ? 1 : 0,\n                    sesskey: M.cfg.sesskey\n                }\n            }).done(function(response) {\n                window.console.log('[GeneratedReports] Report deletion tracked:', response);\n            }).fail(function(error) {\n                window.console.warn('[GeneratedReports] Failed to track report deletion:', error);\n            });\n        },\n\n        /**\n         * Show the category selector for the current report.\n         * @param {Object} report - The report to show category selector for.\n         */\n        showReportCategorySelector: function(report) {\n            var self = this;\n\n            // Store the report slug so we can always get fresh data from cache.\n            this.currentCategoryReportSlug = report.slug;\n\n            // Helper to get fresh report from cache.\n            var getFreshReport = function() {\n                var cached = self.cachedReports.find(function(r) {\n                    return r.slug === self.currentCategoryReportSlug;\n                });\n                return cached || report;\n            };\n\n            // Helper to get fresh category info.\n            var getFreshCategoryInfo = function() {\n                var r = getFreshReport();\n                return r.category_info || {name: r.category || STRINGS.general, color: '#6c757d'};\n            };\n\n            // Update the displayed category.\n            var updateCategoryDisplay = function() {\n                var catInfo = getFreshCategoryInfo();\n                $('#category-dot').css('background', catInfo.color || '#6c757d');\n                $('#category-name').text(catInfo.name || STRINGS.general);\n            };\n\n            updateCategoryDisplay();\n            $('#report-category-selector').removeClass('d-none');\n\n            var buildDropdown = function() {\n                var currentReport = getFreshReport();\n                var catInfo = getFreshCategoryInfo();\n\n                var menuHtml = self.cachedCategories.map(function(cat) {\n                    var isSelected = (catInfo.id && cat.id === catInfo.id) ||\n                                     (currentReport.category_id && cat.id === currentReport.category_id) ||\n                                     (!catInfo.id && !currentReport.category_id && cat.name.toLowerCase() ===\n                                     (catInfo.name || 'general').toLowerCase());\n                    return '<button type=\"button\" class=\"adeptus-category-menu-item' +\n                        (isSelected ? ' selected' : '') + '\" data-id=\"' + cat.id + '\" data-name=\"' + cat.name +\n                        '\" data-color=\"' + (cat.color || '#6c757d') + '\">' +\n                        '<span class=\"adeptus-category-menu-dot\" style=\"background: ' + (cat.color || '#6c757d') +\n                        ';\"></span>' +\n                        '<span class=\"adeptus-category-menu-name\">' + cat.name + '</span>' +\n                        (isSelected ? '<svg class=\"adeptus-category-menu-check\" width=\"16\" height=\"16\" ' +\n                        'viewBox=\"0 0 24 24\" fill=\"none\" stroke=\"currentColor\" stroke-width=\"2.5\"><polyline ' +\n                        'points=\"20 6 9 17 4 12\"></polyline></svg>' : '') +\n                    '</button>';\n                }).join('');\n\n                $('#category-dropdown-menu').html(menuHtml);\n\n                $('.adeptus-category-menu-item').off('click').on('click', function(e) {\n                    e.preventDefault();\n                    e.stopPropagation();\n                    var catId = $(this).data('id');\n                    var catName = $(this).data('name');\n                    var catColor = $(this).data('color');\n                    $('#category-dropdown-menu').removeClass('show');\n                    var freshReport = getFreshReport();\n                    self.updateReportCategory(freshReport.slug, catId, catName, catColor, freshReport);\n                    // Update display immediately.\n                    $('#category-dot').css('background', catColor);\n                    $('#category-name').text(catName);\n                });\n            };\n\n            // Always rebuild dropdown when button is clicked to get fresh data.\n            $('#category-current-btn').off('click').on('click', function(e) {\n                e.preventDefault();\n                e.stopPropagation();\n                // Rebuild dropdown with fresh category info before showing.\n                if (self.cachedCategories && self.cachedCategories.length > 0) {\n                    buildDropdown();\n                }\n                $('#category-dropdown-menu').toggleClass('show');\n            });\n\n            // Initial dropdown build.\n            if (!this.cachedCategories || this.cachedCategories.length === 0) {\n                $.ajax({\n                    url: M.cfg.wwwroot + '/report/adeptus_insights/ajax/manage_category.php',\n                    method: 'POST',\n                    dataType: 'json',\n                    data: {\n                        action: 'list',\n                        sesskey: M.cfg.sesskey\n                    },\n                    success: function(response) {\n                        if (response.success && response.data) {\n                            self.cachedCategories = response.data;\n                        }\n                        buildDropdown();\n                    },\n                    error: function() {\n                        self.cachedCategories = [];\n                        buildDropdown();\n                    }\n                });\n            } else {\n                buildDropdown();\n            }\n\n            $('#category-dropdown-menu').off('click').on('click', function(e) {\n                e.stopPropagation();\n            });\n\n            $(document).off('click.categoryDropdown').on('click.categoryDropdown', function(e) {\n                if (!$(e.target).closest('.category-dropdown-wrapper').length) {\n                    $('#category-dropdown-menu').removeClass('show');\n                }\n            });\n        },\n\n        /**\n         * Update a report's category.\n         * @param {string} slug - The report slug.\n         * @param {number} categoryId - The new category ID.\n         * @param {string} categoryName - The new category name.\n         * @param {string} categoryColor - The new category color.\n         * @param {Object} report - The report object.\n         */\n        updateReportCategory: function(slug, categoryId, categoryName, categoryColor, report) {\n            var self = this;\n            var source = report ? (report.source || 'assistant') : 'assistant';\n\n            // Update display immediately.\n            $('#category-dot').css('background', categoryColor);\n            $('#category-name').text(categoryName);\n\n            // Optimistic update: update cache immediately so dropdown shows correct selection.\n            var cacheIndex = self.cachedReports.findIndex(function(r) {\n                return r.slug === slug;\n            });\n            var oldCategory = null;\n            var oldCategoryId = null;\n            var oldCategoryInfo = null;\n\n            if (cacheIndex !== -1) {\n                // Store old values for potential rollback.\n                oldCategory = self.cachedReports[cacheIndex].category;\n                oldCategoryId = self.cachedReports[cacheIndex].category_id;\n                oldCategoryInfo = self.cachedReports[cacheIndex].category_info;\n\n                // Update cache immediately.\n                self.cachedReports[cacheIndex].category = categoryName;\n                self.cachedReports[cacheIndex].category_id = categoryId;\n                self.cachedReports[cacheIndex].category_info = {\n                    id: categoryId,\n                    name: categoryName,\n                    color: categoryColor\n                };\n            }\n\n            $.ajax({\n                url: M.cfg.wwwroot + '/report/adeptus_insights/ajax/update_report_category.php',\n                method: 'POST',\n                dataType: 'json',\n                data: {\n                    slug: slug,\n                    category_id: categoryId,\n                    source: source,\n                    sesskey: M.cfg.sesskey\n                },\n                success: function(response) {\n                    if (response.success) {\n                        $('#category-current-btn').addClass('success-flash');\n                        setTimeout(function() {\n                            $('#category-current-btn').removeClass('success-flash');\n                        }, 600);\n                    } else {\n                        // Rollback on failure.\n                        if (cacheIndex !== -1) {\n                            self.cachedReports[cacheIndex].category = oldCategory;\n                            self.cachedReports[cacheIndex].category_id = oldCategoryId;\n                            self.cachedReports[cacheIndex].category_info = oldCategoryInfo;\n                            // Update display back to old values.\n                            var oldColor = (oldCategoryInfo && oldCategoryInfo.color) || '#6c757d';\n                            var oldName = (oldCategoryInfo && oldCategoryInfo.name) || oldCategory || STRINGS.general;\n                            $('#category-dot').css('background', oldColor);\n                            $('#category-name').text(oldName);\n                        }\n                        Swal.fire({\n                            icon: 'error',\n                            title: STRINGS.error,\n                            text: response.message\n                        });\n                    }\n                },\n                error: function(xhr) {\n                    // Rollback on error.\n                    if (cacheIndex !== -1) {\n                        self.cachedReports[cacheIndex].category = oldCategory;\n                        self.cachedReports[cacheIndex].category_id = oldCategoryId;\n                        self.cachedReports[cacheIndex].category_info = oldCategoryInfo;\n                        // Update display back to old values.\n                        var oldColor = (oldCategoryInfo && oldCategoryInfo.color) || '#6c757d';\n                        var oldName = (oldCategoryInfo && oldCategoryInfo.name) || oldCategory || STRINGS.general;\n                        $('#category-dot').css('background', oldColor);\n                        $('#category-name').text(oldName);\n                    }\n                    var msg = (xhr.responseJSON && xhr.responseJSON.message) || '';\n                    Swal.fire({icon: 'error', title: STRINGS.error, text: msg});\n                }\n            });\n        },\n\n        /**\n         * Detect numeric columns in data.\n         * @param {Array} data - The data array.\n         * @param {Array} headers - The headers array.\n         * @returns {Array}\n         */\n        detectNumericColumns: function(data, headers) {\n            if (!data || data.length === 0) {\n                return [];\n            }\n\n            return headers.filter(function(header) {\n                var numericCount = 0;\n                var sampleSize = Math.min(data.length, 20);\n\n                for (var i = 0; i < sampleSize; i++) {\n                    var val = data[i][header];\n                    if (val !== null && val !== undefined && val !== '') {\n                        var num = parseFloat(val);\n                        if (!isNaN(num) && isFinite(num)) {\n                            numericCount++;\n                        }\n                    }\n                }\n\n                return numericCount >= sampleSize * 0.5;\n            });\n        },\n\n        /**\n         * Switch between table and chart views.\n         * @param {string} view - The view to switch to ('table' or 'chart').\n         */\n        switchView: function(view) {\n            this.currentView = view;\n            $('.adeptus-view-toggle-btn').removeClass('active');\n            $('.adeptus-view-toggle-btn[data-view=\"' + view + '\"]').addClass('active');\n\n            if (view === 'table') {\n                $('#report-table-view').removeClass('d-none');\n                $('#report-chart-view').addClass('d-none');\n            } else {\n                $('#report-table-view').addClass('d-none');\n                $('#report-chart-view').removeClass('d-none');\n                this.renderChart();\n            }\n        },\n\n        /**\n         * Get the authentication token.\n         * @returns {string|null}\n         */\n        getAuthToken: function() {\n            var authData = window.adeptusAuthData;\n            if (authData && authData.api_key) {\n                return authData.api_key;\n            }\n            return null;\n        },\n\n        /**\n         * Format a date for display.\n         * @param {string} dateStr - The date string to format.\n         * @returns {string}\n         */\n        formatDate: function(dateStr) {\n            if (!dateStr) {\n                return 'N/A';\n            }\n            var date = new Date(dateStr);\n            var now = new Date();\n            var diff = now - date;\n            var days = Math.floor(diff / (1000 * 60 * 60 * 24));\n\n            if (days === 0) {\n                return 'Today, ' + date.toLocaleTimeString([], {hour: '2-digit', minute: '2-digit'});\n            } else if (days === 1) {\n                return 'Yesterday, ' + date.toLocaleTimeString([], {hour: '2-digit', minute: '2-digit'});\n            } else if (days < 7) {\n                var weekdays = ['Sunday', 'Monday', 'Tuesday', 'Wednesday', 'Thursday', 'Friday', 'Saturday'];\n                return weekdays[date.getDay()] + ', ' + date.toLocaleTimeString([], {hour: '2-digit', minute: '2-digit'});\n            } else {\n                return date.toLocaleDateString() + ', ' + date.toLocaleTimeString([], {hour: '2-digit', minute: '2-digit'});\n            }\n        },\n\n        /**\n         * Load reports from server.\n         */\n        loadReports: function() {\n            var self = this;\n            var token = this.getAuthToken();\n\n            if (!token) {\n                if (self.retryCount < self.maxRetries) {\n                    self.retryCount++;\n                    setTimeout(function() {\n                        self.loadReports();\n                    }, 500);\n                    return;\n                } else {\n                    $('#reports-loader').addClass('d-none');\n                    $('#no-reports-message').removeClass('d-none').html(\n                        '<i class=\"fa fa-exclamation-triangle fa-3x text-warning mb-3\"></i>' +\n                        '<h5 class=\"text-muted\">Authentication Required</h5>' +\n                        '<p class=\"text-muted\">Please ensure you are logged in to view reports.</p>'\n                    );\n                    return;\n                }\n            }\n\n            var assistantPromise = new Promise(function(resolve) {\n                Ajax.call([{\n                    methodname: 'report_adeptus_insights_get_ai_reports',\n                    args: {}\n                }])[0].done(function(result) {\n                    try {\n                        var parsed = JSON.parse(result.data || '{}');\n                        resolve([parsed]);\n                    } catch (e) {\n                        resolve([{reports: [], data: []}]);\n                    }\n                }).fail(function() {\n                    resolve([{reports: [], data: []}]);\n                });\n            });\n\n            var wizardPromise = new Promise(function(resolve) {\n                Ajax.call([{\n                    methodname: 'report_adeptus_insights_get_wizard_reports',\n                    args: {}\n                }])[0].done(function(result) {\n                    var response = (result && result.data) ? result.data : (result || {});\n                    resolve({success: true, reports: response.reports || []});\n                }).fail(function() {\n                    resolve({success: true, reports: []});\n                });\n            });\n\n            $.when(assistantPromise, wizardPromise).then(\n                function(assistantRes, wizardRes) {\n                    var aRes = assistantRes[0] || assistantRes || {};\n                    var wRes = wizardRes[0] || wizardRes || {};\n\n                    var assistantReports = aRes.reports || aRes.data || [];\n                    var wizardReports = wRes.reports || [];\n\n                    assistantReports = (Array.isArray(assistantReports) ? assistantReports : []).map(function(r) {\n                        r.source = r.source || 'assistant';\n                        // Parse category_info if it's a JSON string.\n                        if (r.category_info && typeof r.category_info === 'string') {\n                            try {\n                                r.category_info = JSON.parse(r.category_info);\n                            } catch (e) {\n                                r.category_info = null;\n                            }\n                        }\n                        return r;\n                    });\n                    wizardReports = (Array.isArray(wizardReports) ? wizardReports : []).map(function(r) {\n                        r.source = 'wizard';\n                        // Parse category_info if it's a JSON string.\n                        if (r.category_info && typeof r.category_info === 'string') {\n                            try {\n                                r.category_info = JSON.parse(r.category_info);\n                            } catch (e) {\n                                r.category_info = null;\n                            }\n                        }\n                        return r;\n                    });\n\n                    self.cachedReports = assistantReports.concat(wizardReports);\n\n                    self.cachedReports.sort(function(a, b) {\n                        return new Date(b.created_at) - new Date(a.created_at);\n                    });\n\n                    // Enrich reports with category_info from cached categories.\n                    self.enrichReportsWithCategoryInfo();\n\n                    self.renderReportsList(self.cachedReports);\n                    self.updateReportCount(self.cachedReports.length);\n                },\n                function(xhr) {\n                    $('#reports-loader').addClass('d-none');\n                    if (xhr.status === 401) {\n                        $('#no-reports-message').removeClass('d-none').html(\n                            '<i class=\"fa fa-lock fa-3x text-warning mb-3\"></i>' +\n                            '<h5 class=\"text-muted\">' + STRINGS.sessionExpired + '</h5>' +\n                            '<p class=\"text-muted\">' + STRINGS.refreshPageToContinue + '</p>' +\n                            '<button class=\"btn btn-primary btn-sm\" onclick=\"location.reload()\">' +\n                            '<i class=\"fa fa-refresh\"></i> ' + STRINGS.refreshPage + '</button>'\n                        );\n                    } else {\n                        $('#no-reports-message').removeClass('d-none').html(\n                            '<i class=\"fa fa-exclamation-circle fa-3x text-danger mb-3\"></i>' +\n                            '<h5 class=\"text-muted\">' + STRINGS.failedToLoadReports + '</h5>' +\n                            '<p class=\"text-muted\">' + STRINGS.tryAgainLater + '</p>' +\n                            '<button class=\"btn btn-outline-primary btn-sm\" onclick=\"location.reload()\">' +\n                            '<i class=\"fa fa-refresh\"></i> ' + STRINGS.retry + '</button>'\n                        );\n                    }\n                }\n            );\n        },\n\n        /**\n         * Update the report count display.\n         * @param {number} count - The number of reports.\n         */\n        updateReportCount: function(count) {\n            var countText = count === 1 ? STRINGS.reportCount : count + ' ' + STRINGS.reportsCount;\n            $('.adeptus-page-header-subtitle').text(STRINGS.youHaveReportsSaved.replace('{count}',\n                countText.toLowerCase()));\n        },\n\n        /**\n         * Render the reports list.\n         * @param {Array} reports - The reports to render.\n         */\n        renderReportsList: function(reports) {\n            var self = this;\n\n            if (this.reportsDataTable) {\n                this.reportsDataTable.destroy();\n                this.reportsDataTable = null;\n            }\n\n            var tbody = $('#reports-tbody');\n            tbody.empty();\n\n            $('#reports-loader').addClass('d-none');\n\n            if (!reports || reports.length === 0) {\n                $('#no-reports-message').removeClass('d-none');\n                $('#reports-table-wrapper').addClass('d-none');\n                return;\n            }\n\n            $('#no-reports-message').addClass('d-none');\n            $('#reports-table-wrapper').removeClass('d-none');\n\n            reports.forEach(function(report) {\n                var date = self.formatDate(report.created_at);\n                var rowCount = report.row_count || report.data_count || '';\n                var rowCountBadge = rowCount ? '<span class=\"badge bg-info ms-1\" title=\"' + rowCount +\n                    ' rows\"><i class=\"fa fa-table\"></i> ' + rowCount + '</span>' : '';\n                var categoryBadge = report.category ? '<span class=\"badge bg-secondary ms-1\">' + report.category +\n                    '</span>' : '';\n\n                var source = (report.source || 'assistant').toLowerCase();\n                var sourceBadge = '';\n                if (source === 'wizard') {\n                    sourceBadge = '<span class=\"badge adeptus-badge-wizard\"><i class=\"fa fa-magic\"></i> ' +\n                        STRINGS.wizard + '</span>';\n                } else {\n                    sourceBadge = '<span class=\"badge adeptus-badge-ai\"><i class=\"fa fa-robot\"></i> ' +\n                        STRINGS.ai + '</span>';\n                }\n\n                var row = $('<tr class=\"adeptus-report-row\" data-report-slug=\"' + report.slug +\n                    '\" data-report-source=\"' + source + '\"></tr>');\n                row.html(\n                    '<td>' +\n                        '<div class=\"adeptus-report-name-cell\">' +\n                            '<span class=\"adeptus-report-name\">' +\n                            (report.description || report.name || STRINGS.untitledReport) + '</span>' +\n                            '<div class=\"adeptus-report-badges mt-1\">' + categoryBadge + rowCountBadge + '</div>' +\n                        '</div>' +\n                    '</td>' +\n                    '<td><small class=\"text-muted\">' + date + '</small></td>' +\n                    '<td>' + sourceBadge + '</td>'\n                );\n\n                tbody.append(row);\n            });\n\n            $('#reports-table-wrapper').off('click', '.adeptus-report-row').on('click', '.adeptus-report-row',\n                function() {\n                var $row = $(this);\n                var slug = $row.data('report-slug');\n\n                $('.adeptus-report-row').removeClass('table-primary');\n                $row.addClass('table-primary');\n                self.loadReportDetails(slug);\n            });\n\n            setTimeout(function() {\n                try {\n                    self.reportsDataTable = new window.simpleDatatables.DataTable(\"#reports-table\", {\n                        searchable: true,\n                        fixedHeight: false,\n                        perPage: 15,\n                        loading: false,\n                        labels: {\n                            placeholder: STRINGS.searchReports,\n                            noRows: STRINGS.noReportsFound,\n                            info: STRINGS.showingReports\n                        }\n                    });\n\n                    setTimeout(function() {\n                        $('.datatable-wrapper').removeClass('datatable-loading');\n                    }, 100);\n\n                    setTimeout(function() {\n                        var firstRow = $('.adeptus-report-row').first();\n                        if (firstRow.length && !self.currentReport) {\n                            firstRow.addClass('table-primary');\n                            var firstSlug = firstRow.data('report-slug');\n                            if (firstSlug) {\n                                self.loadReportDetails(firstSlug);\n                            }\n                        }\n                    }, 150);\n                } catch (e) {\n                    window.console.warn('DataTable initialization failed:', e);\n                }\n            }, 100);\n        },\n\n        /**\n         * Load report details.\n         * @param {string} slug - The report slug.\n         */\n        loadReportDetails: function(slug) {\n            var self = this;\n\n            $('#report-placeholder').addClass('d-none');\n            $('#report-content').addClass('d-none');\n            $('#report-loading').removeClass('d-none');\n\n            var cachedReport = this.cachedReports.find(function(r) {\n                return r.slug === slug;\n            });\n            var source = cachedReport ? (cachedReport.source || 'assistant') : 'assistant';\n\n            if (cachedReport) {\n                $('.adeptus-report-view-title').text(cachedReport.description || cachedReport.name ||\n                    STRINGS.reportDetails);\n                self.showReportCategorySelector(cachedReport);\n            }\n\n            if (source === 'wizard' && cachedReport) {\n                self.loadWizardReport(cachedReport);\n                return;\n            }\n\n            // Route through Moodle AJAX proxy to avoid CORS/Cloudflare Access issues\n            Ajax.call([{\n                methodname: 'report_adeptus_insights_proxy_backend_request',\n                args: {\n                    endpoint: '/ai-reports/' + slug,\n                    method: 'GET',\n                    body: ''\n                }\n            }])[0].done(function(result) {\n                try {\n                    var response = JSON.parse(result.data || '{}');\n                    var report = response.report || response;\n                    var data = response.data || [];\n\n                    report.source = source;\n\n                    var sqlQuery = response.sql || (report && report.sql_query) || (report && report.sql);\n                    var needsLocalExecution = response.execution_required || (!data || data.length === 0) && sqlQuery;\n\n                    if (needsLocalExecution && sqlQuery) {\n                        self.executeReportLocally(sqlQuery, report.params || {})\n                            .then(function(executionResult) {\n                                var localData = executionResult.data || [];\n\n                                self.currentReport = report;\n                                self.currentReportData = localData;\n\n                                var cacheIndex = self.cachedReports.findIndex(function(r) {\n                                    return r.slug === slug;\n                                });\n                                if (cacheIndex !== -1) {\n                                    self.cachedReports[cacheIndex] = Object.assign({}, report,\n                                        {data: localData, source: source});\n                                }\n\n                                self.renderReportContent(report, localData);\n                            })\n                            .catch(function(error) {\n                                $('#report-loading').addClass('d-none');\n                                $('#report-content').html(\n                                    '<div class=\"alert alert-danger\">' +\n                                        '<i class=\"fa fa-exclamation-circle\"></i> ' + STRINGS.failedToExecuteReport +\n                                        ': ' + error.message +\n                                        '<button class=\"btn btn-sm btn-outline-danger ms-3\" ' +\n                                        'onclick=\"GeneratedReports.loadReportDetails(\\'' + slug + '\\')\">' +\n                                        '<i class=\"fa fa-refresh\"></i> ' + STRINGS.retry + '</button>' +\n                                    '</div>'\n                                ).removeClass('d-none');\n                            });\n                        return;\n                    }\n\n                    self.currentReport = report;\n                    self.currentReportData = data;\n\n                    var cacheIndex = self.cachedReports.findIndex(function(r) {\n                        return r.slug === slug;\n                    });\n                    if (cacheIndex !== -1) {\n                        self.cachedReports[cacheIndex] = Object.assign({}, report, {data: data, source: source});\n                    }\n\n                    self.renderReportContent(report, data);\n                } catch (e) {\n                    $('#report-loading').addClass('d-none');\n                    $('#report-content').html(\n                        '<div class=\"alert alert-danger\">' +\n                            '<i class=\"fa fa-exclamation-circle\"></i> ' + STRINGS.failedToLoadReportDetails +\n                            '<button class=\"btn btn-sm btn-outline-danger ms-3\" ' +\n                            'onclick=\"GeneratedReports.loadReportDetails(\\'' + slug + '\\')\">' +\n                            '<i class=\"fa fa-refresh\"></i> ' + STRINGS.retry + '</button>' +\n                        '</div>'\n                    ).removeClass('d-none');\n                }\n            }).fail(function() {\n                $('#report-loading').addClass('d-none');\n                $('#report-content').html(\n                    '<div class=\"alert alert-danger\">' +\n                        '<i class=\"fa fa-exclamation-circle\"></i> ' + STRINGS.failedToLoadReportDetails +\n                        '<button class=\"btn btn-sm btn-outline-danger ms-3\" ' +\n                        'onclick=\"GeneratedReports.loadReportDetails(\\'' + slug + '\\')\">' +\n                        '<i class=\"fa fa-refresh\"></i> ' + STRINGS.retry + '</button>' +\n                    '</div>'\n                ).removeClass('d-none');\n            });\n        },\n\n        /**\n         * Load and execute a wizard report.\n         * @param {Object} cachedReport - The cached report object.\n         */\n        loadWizardReport: function(cachedReport) {\n            var self = this;\n\n            var parameters = cachedReport.parameters || {};\n            var reportTemplateId = cachedReport.report_template_id || cachedReport.name;\n\n            $.ajax({\n                url: M.cfg.wwwroot + '/lib/ajax/service.php?sesskey=' + M.cfg.sesskey +\n                    '&info=report_adeptus_insights_generate_report',\n                method: 'POST',\n                contentType: 'application/json',\n                data: JSON.stringify([{\n                    index: 0,\n                    methodname: 'report_adeptus_insights_generate_report',\n                    args: {\n                        reportid: reportTemplateId,\n                        parameters: JSON.stringify(parameters),\n                        reexecution: true\n                    }\n                }]),\n                timeout: 60000,\n                success: function(results) {\n                    var result = Array.isArray(results) && results.length > 0 ? results[0] : null;\n\n                    if (result && result.error) {\n                        $('#report-loading').addClass('d-none');\n                        $('#report-content').html(\n                            '<div class=\"alert alert-danger\">' +\n                                '<i class=\"fa fa-exclamation-circle\"></i> ' +\n                                ((result.exception && result.exception.message) || result.error) +\n                                '<button class=\"btn btn-sm btn-outline-danger ms-3\" ' +\n                                'onclick=\"GeneratedReports.loadReportDetails(\\'' + cachedReport.slug + '\\')\">' +\n                                '<i class=\"fa fa-refresh\"></i> ' + STRINGS.retry + '</button>' +\n                            '</div>'\n                        ).removeClass('d-none');\n                        return;\n                    }\n\n                    var response = (result && result.data) ? result.data : (result || {});\n                    if (response.success) {\n                        var rawResults = response.results || response.data || [];\n                        var data = rawResults.map(function(row) {\n                            if (row.cells && Array.isArray(row.cells)) {\n                                var flatRow = {};\n                                row.cells.forEach(function(cell) {\n                                    flatRow[cell.key] = cell.value;\n                                });\n                                return flatRow;\n                            }\n                            return row;\n                        });\n                        var report = {\n                            name: cachedReport.name,\n                            description: cachedReport.description || cachedReport.name,\n                            category: (response.report && response.report.category) || cachedReport.category || 'Wizard Report',\n                            created_at: cachedReport.created_at,\n                            source: 'wizard',\n                            slug: cachedReport.slug\n                        };\n\n                        self.currentReport = report;\n                        self.currentReportData = data;\n\n                        var cacheIndex = self.cachedReports.findIndex(function(r) {\n                            return r.slug === cachedReport.slug;\n                        });\n                        if (cacheIndex !== -1) {\n                            self.cachedReports[cacheIndex].data = data;\n                            self.cachedReports[cacheIndex].row_count = data.length;\n                        }\n\n                        self.renderReportContent(report, data);\n                    } else {\n                        $('#report-loading').addClass('d-none');\n                        $('#report-content').html(\n                            '<div class=\"alert alert-warning\">' +\n                                '<i class=\"fa fa-exclamation-triangle\"></i> ' +\n                                (response.message || STRINGS.failedToGenerateReport) +\n                                '<button class=\"btn btn-sm btn-outline-warning ms-3\" ' +\n                                'onclick=\"GeneratedReports.loadReportDetails(\\'' + cachedReport.slug + '\\')\">' +\n                                '<i class=\"fa fa-refresh\"></i> ' + STRINGS.retry + '</button>' +\n                            '</div>'\n                        ).removeClass('d-none');\n                    }\n                },\n                error: function() {\n                    $('#report-loading').addClass('d-none');\n                    $('#report-content').html(\n                        '<div class=\"alert alert-danger\">' +\n                            '<i class=\"fa fa-exclamation-circle\"></i> ' + STRINGS.failedToExecuteWizardReport +\n                            '<button class=\"btn btn-sm btn-outline-danger ms-3\" ' +\n                            'onclick=\"GeneratedReports.loadReportDetails(\\'' + cachedReport.slug + '\\')\">' +\n                            '<i class=\"fa fa-refresh\"></i> ' + STRINGS.retry + '</button>' +\n                        '</div>'\n                    ).removeClass('d-none');\n                }\n            });\n        },\n\n        /**\n         * Execute SQL locally for SaaS model.\n         * @param {string} sql - The SQL query to execute.\n         * @param {Object} params - Query parameters.\n         * @returns {Promise}\n         */\n        executeReportLocally: function(sql, params) {\n            params = params || {};\n\n            return new Promise(function(resolve, reject) {\n                $.ajax({\n                    url: M.cfg.wwwroot + '/report/adeptus_insights/ajax/execute_ai_report.php',\n                    method: 'POST',\n                    contentType: 'application/json',\n                    data: JSON.stringify({\n                        sql: sql,\n                        params: params,\n                        sesskey: M.cfg.sesskey\n                    }),\n                    timeout: 60000,\n                    success: function(response) {\n                        if (response.success) {\n                            // Parse JSON strings if returned as strings.\n                            var data = response.data;\n                            var headers = response.headers;\n                            if (typeof data === 'string') {\n                                try {\n data = JSON.parse(data);\n} catch (e) {\n data = [];\n}\n                            }\n                            if (typeof headers === 'string') {\n                                try {\n headers = JSON.parse(headers);\n} catch (e) {\n headers = [];\n}\n                            }\n                            resolve({\n                                data: data || [],\n                                headers: headers || [],\n                                row_count: response.row_count || 0,\n                                error: null\n                            });\n                        } else {\n                            resolve({\n                                data: [],\n                                headers: [],\n                                row_count: 0,\n                                error: response.message || 'Query execution failed'\n                            });\n                        }\n                    },\n                    error: function(xhr, status, error) {\n                        var errorMessage = 'Failed to execute report';\n                        try {\n                            var response = JSON.parse(xhr.responseText);\n                            errorMessage = response.message || errorMessage;\n                        } catch (e) {\n                            errorMessage = error || errorMessage;\n                        }\n                        reject(new Error(errorMessage));\n                    }\n                });\n            });\n        },\n\n        /**\n         * Render report content.\n         * @param {Object} report - The report object.\n         * @param {Array} data - The report data.\n         */\n        renderReportContent: function(report, data) {\n            var self = this;\n            $('#report-loading').addClass('d-none');\n\n            var contentHtml = '';\n            var rowCount = data ? data.length : 0;\n\n            contentHtml += '<div class=\"adeptus-report-detail-header mb-4\">';\n            contentHtml += '<h4 class=\"mb-2\">' + (report.description || report.name || STRINGS.report) + '</h4>';\n            contentHtml += '<div class=\"adeptus-report-meta d-flex flex-wrap align-items-center gap-2\">';\n\n            var reportSource = (report.source || 'assistant').toLowerCase();\n            if (reportSource === 'wizard') {\n                contentHtml += '<span class=\"badge adeptus-badge-wizard\"><i class=\"fa fa-magic\"></i> ' +\n                    STRINGS.wizard + '</span>';\n            } else {\n                contentHtml += '<span class=\"badge adeptus-badge-ai\"><i class=\"fa fa-robot\"></i> ' +\n                    STRINGS.ai + '</span>';\n            }\n\n            contentHtml += '<span class=\"badge adeptus-badge-rowcount\"><i class=\"fa fa-table\"></i> ' + rowCount +\n                ' ' + STRINGS.rows + '</span>';\n            contentHtml += '</div>';\n            contentHtml += '</div>';\n\n            contentHtml += '<div class=\"adeptus-action-bar d-flex justify-content-between align-items-center mb-3\">';\n\n            contentHtml += '<div class=\"adeptus-view-toggle btn-group\" role=\"group\">';\n            contentHtml += '<button type=\"button\" class=\"btn btn-sm adeptus-view-toggle-btn active\" ' +\n                'data-view=\"table\"><i class=\"fa fa-table\"></i> ' + STRINGS.table + '</button>';\n            contentHtml += '<button type=\"button\" class=\"btn btn-sm adeptus-view-toggle-btn\" data-view=\"chart\">' +\n                '<i class=\"fa fa-bar-chart\"></i> ' + STRINGS.chart + '</button>';\n            contentHtml += '</div>';\n\n            var premiumClass = self.isFreePlan ? ' adeptus-export-premium' : '';\n            contentHtml += '<div class=\"adeptus-export-buttons d-flex gap-2\">';\n            contentHtml += '<button class=\"btn btn-outline-danger btn-sm adeptus-export-pdf-btn\">' +\n                '<i class=\"fa fa-file-pdf-o\"></i> ' + STRINGS.exportPdf + '</button>';\n            contentHtml += '<button class=\"btn btn-outline-primary btn-sm adeptus-export-csv-btn' + premiumClass +\n                '\"><i class=\"fa fa-file-excel-o\"></i> ' + STRINGS.exportCsv +\n                (self.isFreePlan ? ' <i class=\"fa fa-crown text-warning\" style=\"font-size: 10px;\"></i>' : '') +\n                '</button>';\n            contentHtml += '<button class=\"btn btn-outline-secondary btn-sm adeptus-export-json-btn' + premiumClass +\n                '\"><i class=\"fa fa-code\"></i> ' + STRINGS.exportJson +\n                (self.isFreePlan ? ' <i class=\"fa fa-crown text-warning\" style=\"font-size: 10px;\"></i>' : '') +\n                '</button>';\n            contentHtml += '</div>';\n            contentHtml += '</div>';\n\n            if (data && data.length > 0) {\n                var headers = Object.keys(data[0]);\n                var displayLimit = 100;\n\n                contentHtml += '<div id=\"report-table-view\" class=\"adeptus-report-view\">';\n                contentHtml += '<div class=\"adeptus-report-data-wrapper\">';\n                contentHtml += '<div class=\"table-responsive report-table-container\">';\n                contentHtml += '<table class=\"table table-striped table-hover table-sm report-data-table\">';\n                contentHtml += '<thead class=\"table-light sticky-header\"><tr>';\n                headers.forEach(function(header) {\n                    var formattedHeader = header.replace(/_/g, ' ').replace(/\\b\\w/g, function(l) {\n                        return l.toUpperCase();\n                    });\n                    contentHtml += '<th>' + formattedHeader + '</th>';\n                });\n                contentHtml += '</tr></thead>';\n                contentHtml += '<tbody>';\n\n                var displayData = data.slice(0, displayLimit);\n                displayData.forEach(function(row) {\n                    contentHtml += '<tr>';\n                    headers.forEach(function(header) {\n                        var value = row[header];\n                        if (value === null || value === undefined) {\n                            value = '';\n                        }\n                        var displayValue = String(value);\n                        if (displayValue.length > 100) {\n                            displayValue = displayValue.substring(0, 100) + '...';\n                        }\n                        contentHtml += '<td title=\"' + String(value).replace(/\"/g, '&quot;') + '\">' +\n                            displayValue + '</td>';\n                    });\n                    contentHtml += '</tr>';\n                });\n\n                contentHtml += '</tbody></table>';\n                contentHtml += '</div>';\n                contentHtml += '</div>';\n\n                if (data.length > displayLimit) {\n                    contentHtml += '<div class=\"alert alert-info mt-3 d-flex align-items-center ' +\n                        'justify-content-between\">';\n                    contentHtml += '<span><i class=\"fa fa-info-circle\"></i> ' +\n                        STRINGS.showingFirstRows.replace('{first}', displayLimit).replace('{total}', data.length) +\n                        '</span>';\n                    contentHtml += '<span class=\"text-primary\">' + STRINGS.exportToSeeAll + '</span>';\n                    contentHtml += '</div>';\n                }\n                contentHtml += '</div>';\n\n                contentHtml += '<div id=\"report-chart-view\" class=\"adeptus-report-view d-none\">';\n                contentHtml += '<div class=\"adeptus-chart-controls-wrapper mb-3\">';\n                contentHtml += '<div class=\"adeptus-chart-controls d-flex flex-wrap align-items-center gap-3\">';\n\n                contentHtml += '<div class=\"adeptus-control-group\">';\n                contentHtml += '<label for=\"chart-type-select\" class=\"form-label\">' + STRINGS.chartType + '</label>';\n                contentHtml += '<select id=\"chart-type-select\" class=\"form-select form-select-sm\">';\n                contentHtml += '<option value=\"bar\">' + STRINGS.barChart + '</option>';\n                contentHtml += '<option value=\"line\">' + STRINGS.lineChart + '</option>';\n                contentHtml += '<option value=\"pie\">' + STRINGS.pieChart + '</option>';\n                contentHtml += '<option value=\"doughnut\">' + STRINGS.doughnutChart + '</option>';\n                contentHtml += '</select>';\n                contentHtml += '</div>';\n\n                contentHtml += '<div class=\"adeptus-control-group\">';\n                contentHtml += '<label for=\"chart-x-axis\" class=\"form-label\">' + STRINGS.xAxisLabels + '</label>';\n                contentHtml += '<select id=\"chart-x-axis\" class=\"form-select form-select-sm\">';\n                headers.forEach(function(header, idx) {\n                    var formattedHeader = header.replace(/_/g, ' ').replace(/\\b\\w/g, function(l) {\n                        return l.toUpperCase();\n                    });\n                    var selected = idx === 0 ? ' selected' : '';\n                    contentHtml += '<option value=\"' + header + '\"' + selected + '>' + formattedHeader + '</option>';\n                });\n                contentHtml += '</select>';\n                contentHtml += '</div>';\n\n                var numericCols = self.detectNumericColumns(data, headers);\n                contentHtml += '<div class=\"adeptus-control-group\">';\n                contentHtml += '<label for=\"chart-y-axis\" class=\"form-label\">' + STRINGS.yAxisValues + '</label>';\n                contentHtml += '<select id=\"chart-y-axis\" class=\"form-select form-select-sm\">';\n                if (numericCols.length > 0) {\n                    numericCols.forEach(function(col, idx) {\n                        var formattedHeader = col.replace(/_/g, ' ').replace(/\\b\\w/g, function(l) {\n                            return l.toUpperCase();\n                        });\n                        var selected = idx === numericCols.length - 1 ? ' selected' : '';\n                        contentHtml += '<option value=\"' + col + '\"' + selected + '>' + formattedHeader + '</option>';\n                    });\n                } else {\n                    headers.forEach(function(header, idx) {\n                        var formattedHeader = header.replace(/_/g, ' ').replace(/\\b\\w/g, function(l) {\n                            return l.toUpperCase();\n                        });\n                        var selected = idx === headers.length - 1 ? ' selected' : '';\n                        contentHtml += '<option value=\"' + header + '\"' + selected + '>' + formattedHeader + '</option>';\n                    });\n                }\n                contentHtml += '</select>';\n                contentHtml += '</div>';\n\n                contentHtml += '</div>';\n                contentHtml += '</div>';\n\n                contentHtml += '<div class=\"adeptus-chart-container\" style=\"position: relative; height: 400px;\">';\n                contentHtml += '<canvas id=\"report-chart\"></canvas>';\n                contentHtml += '</div>';\n                contentHtml += '</div>';\n\n            } else {\n                contentHtml += '<div class=\"alert alert-warning text-center py-4\">';\n                contentHtml += '<i class=\"fa fa-inbox fa-2x mb-2 d-block\"></i>';\n                contentHtml += '<strong>' + STRINGS.noDataAvailable + '</strong><br>';\n                contentHtml += '<small class=\"text-muted\">' + STRINGS.noDataRows + '</small>';\n                contentHtml += '</div>';\n            }\n\n            $('#report-content').html(contentHtml).removeClass('d-none');\n\n            self.currentView = 'table';\n\n            $('#report-content .adeptus-export-pdf-btn').on('click', function() {\n                self.exportReport(report.slug, 'pdf');\n            });\n            $('#report-content .adeptus-export-csv-btn').on('click', function() {\n                if ($(this).hasClass('adeptus-export-premium')) {\n                    self.showExportUpgradePrompt('csv');\n                    return;\n                }\n                self.exportReport(report.slug, 'csv');\n            });\n            $('#report-content .adeptus-export-json-btn').on('click', function() {\n                if ($(this).hasClass('adeptus-export-premium')) {\n                    self.showExportUpgradePrompt('json');\n                    return;\n                }\n                self.exportReport(report.slug, 'json');\n            });\n\n            $('#delete-report-header-btn').off('click').on('click', function() {\n                self.confirmDeleteReport(report);\n            });\n        },\n\n        /**\n         * Render chart.\n         */\n        renderChart: function() {\n            var data = this.currentReportData;\n\n            if (!data || data.length === 0) {\n                return;\n            }\n\n            var chartType = $('#chart-type-select').val() || 'bar';\n            var canvas = document.getElementById('report-chart');\n            if (!canvas) {\n                return;\n            }\n\n            if (this.chartInstance) {\n                this.chartInstance.destroy();\n                this.chartInstance = null;\n            }\n\n            var labelKey = $('#chart-x-axis').val();\n            var valueKey = $('#chart-y-axis').val();\n\n            if (!labelKey || !valueKey) {\n                var headers = Object.keys(data[0]);\n                labelKey = labelKey || headers[0];\n                valueKey = valueKey || headers[headers.length - 1];\n            }\n\n            var valueKeyFormatted = valueKey.replace(/_/g, ' ').replace(/\\b\\w/g, function(l) {\n                return l.toUpperCase();\n            });\n\n            var chartData = data.slice(0, 50);\n            var labels = chartData.map(function(r) {\n                var label = r[labelKey];\n                if (label === null || label === undefined) {\n                    return STRINGS.unknown;\n                }\n                var labelStr = String(label);\n                return labelStr.length > 30 ? labelStr.substring(0, 30) + '...' : labelStr;\n            });\n            var values = chartData.map(function(r) {\n                return parseFloat(r[valueKey]) || 0;\n            });\n\n            var colors = this.generateChartColors(values.length);\n            var chartConfig = this.createChartConfig(chartType, labels, values, valueKeyFormatted, colors);\n\n            try {\n                this.chartInstance = new this.Chart(canvas.getContext('2d'), chartConfig);\n            } catch (error) {\n                window.console.error('Error creating chart:', error);\n                $('#report-chart-view .adeptus-chart-container').html(\n                    '<div class=\"alert alert-danger\"><i class=\"fa fa-exclamation-triangle\"></i> ' +\n                    STRINGS.errorRenderingChart + ': ' + error.message + '</div>'\n                );\n            }\n        },\n\n        /**\n         * Generate chart colors.\n         * @param {number} count - Number of colors needed.\n         * @returns {Array}\n         */\n        generateChartColors: function(count) {\n            var baseColors = [\n                '#2563eb', '#10b981', '#f59e0b', '#ef4444', '#8b5cf6',\n                '#06b6d4', '#ec4899', '#84cc16', '#f97316', '#6366f1',\n                '#14b8a6', '#a855f7', '#eab308', '#22c55e', '#3b82f6'\n            ];\n\n            var colors = [];\n            for (var i = 0; i < count; i++) {\n                colors.push(baseColors[i % baseColors.length]);\n            }\n            return colors;\n        },\n\n        /**\n         * Create chart configuration.\n         * @param {string} chartType - The chart type.\n         * @param {Array} labels - The labels array.\n         * @param {Array} values - The values array.\n         * @param {string} valueKey - The value key label.\n         * @param {Array} colors - The colors array.\n         * @returns {Object}\n         */\n        createChartConfig: function(chartType, labels, values, valueKey, colors) {\n            var reportName = (this.currentReport && this.currentReport.description) ||\n                (this.currentReport && this.currentReport.name) ||\n                STRINGS.report;\n\n            var baseConfig = {\n                responsive: true,\n                maintainAspectRatio: false,\n                plugins: {\n                    title: {\n                        display: true,\n                        text: reportName,\n                        font: {size: 16, weight: 'bold'},\n                        padding: {top: 10, bottom: 20}\n                    },\n                    legend: {\n                        display: chartType === 'pie' || chartType === 'doughnut',\n                        position: 'right'\n                    }\n                }\n            };\n\n            if (chartType === 'pie' || chartType === 'doughnut') {\n                return {\n                    type: chartType,\n                    data: {\n                        labels: labels,\n                        datasets: [{\n                            data: values,\n                            backgroundColor: colors,\n                            borderColor: '#fff',\n                            borderWidth: 2\n                        }]\n                    },\n                    options: baseConfig\n                };\n            } else if (chartType === 'line') {\n                return {\n                    type: 'line',\n                    data: {\n                        labels: labels,\n                        datasets: [{\n                            label: valueKey,\n                            data: values,\n                            borderColor: colors[0],\n                            backgroundColor: colors[0] + '40',\n                            borderWidth: 3,\n                            fill: true,\n                            tension: 0.4\n                        }]\n                    },\n                    options: Object.assign({}, baseConfig, {\n                        scales: {\n                            y: {beginAtZero: true},\n                            x: {ticks: {maxRotation: 45, minRotation: 45}}\n                        }\n                    })\n                };\n            } else {\n                return {\n                    type: 'bar',\n                    data: {\n                        labels: labels,\n                        datasets: [{\n                            label: valueKey,\n                            data: values,\n                            backgroundColor: colors,\n                            borderColor: colors.map(function(c) {\n                                return c;\n                            }),\n                            borderWidth: 1\n                        }]\n                    },\n                    options: Object.assign({}, baseConfig, {\n                        scales: {\n                            y: {beginAtZero: true},\n                            x: {ticks: {maxRotation: 45, minRotation: 45}}\n                        }\n                    })\n                };\n            }\n        },\n\n        /**\n         * Export report.\n         * @param {string} reportSlug - The report slug.\n         * @param {string} format - The export format.\n         */\n        exportReport: function(reportSlug, format) {\n            var self = this;\n\n            if (!self.currentReportData || !Array.isArray(self.currentReportData) ||\n                self.currentReportData.length === 0) {\n                Swal.fire({\n                    icon: 'warning',\n                    title: STRINGS.noData,\n                    text: STRINGS.noDataToExport\n                });\n                return;\n            }\n\n            Swal.fire({\n                title: STRINGS.exportingAs.replace('{format}', format.toUpperCase()),\n                allowOutsideClick: false,\n                didOpen: function() {\n                    Swal.showLoading();\n                }\n            });\n\n            self.checkExportEligibility(format).then(function(eligibility) {\n                if (!eligibility.success || !eligibility.eligible) {\n                    Swal.close();\n                    if (self.isFreePlan && format !== 'pdf') {\n                        self.showExportUpgradePrompt(format);\n                    } else {\n                        Swal.fire({\n                            icon: 'error',\n                            title: STRINGS.exportNotAvailable,\n                            text: eligibility.message || STRINGS.exportNotEligible\n                        });\n                    }\n                    return;\n                }\n\n                var reportId = reportSlug;\n                var isWizardReport = self.currentReport && self.currentReport.source === 'wizard';\n                if (isWizardReport && self.currentReport.name) {\n                    reportId = self.currentReport.name;\n                }\n\n                var body = 'reportid=' + encodeURIComponent(reportId) + '&format=' + format +\n                    '&sesskey=' + M.cfg.sesskey;\n                body += '&view=' + self.currentView;\n\n                var headers = self.currentReportData.length > 0 ? Object.keys(self.currentReportData[0]) : [];\n                var payloadReportName = (self.currentReport && self.currentReport.description) ||\n                    (self.currentReport && self.currentReport.name) || 'report';\n                var reportDataPayload = {\n                    results: self.currentReportData,\n                    headers: headers,\n                    report_name: payloadReportName,\n                    report_category: (self.currentReport && self.currentReport.category) || ''\n                };\n                body += '&report_data=' + encodeURIComponent(JSON.stringify(reportDataPayload));\n\n                var chartImagePromise = Promise.resolve(null);\n                if (format === 'pdf' && self.currentView === 'chart') {\n                    chartImagePromise = self.captureChartImage().catch(function() {\n                        return null;\n                    });\n                }\n\n                chartImagePromise.then(function(chartImage) {\n                    if (chartImage && chartImage.length > 100) {\n                        body += '&chart_image=' + encodeURIComponent(chartImage);\n                        window.console.log('[GeneratedReports] Chart image included in export');\n                    }\n\n                    return fetch(M.cfg.wwwroot + '/report/adeptus_insights/ajax/export_report.php', {\n                        method: 'POST',\n                        headers: {\n                            'Content-Type': 'application/x-www-form-urlencoded',\n                        },\n                        body: body,\n                        credentials: 'same-origin'\n                    });\n                }).then(function(response) {\n                    var contentType = response.headers.get('content-type');\n                    var contentDisposition = response.headers.get('content-disposition');\n\n                    if (contentType && contentType.includes('application/json') && !contentDisposition) {\n                        return response.json().then(function(errorData) {\n                            throw new Error(errorData.message || 'Export failed');\n                        });\n                    }\n\n                    if (!response.ok) {\n                        throw new Error('Export failed with status: ' + response.status);\n                    }\n\n                    return response.blob();\n                }).then(function(blob) {\n                    var reportName = (self.currentReport && self.currentReport.description) ||\n                        (self.currentReport && self.currentReport.name) || 'report';\n                    var sanitizedName = reportName.replace(/[^a-zA-Z0-9\\s-]/g, '')\n                        .replace(/\\s+/g, '_').toLowerCase();\n                    var dateSuffix = new Date().toISOString().split('T')[0];\n\n                    var url = window.URL.createObjectURL(blob);\n                    var link = document.createElement('a');\n                    link.href = url;\n                    link.download = sanitizedName + '_' + dateSuffix + '.' + format;\n                    document.body.appendChild(link);\n                    link.click();\n                    window.URL.revokeObjectURL(url);\n                    document.body.removeChild(link);\n\n                    Swal.close();\n\n                    self.trackExport(format, reportName);\n                    self.showToast(format.toUpperCase() + ' ' + STRINGS.fileDownloadedSuccess, 'success');\n\n                }).catch(function(error) {\n                    Swal.close();\n                    Swal.fire({\n                        icon: 'error',\n                        title: STRINGS.exportFailed,\n                        text: error.message || STRINGS.exportFailedMessage\n                    });\n                });\n            });\n        }\n    };\n\n    // Make available globally for retry buttons\n    window.GeneratedReports = GeneratedReports;\n\n    return {\n        /**\n         * Initialize the module.\n         * @param {Object} config - Configuration from PHP.\n         */\n        init: function(config) {\n            // Load strings first, then initialize\n            loadStrings().then(function() {\n                // Wait for auth data to be available\n                var checkAuth = setInterval(function() {\n                    if (window.adeptusAuthData) {\n                        clearInterval(checkAuth);\n                        GeneratedReports.init(config);\n                    }\n                }, 100);\n\n                // Timeout after 5 seconds\n                setTimeout(function() {\n                    clearInterval(checkAuth);\n                    if (!window.adeptusAuthData) {\n                        $('#reports-loader').addClass('d-none');\n                        $('#no-reports-message').removeClass('d-none').html(\n                            '<i class=\"fa fa-exclamation-triangle fa-3x text-warning mb-3\"></i>' +\n                            '<h5 class=\"text-muted\">' + STRINGS.authenticationRequired + '</h5>' +\n                            '<p class=\"text-muted\">' + STRINGS.authenticationRequiredMessage + '</p>'\n                        );\n                    }\n                }, 5000);\n            });\n        }\n    };\n});\n"],"names":["define","$","Ajax","Str","Chart","STRINGS","GeneratedReports","backendUrl","cachedReports","cachedCategories","currentReport","currentReportData","reportsDataTable","retryCount","maxRetries","currentView","chartInstance","strings","isFreePlan","init","config","this","loadReports","loadCategories","bindViewToggle","bindCategoryManagement","showExportUpgradePrompt","format","subscriptionUrl","M","cfg","wwwroot","formatName","toUpperCase","Swal","fire","title","premiumExportFormat","html","premiumFeature","exportUpgradeMessage","replace","freePlan","freePlanPdfOnly","paidPlans","paidPlansAllFormats","showCancelButton","confirmButtonText","upgradeNow","cancelButtonText","cancel","confirmButtonColor","cancelButtonColor","width","then","result","isConfirmed","window","open","checkExportEligibility","Promise","resolve","call","methodname","args","done","data","fail","error","console","success","eligible","message","captureChartImage","self","setTimeout","chartCanvas","document","getElementById","warn","dataUrl","toDataURL","length","log","e","loadHtml2Canvas","html2canvas","backgroundColor","scale","useCORS","allowTaint","logging","capturedCanvas","catch","reject","script","createElement","src","onload","onerror","Error","head","appendChild","showToast","type","toastContainer","id","style","cssText","body","toast","innerHTML","animation","parentNode","removeChild","trackExport","reportName","fetch","method","headers","encodeURIComponent","sesskey","response","json","on","view","switchView","renderChart","showCategoryManagementModal","ajax","url","dataType","action","enrichReportsWithCategoryInfo","forEach","report","category_info","color","matchedCategory","category_id","find","c","parseInt","category","name","toLowerCase","generalCat","systemCategories","filter","is_system","customCategories","customCategoriesHtml","map","cat","report_count","join","noCustomCategories","createFirstCategory","systemCategoriesHtml","colorSwatchesHtml","categories","createNewCategory","categoryName","customColor","yourCategories","defaultCategories","readOnly","showConfirmButton","showCloseButton","customClass","popup","closeButton","htmlContainer","didOpen","selectedColor","preventDefault","stopPropagation","toggleClass","target","closest","removeClass","css","val","trim","createCategory","addClass","focus","which","click","catId","off","showEditCategoryDialog","confirmDeleteCategory","willClose","push","close","icon","categoryCreated","timer","showValidationMessage","xhr","msg","responseJSON","text","editCategory","custom","saveChanges","confirmButton","cancelButton","preConfirm","value","pleaseEnterCategoryName","updateCategory","categoryId","idx","findIndex","categoryUpdated","deleteCategoryConfirm","deleteCategoryWarning","yesDelete","deleteCategory","categoryDeleted","confirmDeleteReport","slug","description","untitledReport","source","deleteReportConfirm","deleteReportWarning","deleteReport","noReportSelected","selectAReport","deletingReport","deletingReportWait","allowOutsideClick","allowEscapeKey","showLoading","deleteFailed","trackReportDeleted","r","renderReportsList","updateReportCount","reportDeletedSuccess","errorMsg","JSON","parse","responseText","isAiGenerated","report_name","is_ai_generated","showReportCategorySelector","currentCategoryReportSlug","catInfo","getFreshReport","getFreshCategoryInfo","general","buildDropdown","menuHtml","isSelected","catName","catColor","freshReport","updateReportCategory","categoryColor","cacheIndex","oldCategory","oldCategoryId","oldCategoryInfo","oldColor","oldName","detectNumericColumns","header","numericCount","sampleSize","Math","min","i","num","parseFloat","isNaN","isFinite","getAuthToken","authData","adeptusAuthData","api_key","formatDate","dateStr","date","Date","diff","days","floor","toLocaleTimeString","hour","minute","getDay","toLocaleDateString","assistantPromise","parsed","reports","wizardPromise","when","assistantRes","wizardRes","aRes","wRes","assistantReports","wizardReports","Array","isArray","concat","sort","a","b","created_at","status","sessionExpired","refreshPageToContinue","refreshPage","failedToLoadReports","tryAgainLater","retry","count","countText","reportCount","reportsCount","youHaveReportsSaved","destroy","tbody","empty","rowCount","row_count","data_count","rowCountBadge","categoryBadge","sourceBadge","wizard","ai","row","append","$row","loadReportDetails","simpleDatatables","DataTable","searchable","fixedHeight","perPage","loading","labels","placeholder","searchReports","noRows","noReportsFound","info","showingReports","firstRow","first","firstSlug","cachedReport","reportDetails","loadWizardReport","endpoint","sqlQuery","sql","sql_query","execution_required","executeReportLocally","params","executionResult","localData","Object","assign","renderReportContent","failedToExecuteReport","failedToLoadReportDetails","parameters","reportTemplateId","report_template_id","contentType","stringify","index","reportid","reexecution","timeout","results","exception","cells","flatRow","cell","key","failedToGenerateReport","failedToExecuteWizardReport","errorMessage","contentHtml","reportSource","rows","table","chart","premiumClass","exportPdf","exportCsv","exportJson","keys","formattedHeader","l","slice","displayValue","String","substring","showingFirstRows","exportToSeeAll","chartType","barChart","lineChart","pieChart","doughnutChart","xAxisLabels","numericCols","yAxisValues","col","selected","noDataAvailable","noDataRows","exportReport","hasClass","canvas","labelKey","valueKey","valueKeyFormatted","chartData","label","unknown","labelStr","values","colors","generateChartColors","chartConfig","createChartConfig","getContext","errorRenderingChart","baseColors","baseConfig","responsive","maintainAspectRatio","plugins","display","font","size","weight","padding","top","bottom","legend","position","datasets","borderColor","borderWidth","options","fill","tension","scales","y","beginAtZero","x","ticks","maxRotation","minRotation","reportSlug","exportingAs","eligibility","exportNotAvailable","exportNotEligible","reportId","payloadReportName","reportDataPayload","report_category","chartImagePromise","chartImage","credentials","get","contentDisposition","includes","errorData","ok","blob","sanitizedName","dateSuffix","toISOString","split","URL","createObjectURL","link","href","download","revokeObjectURL","fileDownloadedSuccess","exportFailed","exportFailedMessage","noData","noDataToExport","get_strings","component","authenticationRequired","authenticationRequiredMessage","checkAuth","setInterval","clearInterval"],"mappings":";;;;;;;AAuBAA,mDAAO,CAAC,SAAU,YAAa,WAAY,iBAAiB,SAASC,EAAGC,KAAMC,IAAKC,WAO3EC,QAAU,GAoPVC,iBAAmB,CACnBC,WAAY,GACZC,cAAe,GACfC,iBAAkB,GAClBC,cAAe,KACfC,kBAAmB,KACnBC,iBAAkB,KAClBC,WAAY,EACZC,WAAY,EACZC,YAAa,QACbC,cAAe,KACfZ,MAAOA,MACPa,QAASZ,QACTa,YAAY,EAMZC,KAAM,SAASC,QACAC,KACNd,WAAaa,OAAOb,YAAc,GAD5Bc,KAENH,YAAmC,IAAtBE,OAAOF,WAFdG,KAGNJ,QAAUZ,QAHJgB,KAKNC,cALMD,KAMNE,iBANMF,KAONG,iBAPMH,KAQNI,0BAOTC,wBAAyB,SAASC,YAC1BC,gBAAkBC,EAAEC,IAAIC,QAAU,4CAMlCC,WALc,KACP,YACE,aACD,QAEiBL,SAAWA,OAAOM,cAE/CC,KAAKC,KAAK,CACNC,MAAO/B,QAAQgC,oBACfC,KAAM,wMAGoDN,WAAa,IAAM3B,QAAQkC,eAH/E,2FAKFlC,QAAQmC,qBAAqBC,QAAQ,WAAYT,YAL/C,gKAQW3B,QAAQqC,SAAW,aAAerC,QAAQsC,gBARrD,eASWtC,QAAQuC,UAAY,aAAevC,QAAQwC,oBAAsB,mBAClFC,kBAAkB,EAClBC,kBAAmB,kCAAoC1C,QAAQ2C,WAC/DC,iBAAkB,+BAAiC5C,QAAQ6C,OAC3DC,mBAAoB,UACpBC,kBAAmB,UACnBC,MAAO,MACRC,MAAK,SAASC,QACTA,OAAOC,aACPC,OAAOC,KAAK9B,gBAAiB,cAUzC+B,uBAAwB,SAAShC,eACtB,IAAIiC,SAAQ,SAASC,SACxB3D,KAAK4D,KAAK,CAAC,CACPC,WAAY,mDACZC,KAAM,CAACrC,OAAQA,WACf,GAAGsC,MAAK,SAASV,YACbW,KAAOX,OAAOW,KAAOX,OAAOW,KAAOX,OACvCM,QAAQK,SACTC,MAAK,SAASC,OACbX,OAAOY,QAAQD,MAAM,qCAAsCA,OAC3DP,QAAQ,CAACS,SAAS,EAAOC,UAAU,EAAOC,QAAS,gDAU/DC,kBAAmB,eACXC,KAAOrD,YAEJ,IAAIuC,SAAQ,SAASC,SAExBc,YAAW,eACHC,YAAcC,SAASC,eAAe,oBACrCF,mBACDnB,OAAOY,QAAQU,KAAK,kDACpBlB,QAAQ,cAMJmB,QAAUJ,YAAYK,UAAU,YAAa,OAC7CD,SAAWA,QAAQE,OAAS,KAAOF,QAAQE,OAAS,WACpDzB,OAAOY,QAAQc,IAAI,yDAA0DH,QAAQE,aACrFrB,QAAQmB,SAGd,MAAOI,GACL3B,OAAOY,QAAQU,KAAK,mDAAoDK,GAI5EV,KAAKW,kBAAkB/B,MAAK,WACpBG,OAAO6B,YACP7B,OAAO6B,YAAYV,YAAa,CAC5BW,gBAAiB,UACjBC,MAAO,IACPC,SAAS,EACTC,YAAY,EACZC,SAAS,IACVrC,MAAK,SAASsC,oBACTZ,QAAUY,eAAeX,UAAU,YAAa,OAChDD,SAAWA,QAAQE,OAAS,KAAOF,QAAQE,OAAS,WACpDzB,OAAOY,QAAQc,IAAI,2DAA4DH,QAAQE,aACvFrB,QAAQmB,SAGZnB,QAAQ,SACTgC,OAAM,WACLhC,QAAQ,SAGZA,QAAQ,SAEbgC,OAAM,WACLhC,QAAQ,WAEb,SAQXwB,gBAAiB,kBACN,IAAIzB,SAAQ,SAASC,QAASiC,WAC7BrC,OAAO6B,YACPzB,mBAGAkC,OAASlB,SAASmB,cAAc,UACpCD,OAAOE,IAAMpE,EAAEC,IAAIC,QAAU,8DAC7BgE,OAAOG,OAAS,WACZrC,WAEJkC,OAAOI,QAAU,WACbL,OAAO,IAAIM,MAAM,gCAErBvB,SAASwB,KAAKC,YAAYP,aASlCQ,UAAW,SAAS/B,QAASgC,MACzBA,KAAOA,MAAQ,cACXC,eAAiB5B,SAASC,eAAe,2BACxC2B,kBACDA,eAAiB5B,SAASmB,cAAc,QACzBU,GAAK,0BACpBD,eAAeE,MAAMC,QAAU,2DAC/B/B,SAASgC,KAAKP,YAAYG,qBAsB1BK,MAAQjC,SAASmB,cAAc,OACnCc,MAAMH,MAAMC,QAAU,eAdL,SACF,gBACF,kBACE,eACH,WAUsCJ,MAAQ,YARvC,SACJ,cACF,gBACE,eACH,SAIyEA,MAA/D,yMAGtBM,MAAMC,UAAY,gBAvBJ,SACC,wBACF,0BACE,+BACH,kBAmBgCP,MAAQ,eAAiBhC,QAAU,UAC/EiC,eAAeH,YAAYQ,OAE3BnC,YAAW,WACPmC,MAAMH,MAAMK,UAAY,8BACxBrC,YAAW,WACHmC,MAAMG,YACNH,MAAMG,WAAWC,YAAYJ,SAElC,OACJ,MAQPK,YAAa,SAASxF,OAAQyF,YAC1BC,MAAMxF,EAAEC,IAAIC,QAAU,iDAAkD,CACpEuF,OAAQ,OACRC,QAAS,gBACW,qCAEpBV,KAAM,UAAYW,mBAAmB7F,QAAU,gBAAkB6F,mBAAmBJ,YAChF,YAAcvF,EAAEC,IAAI2F,UAE3BnE,MAAK,SAASoE,iBACJA,SAASC,UAEnBrE,MAAK,SAASY,MACXT,OAAOY,QAAQc,IAAI,qCAAsCjB,SAE5D2B,OAAM,SAASzB,OACZX,OAAOY,QAAQD,MAAM,4CAA6CA,WAO1E5C,eAAgB,eACRkD,KAAOrD,KACXpB,EAAE4E,UAAU+C,GAAG,QAAS,4BAA4B,eAC5CC,KAAO5H,EAAEoB,MAAM6C,KAAK,QACxBQ,KAAKoD,WAAWD,SAEpB5H,EAAE4E,UAAU+C,GAAG,SAAU,oDAAoD,WACzElD,KAAKqD,kBAObtG,uBAAwB,eAChBiD,KAAOrD,KACXpB,EAAE,0BAA0B2H,GAAG,SAAS,WACpClD,KAAKsD,kCAObzG,eAAgB,eACRmD,KAAOrD,KAEXpB,EAAEgI,KAAK,CACHC,IAAKrG,EAAEC,IAAIC,QAAU,oDACrBuF,OAAQ,OACRa,SAAU,OACVjE,KAAM,CACFkE,OAAQ,OACRX,QAAS5F,EAAEC,IAAI2F,SAEnBnD,QAAS,SAASoD,UACVA,SAASpD,SAAWoD,SAASxD,OAC7BQ,KAAKjE,iBAAmBiH,SAASxD,KAE7BQ,KAAKlE,eAAiBkE,KAAKlE,cAAc0E,OAAS,GAClDR,KAAK2D,kCAIjBjE,MAAO,WACHM,KAAKjE,iBAAmB,OASpC4H,8BAA+B,eACvB3D,KAAOrD,KACNA,KAAKZ,kBAAqD,IAAjCY,KAAKZ,iBAAiByE,aAI/C1E,cAAc8H,SAAQ,SAASC,aAE5BA,OAAOC,eAAiBD,OAAOC,cAAc9B,IAAM6B,OAAOC,cAAcC,YAIxEC,gBAAkB,QAGlBH,OAAOI,cACPD,gBAAkBhE,KAAKjE,iBAAiBmI,MAAK,SAASC,UAC3CA,EAAEnC,KAAO6B,OAAOI,aAAeE,EAAEnC,KAAOoC,SAASP,OAAOI,YAAa,SAK/ED,iBAAmBH,OAAOQ,WAC3BL,gBAAkBhE,KAAKjE,iBAAiBmI,MAAK,SAASC,UAC3CA,EAAEG,MAAQH,EAAEG,KAAKC,gBAAkBV,OAAOQ,SAASE,mBAK7DP,iBAAmBH,OAAOC,eAAiBD,OAAOC,cAAcQ,OACjEN,gBAAkBhE,KAAKjE,iBAAiBmI,MAAK,SAASC,UAC3CA,EAAEG,MAAQH,EAAEG,KAAKC,gBAAkBV,OAAOC,cAAcQ,KAAKC,kBAKxEP,gBACAH,OAAOC,cAAgB,CACnB9B,GAAIgC,gBAAgBhC,GACpBsC,KAAMN,gBAAgBM,KACtBP,MAAOC,gBAAgBD,OAAS,WAEpCF,OAAOQ,SAAWL,gBAAgBM,KAClCT,OAAOI,YAAcD,gBAAgBhC,OAClC,KAECwC,WAAaxE,KAAKjE,iBAAiBmI,MAAK,SAASC,UAC1CA,EAAEG,MAAiC,YAAzBH,EAAEG,KAAKC,iBAExBC,aACAX,OAAOC,cAAgB,CACnB9B,GAAIwC,WAAWxC,GACfsC,KAAME,WAAWF,KACjBP,MAAOS,WAAWT,OAAS,kBAU/CT,4BAA6B,eACrBtD,KAAOrD,KAGP8H,iBAAmBzE,KAAKjE,iBAAiB2I,QAAO,SAASP,UAClDA,EAAEQ,aAETC,iBAAmB5E,KAAKjE,iBAAiB2I,QAAO,SAASP,UACjDA,EAAEQ,aAOVE,qBAAuBD,iBAAiBpE,OAAS,EACjDoE,iBAAiBE,KAAI,SAASC,WACnB,0CAA4CA,IAAI/C,GAAhD,6DAC0D+C,IAAIhB,OAAS,WADvE,qFAGyCgB,IAAIT,KAH7C,6CAI0CS,IAAIC,cAAgB,GAAK,WAC5C,IAArBD,IAAIC,aAAqB,IAAM,IALjC,kHAQmED,IAAI/C,GARvE,sXAce+C,IAAI/C,GAdnB,gSAqBRiD,KAAK,IACR,uZAO6CtJ,QAAQuJ,mBAPrD,6CAQ6CvJ,QAAQwJ,oBARrD,eAYAC,qBAAuBX,iBAAiBK,KAAI,SAASC,WAC9C,iGAC2DA,IAAIhB,OAAS,WADxE,mDAEwCgB,IAAIT,KAF5C,kDAG0CS,IAAIC,cAAgB,GAH9D,mBAKRC,KAAK,IAGJI,kBAhDe,CAAC,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,WAgD5DP,KAAI,SAASf,aACvC,sEAAwEA,MAC3E,wBAA0BA,MAAQ,kBACvCkB,KAAK,IAERzH,KAAKC,KAAK,CACNC,MAAO/B,QAAQ2J,WACf1H,KAAM,2GAE2CjC,QAAQ4J,kBAFnD,2KAM4B5J,QAAQ6J,aANpC,gfAgB+DH,kBAhB/D,iHAmBiC1J,QAAQ8J,YAnBzC,ubAiCmD9J,QAAQ+J,eAjC3D,kDAkCmDd,iBAAiBpE,OAlCpE,oDAoC2CqE,qBApC3C,2JAwCmDlJ,QAAQgK,kBAxC3D,kDAyCmDhK,QAAQiK,SAzC3D,qDA2C4CR,qBA3C5C,qBA8CNS,mBAAmB,EACnBC,iBAAiB,EACjBnH,MAAO,QACPoH,YAAa,CACTC,MAAO,0BACPtI,MAAO,0BACPuI,YAAa,0BACbC,cAAe,+BAEnBC,QAAS,eACDC,cAAgB,UAEpB7K,EAAE,wBAAwB2H,GAAG,SAAS,SAASxC,GAC3CA,EAAE2F,iBACF3F,EAAE4F,kBACa/K,EAAE,mBACRgL,YAAY,WAGzBhL,EAAE,mBAAmB2H,GAAG,SAAS,SAASxC,GACtCA,EAAE4F,qBAGN/K,EAAE4E,UAAU+C,GAAG,uBAAuB,SAASxC,GACtCnF,EAAEmF,EAAE8F,QAAQC,QAAQ,kCAAkCjG,QACvDjF,EAAE,mBAAmBmL,YAAY,WAIzCnL,EAAE,6BAA6B2H,GAAG,SAAS,SAASxC,GAChDA,EAAE2F,iBACF3F,EAAE4F,kBACFF,cAAgB7K,EAAEoB,MAAM6C,KAAK,SAC7BjE,EAAE,2BAA2BoL,IAAI,aAAcP,eAC/C7K,EAAE,uBAAuBqL,IAAIR,eAC7B7K,EAAE,mBAAmBmL,YAAY,WAGrCnL,EAAE,uBAAuB2H,GAAG,gBAAgB,SAASxC,GACjDA,EAAE4F,kBACFF,cAAgB7K,EAAEoB,MAAMiK,MACxBrL,EAAE,2BAA2BoL,IAAI,aAAcP,kBAGnD7K,EAAE,qBAAqB2H,GAAG,SAAS,eAC3BoB,KAAO/I,EAAE,sBAAsBqL,MAAMC,OACrCvC,KACAtE,KAAK8G,eAAexC,KAAM8B,gBAE1B7K,EAAE,sBAAsBwL,SAAS,SAASC,QAC1C/G,YAAW,WACP1E,EAAE,sBAAsBmL,YAAY,WACrC,SAIXnL,EAAE,sBAAsB2H,GAAG,YAAY,SAASxC,GAC5B,KAAZA,EAAEuG,OACF1L,EAAE,qBAAqB2L,WAI/B3L,EAAE,iBAAiB2H,GAAG,SAAS,SAASxC,GACpCA,EAAE4F,sBACEa,MAAQ5L,EAAEoB,MAAM6C,KAAK,MACrBuF,IAAM/E,KAAKjE,iBAAiBmI,MAAK,SAASC,UACnCA,EAAEnC,IAAMmF,SAEfpC,MACAxJ,EAAE4E,UAAUiH,IAAI,uBAChBpH,KAAKqH,uBAAuBtC,SAIpCxJ,EAAE,mBAAmB2H,GAAG,SAAS,SAASxC,GACtCA,EAAE4F,sBACEa,MAAQ5L,EAAEoB,MAAM6C,KAAK,MACrBuF,IAAM/E,KAAKjE,iBAAiBmI,MAAK,SAASC,UACnCA,EAAEnC,IAAMmF,SAEfpC,MACAxJ,EAAE4E,UAAUiH,IAAI,uBAChBpH,KAAKsH,sBAAsBvC,UAIvCwC,UAAW,WACPhM,EAAE4E,UAAUiH,IAAI,2BAU5BN,eAAgB,SAASxC,KAAMP,WACvB/D,KAAOrD,KAEXpB,EAAEgI,KAAK,CACHC,IAAKrG,EAAEC,IAAIC,QAAU,oDACrBuF,OAAQ,OACRa,SAAU,OACVjE,KAAM,CACFkE,OAAQ,SACRY,KAAMA,KACNP,MAAOA,MACPhB,QAAS5F,EAAEC,IAAI2F,SAEnBnD,QAAS,SAASoD,UACVA,SAASpD,SACTI,KAAKjE,iBAAiByL,KAAKxE,SAASxD,MACpChC,KAAKiK,QACLjK,KAAKC,KAAK,CACNiK,KAAM,UACNhK,MAAO/B,QAAQgM,gBACfC,MAAO,KACP/B,mBAAmB,IACpBjH,MAAK,WACJoB,KAAKsD,kCAGT9F,KAAKqK,sBAAsB7E,SAASlD,UAG5CJ,MAAO,SAASoI,SACRC,IAAOD,IAAIE,cAAgBF,IAAIE,aAAalI,SAAY,4BAC5DtC,KAAKC,KAAK,CAACiK,KAAM,QAAShK,MAAO/B,QAAQ+D,MAAOuI,KAAMF,UASlEV,uBAAwB,SAAShD,cACzBrE,KAAOrD,KAGP0I,kBAFe,CAAC,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,WAE5DP,KAAI,SAASf,aAEvC,0DADUA,MAAMQ,iBAAmBF,SAASN,OAAS,WAAWQ,cACS,YAAc,IAC1F,iBAAmBR,MAAQ,wBAA0BA,MAAQ,kBAClEkB,KAAK,IAERzH,KAAKC,KAAK,CACNC,MAAO/B,QAAQuM,aACftK,KAAM,uLAGGyG,SAASN,OAAS,WAHrB,+EAI0EM,SAASC,KAJnF,0FAQ6C3I,QAAQ2I,KARrD,uFAUED,SAASC,KAAKvG,QAAQ,KAAM,UAV9B,qFAa6CpC,QAAQoI,MAbrD,uFAekDsB,kBAflD,sGAkBWhB,SAASN,OAAS,WAlB7B,WAmBqBpI,QAAQwM,OAnB7B,kCAwBN/J,kBAAkB,EAClBC,kBAAmB1C,QAAQyM,YAC3B7J,iBAAkB5C,QAAQ6C,OAC1BuH,YAAa,CACTC,MAAO,yBACPqC,cAAe,+BACfC,aAAc,+BAElBnC,QAAS,eACDC,cAAgB/B,SAASN,OAAS,UAEtCxI,EAAE,kBAAkB2H,GAAG,SAAS,WAC5B3H,EAAE,sBAAsB0M,KAAK1M,EAAEoB,MAAMiK,OAAS,eAGlDrL,EAAE,8BAA8B2H,GAAG,SAAS,WACxCkD,cAAgB7K,EAAEoB,MAAM6C,KAAK,SAC7BjE,EAAE,8BAA8BmL,YAAY,YAC5CnL,EAAEoB,MAAMoK,SAAS,YACjBxL,EAAE,uBAAuBoL,IAAI,aAAcP,eAC3C7K,EAAE,2BAA2BqL,IAAIR,kBAGrC7K,EAAE,2BAA2B2H,GAAG,SAAS,WACrCkD,cAAgB7K,EAAEoB,MAAMiK,MACxBrL,EAAE,8BAA8BmL,YAAY,YAC5CnL,EAAE,uBAAuBoL,IAAI,aAAcP,mBAGnDmC,WAAY,eACJjE,KAAOnE,SAASC,eAAe,iBAAiBoI,MAAM3B,OACtD9C,MAAQ5D,SAASC,eAAe,0BAA0BoI,aACzDlE,KAIE,CAACA,KAAMA,KAAMP,MAAOA,QAHvBvG,KAAKqK,sBAAsBlM,QAAQ8M,0BAC5B,MAIhB7J,MAAK,SAASC,QACTA,OAAOC,aACPkB,KAAK0I,eAAerE,SAASrC,GAAInD,OAAO2J,MAAMlE,KAAMzF,OAAO2J,MAAMzE,WAW7E2E,eAAgB,SAASC,WAAYrE,KAAMP,WACnC/D,KAAOrD,KAEXpB,EAAEgI,KAAK,CACHC,IAAKrG,EAAEC,IAAIC,QAAU,oDACrBuF,OAAQ,OACRa,SAAU,OACVjE,KAAM,CACFkE,OAAQ,SACRO,YAAa0E,WACbrE,KAAMA,KACNP,MAAOA,MACPhB,QAAS5F,EAAEC,IAAI2F,SAEnBnD,QAAS,SAASoD,aACVA,SAASpD,QAAS,KACdgJ,IAAM5I,KAAKjE,iBAAiB8M,WAAU,SAAS1E,UACxCA,EAAEnC,IAAM2G,eAEN,IAATC,MACA5I,KAAKjE,iBAAiB6M,KAAO5F,SAASxD,MAE1ChC,KAAKC,KAAK,CACNiK,KAAM,UACNhK,MAAO/B,QAAQmN,gBACflB,MAAO,KACP/B,mBAAmB,IACpBjH,MAAK,WACJoB,KAAKsD,sCAGT9F,KAAKC,KAAK,CAACiK,KAAM,QAAShK,MAAO/B,QAAQ+D,MAAOuI,KAAMjF,SAASlD,WAGvEJ,MAAO,SAASoI,SACRC,IAAOD,IAAIE,cAAgBF,IAAIE,aAAalI,SAAY,GAC5DtC,KAAKC,KAAK,CAACiK,KAAM,QAAShK,MAAO/B,QAAQ+D,MAAOuI,KAAMF,UASlET,sBAAuB,SAASjD,cACxBrE,KAAOrD,KAEXa,KAAKC,KAAK,CACNC,MAAO/B,QAAQoN,sBACfnL,KAAM,MAAQjC,QAAQqN,sBAAsBjL,QAAQ,SAAU,WAAasG,SAASC,KAChF,aAAe,OACnBoD,KAAM,UACNtJ,kBAAkB,EAClBK,mBAAoB,UACpBJ,kBAAmB1C,QAAQsN,UAC3B1K,iBAAkB5C,QAAQ6C,SAC3BI,MAAK,SAASC,QACTA,OAAOC,aACPkB,KAAKkJ,eAAe7E,SAASrC,QASzCkH,eAAgB,SAASP,gBACjB3I,KAAOrD,KAEXpB,EAAEgI,KAAK,CACHC,IAAKrG,EAAEC,IAAIC,QAAU,oDACrBuF,OAAQ,OACRa,SAAU,OACVjE,KAAM,CACFkE,OAAQ,SACRO,YAAa0E,WACb5F,QAAS5F,EAAEC,IAAI2F,SAEnBnD,QAAS,SAASoD,UACVA,SAASpD,SACTI,KAAKjE,iBAAmBiE,KAAKjE,iBAAiB2I,QAAO,SAASP,UACnDA,EAAEnC,IAAM2G,cAEnBnL,KAAKC,KAAK,CACNiK,KAAM,UACNhK,MAAO/B,QAAQwN,gBACfvB,MAAO,IACP/B,mBAAmB,IACpBjH,MAAK,WACJoB,KAAKsD,kCAGT9F,KAAKC,KAAK,CAACiK,KAAM,QAAShK,MAAO/B,QAAQ+D,MAAOuI,KAAMjF,SAASlD,WAGvEJ,MAAO,SAASoI,SACRC,IAAOD,IAAIE,cAAgBF,IAAIE,aAAalI,SAAY,4BAC5DtC,KAAKC,KAAK,CAACiK,KAAM,QAAShK,MAAO/B,QAAQ+D,MAAOuI,KAAMF,UASlEqB,oBAAqB,SAASvF,YACtB7D,KAAOrD,QAENkH,SACDA,OAAS7D,KAAKhE,eAGb6H,QAAWA,OAAOwF,UASnB3G,WAAamB,OAAOyF,aAAezF,OAAOS,MAAQ3I,QAAQ4N,eAC1DC,QAAU3F,OAAO2F,QAAU,aAAajF,cAE5C/G,KAAKC,KAAK,CACNC,MAAO/B,QAAQ8N,oBACf7L,KAAM,MAAQjC,QAAQ+N,oBAAoB3L,QAAQ,SAAU,WAAa2E,WACrE,aAAe,OACnBgF,KAAM,UACNtJ,kBAAkB,EAClBK,mBAAoB,UACpBJ,kBAAmB,+BAAiC1C,QAAQsN,UAC5D1K,iBAAkB5C,QAAQ6C,SAC3BI,MAAK,SAASC,QACTA,OAAOC,aACPkB,KAAK2J,aAAa9F,OAAOwF,KAAMG,OAAQ9G,oBAtB3ClF,KAAKC,KAAK,CACNiK,KAAM,UACNhK,MAAO/B,QAAQiO,iBACf3B,KAAMtM,QAAQkO,iBA8B1BF,aAAc,SAASN,KAAMG,OAAQ9G,gBAC7B1C,KAAOrD,KAEXa,KAAKC,KAAK,CACNC,MAAO/B,QAAQmO,eACf7B,KAAMtM,QAAQoO,mBACdC,mBAAmB,EACnBC,gBAAgB,EAChB9D,QAAS,WACL3I,KAAK0M,iBAIO3O,EAAEgI,KAAK,CACvBC,IAAKrG,EAAEC,IAAIC,QAAU,6DACrBuF,OAAQ,OACRa,SAAU,OACVjE,KAAM,CACFkE,OAAQ,gBACR2F,KAAMA,KACNG,OAAQA,OACRzG,QAAS5F,EAAEC,IAAI2F,WAITnE,MAAK,SAASoE,cACnBA,SAASpD,eACVpC,KAAKiK,aACLjK,KAAKC,KAAK,CACNiK,KAAM,QACNhK,MAAO/B,QAAQwO,aACflC,KAAMjF,SAASlD,UAKvBE,KAAKoK,mBAAmB1H,WAAuB,cAAX8G,QAEpCxJ,KAAKlE,cAAgBkE,KAAKlE,cAAc4I,QAAO,SAAS2F,UAC7CA,EAAEhB,OAASA,QAGlBrJ,KAAKhE,eAAiBgE,KAAKhE,cAAcqN,OAASA,OAClDrJ,KAAKhE,cAAgB,KACrBgE,KAAK/D,kBAAoB,MAG7B+D,KAAKsK,kBAAkBtK,KAAKlE,eAC5BkE,KAAKuK,kBAAkBvK,KAAKlE,cAAc0E,QAE1CjF,EAAE,mBAAmBwL,SAAS,UAC9BxL,EAAE,uBAAuBmL,YAAY,UACrCnL,EAAE,6BAA6BwL,SAAS,UACxCxL,EAAE,8BAA8B0M,KAAKtM,QAAQkO,eAE7CrM,KAAKiK,QACLzH,KAAK6B,UAAUlG,QAAQ6O,qBAAsB,cAE9CrJ,OAAM,SAAS2G,KACdtK,KAAKiK,YACDgD,SAAW,OAGXA,SADeC,KAAKC,MAAM7C,IAAI8C,cACV9K,SAAW,GACjC,MAAOY,GACDoH,IAAIE,cAAgBF,IAAIE,aAAalI,UACrC2K,SAAW3C,IAAIE,aAAalI,SAGpCtC,KAAKC,KAAK,CACNiK,KAAM,QACNhK,MAAO/B,QAAQwO,aACflC,KAAMwC,eAUlBL,mBAAoB,SAAS1H,WAAYmI,eACrCtP,EAAEgI,KAAK,CACHC,IAAKrG,EAAEC,IAAIC,QAAU,yDACrBuF,OAAQ,OACRa,SAAU,OACVjE,KAAM,CACFsL,YAAapI,WACbqI,gBAAiBF,cAAgB,EAAI,EACrC9H,QAAS5F,EAAEC,IAAI2F,WAEpBxD,MAAK,SAASyD,UACbjE,OAAOY,QAAQc,IAAI,8CAA+CuC,aACnEvD,MAAK,SAASC,OACbX,OAAOY,QAAQU,KAAK,sDAAuDX,WAQnFsL,2BAA4B,SAASnH,YAC7B7D,KAAOrD,UAGNsO,0BAA4BpH,OAAOwF,SAkBhC6B,QAfJC,eAAiB,kBACJnL,KAAKlE,cAAcoI,MAAK,SAASmG,UACnCA,EAAEhB,OAASrJ,KAAKiL,8BAEVpH,QAIjBuH,qBAAuB,eACnBf,EAAIc,wBACDd,EAAEvG,eAAiB,CAACQ,KAAM+F,EAAEhG,UAAY1I,QAAQ0P,QAAStH,MAAO,YAKnEmH,QAAUE,uBACd7P,EAAE,iBAAiBoL,IAAI,aAAcuE,QAAQnH,OAAS,WACtDxI,EAAE,kBAAkB0M,KAAKiD,QAAQ5G,MAAQ3I,QAAQ0P,SAIrD9P,EAAE,6BAA6BmL,YAAY,cAEvC4E,cAAgB,eACZtP,cAAgBmP,iBAChBD,QAAUE,uBAEVG,SAAWvL,KAAKjE,iBAAiB+I,KAAI,SAASC,SAC1CyG,WAAcN,QAAQlJ,IAAM+C,IAAI/C,KAAOkJ,QAAQlJ,IACjChG,cAAciI,aAAec,IAAI/C,KAAOhG,cAAciI,cACrDiH,QAAQlJ,KAAOhG,cAAciI,aAAec,IAAIT,KAAKC,iBACtD2G,QAAQ5G,MAAQ,WAAWC,oBACtC,2DACFiH,WAAa,YAAc,IAAM,cAAgBzG,IAAI/C,GAAK,gBAAkB+C,IAAIT,KACjF,kBAAoBS,IAAIhB,OAAS,WAF9B,iEAG8DgB,IAAIhB,OAAS,WAH3E,sDAK2CgB,IAAIT,KAAO,WACxDkH,WAAa,+LAEgC,IAClD,eACDvG,KAAK,IAER1J,EAAE,2BAA2BqC,KAAK2N,UAElChQ,EAAE,+BAA+B6L,IAAI,SAASlE,GAAG,SAAS,SAASxC,GAC/DA,EAAE2F,iBACF3F,EAAE4F,sBACEa,MAAQ5L,EAAEoB,MAAM6C,KAAK,MACrBiM,QAAUlQ,EAAEoB,MAAM6C,KAAK,QACvBkM,SAAWnQ,EAAEoB,MAAM6C,KAAK,SAC5BjE,EAAE,2BAA2BmL,YAAY,YACrCiF,YAAcR,iBAClBnL,KAAK4L,qBAAqBD,YAAYtC,KAAMlC,MAAOsE,QAASC,SAAUC,aAEtEpQ,EAAE,iBAAiBoL,IAAI,aAAc+E,UACrCnQ,EAAE,kBAAkB0M,KAAKwD,aAKjClQ,EAAE,yBAAyB6L,IAAI,SAASlE,GAAG,SAAS,SAASxC,GACzDA,EAAE2F,iBACF3F,EAAE4F,kBAEEtG,KAAKjE,kBAAoBiE,KAAKjE,iBAAiByE,OAAS,GACxD8K,gBAEJ/P,EAAE,2BAA2BgL,YAAY,WAIxC5J,KAAKZ,kBAAqD,IAAjCY,KAAKZ,iBAAiByE,OAqBhD8K,gBApBA/P,EAAEgI,KAAK,CACHC,IAAKrG,EAAEC,IAAIC,QAAU,oDACrBuF,OAAQ,OACRa,SAAU,OACVjE,KAAM,CACFkE,OAAQ,OACRX,QAAS5F,EAAEC,IAAI2F,SAEnBnD,QAAS,SAASoD,UACVA,SAASpD,SAAWoD,SAASxD,OAC7BQ,KAAKjE,iBAAmBiH,SAASxD,MAErC8L,iBAEJ5L,MAAO,WACHM,KAAKjE,iBAAmB,GACxBuP,mBAOZ/P,EAAE,2BAA2B6L,IAAI,SAASlE,GAAG,SAAS,SAASxC,GAC3DA,EAAE4F,qBAGN/K,EAAE4E,UAAUiH,IAAI,0BAA0BlE,GAAG,0BAA0B,SAASxC,GACvEnF,EAAEmF,EAAE8F,QAAQC,QAAQ,8BAA8BjG,QACnDjF,EAAE,2BAA2BmL,YAAY,YAarDkF,qBAAsB,SAASvC,KAAMV,WAAYnD,aAAcqG,cAAehI,YACtE7D,KAAOrD,KACP6M,OAAS3F,QAAUA,OAAO2F,QAAyB,YAGvDjO,EAAE,iBAAiBoL,IAAI,aAAckF,eACrCtQ,EAAE,kBAAkB0M,KAAKzC,kBAGrBsG,WAAa9L,KAAKlE,cAAc+M,WAAU,SAASwB,UAC5CA,EAAEhB,OAASA,QAElB0C,YAAc,KACdC,cAAgB,KAChBC,gBAAkB,MAEF,IAAhBH,aAEAC,YAAc/L,KAAKlE,cAAcgQ,YAAYzH,SAC7C2H,cAAgBhM,KAAKlE,cAAcgQ,YAAY7H,YAC/CgI,gBAAkBjM,KAAKlE,cAAcgQ,YAAYhI,cAGjD9D,KAAKlE,cAAcgQ,YAAYzH,SAAWmB,aAC1CxF,KAAKlE,cAAcgQ,YAAY7H,YAAc0E,WAC7C3I,KAAKlE,cAAcgQ,YAAYhI,cAAgB,CAC3C9B,GAAI2G,WACJrE,KAAMkB,aACNzB,MAAO8H,gBAIftQ,EAAEgI,KAAK,CACHC,IAAKrG,EAAEC,IAAIC,QAAU,2DACrBuF,OAAQ,OACRa,SAAU,OACVjE,KAAM,CACF6J,KAAMA,KACNpF,YAAa0E,WACba,OAAQA,OACRzG,QAAS5F,EAAEC,IAAI2F,SAEnBnD,QAAS,SAASoD,aACVA,SAASpD,QACTrE,EAAE,yBAAyBwL,SAAS,iBACpC9G,YAAW,WACP1E,EAAE,yBAAyBmL,YAAY,mBACxC,SACA,KAEiB,IAAhBoF,WAAmB,CACnB9L,KAAKlE,cAAcgQ,YAAYzH,SAAW0H,YAC1C/L,KAAKlE,cAAcgQ,YAAY7H,YAAc+H,cAC7ChM,KAAKlE,cAAcgQ,YAAYhI,cAAgBmI,oBAE3CC,SAAYD,iBAAmBA,gBAAgBlI,OAAU,UACzDoI,QAAWF,iBAAmBA,gBAAgB3H,MAASyH,aAAepQ,QAAQ0P,QAClF9P,EAAE,iBAAiBoL,IAAI,aAAcuF,UACrC3Q,EAAE,kBAAkB0M,KAAKkE,SAE7B3O,KAAKC,KAAK,CACNiK,KAAM,QACNhK,MAAO/B,QAAQ+D,MACfuI,KAAMjF,SAASlD,YAI3BJ,MAAO,SAASoI,SAEQ,IAAhBgE,WAAmB,CACnB9L,KAAKlE,cAAcgQ,YAAYzH,SAAW0H,YAC1C/L,KAAKlE,cAAcgQ,YAAY7H,YAAc+H,cAC7ChM,KAAKlE,cAAcgQ,YAAYhI,cAAgBmI,oBAE3CC,SAAYD,iBAAmBA,gBAAgBlI,OAAU,UACzDoI,QAAWF,iBAAmBA,gBAAgB3H,MAASyH,aAAepQ,QAAQ0P,QAClF9P,EAAE,iBAAiBoL,IAAI,aAAcuF,UACrC3Q,EAAE,kBAAkB0M,KAAKkE,aAEzBpE,IAAOD,IAAIE,cAAgBF,IAAIE,aAAalI,SAAY,GAC5DtC,KAAKC,KAAK,CAACiK,KAAM,QAAShK,MAAO/B,QAAQ+D,MAAOuI,KAAMF,UAWlEqE,qBAAsB,SAAS5M,KAAMqD,gBAC5BrD,MAAwB,IAAhBA,KAAKgB,OAIXqC,QAAQ6B,QAAO,SAAS2H,gBACvBC,aAAe,EACfC,WAAaC,KAAKC,IAAIjN,KAAKgB,OAAQ,IAE9BkM,EAAI,EAAGA,EAAIH,WAAYG,IAAK,KAC7B9F,IAAMpH,KAAKkN,GAAGL,WACdzF,MAAAA,KAA6C,KAARA,IAAY,KAC7C+F,IAAMC,WAAWhG,MAChBiG,MAAMF,MAAQG,SAASH,MACxBL,uBAKLA,cAA6B,GAAbC,cAjBhB,IAyBfnJ,WAAY,SAASD,WACZ9G,YAAc8G,KACnB5H,EAAE,4BAA4BmL,YAAY,UAC1CnL,EAAE,uCAAyC4H,KAAO,MAAM4D,SAAS,UAEpD,UAAT5D,MACA5H,EAAE,sBAAsBmL,YAAY,UACpCnL,EAAE,sBAAsBwL,SAAS,YAEjCxL,EAAE,sBAAsBwL,SAAS,UACjCxL,EAAE,sBAAsBmL,YAAY,eAC/BrD,gBAQb0J,aAAc,eACNC,SAAWjO,OAAOkO,uBAClBD,UAAYA,SAASE,QACdF,SAASE,QAEb,MAQXC,WAAY,SAASC,aACZA,cACM,UAEPC,KAAO,IAAIC,KAAKF,SAEhBG,KADM,IAAID,KACGD,KACbG,KAAOhB,KAAKiB,MAAMF,eAET,IAATC,WACO,UAAYH,KAAKK,mBAAmB,GAAI,CAACC,KAAM,UAAWC,OAAQ,YACtE,GAAa,IAATJ,WACA,cAAgBH,KAAKK,mBAAmB,GAAI,CAACC,KAAM,UAAWC,OAAQ,YAC1E,GAAIJ,KAAO,EAAG,OACF,CAAC,SAAU,SAAU,UAAW,YAAa,WAAY,SAAU,YAClEH,KAAKQ,UAAY,KAAOR,KAAKK,mBAAmB,GAAI,CAACC,KAAM,UAAWC,OAAQ,mBAEvFP,KAAKS,qBAAuB,KAAOT,KAAKK,mBAAmB,GAAI,CAACC,KAAM,UAAWC,OAAQ,aAOxGhR,YAAa,eACLoD,KAAOrD,SACCA,KAAKoQ,sBAGT/M,KAAK7D,WAAa6D,KAAK5D,YACvB4D,KAAK7D,kBACL8D,YAAW,WACPD,KAAKpD,gBACN,OAGHrB,EAAE,mBAAmBwL,SAAS,eAC9BxL,EAAE,uBAAuBmL,YAAY,UAAU9I,KAC3C,wMAQRmQ,iBAAmB,IAAI7O,SAAQ,SAASC,SACxC3D,KAAK4D,KAAK,CAAC,CACPC,WAAY,yCACZC,KAAM,MACN,GAAGC,MAAK,SAASV,gBAETmP,OAAStD,KAAKC,MAAM9L,OAAOW,MAAQ,MACvCL,QAAQ,CAAC6O,SACX,MAAOtN,GACLvB,QAAQ,CAAC,CAAC8O,QAAS,GAAIzO,KAAM,UAElCC,MAAK,WACJN,QAAQ,CAAC,CAAC8O,QAAS,GAAIzO,KAAM,YAIjC0O,cAAgB,IAAIhP,SAAQ,SAASC,SACrC3D,KAAK4D,KAAK,CAAC,CACPC,WAAY,6CACZC,KAAM,MACN,GAAGC,MAAK,SAASV,YACbmE,SAAYnE,QAAUA,OAAOW,KAAQX,OAAOW,KAAQX,QAAU,GAClEM,QAAQ,CAACS,SAAS,EAAMqO,QAASjL,SAASiL,SAAW,QACtDxO,MAAK,WACJN,QAAQ,CAACS,SAAS,EAAMqO,QAAS,WAIzC1S,EAAE4S,KAAKJ,iBAAkBG,eAAetP,MACpC,SAASwP,aAAcC,eACfC,KAAOF,aAAa,IAAMA,cAAgB,GAC1CG,KAAOF,UAAU,IAAMA,WAAa,GAEpCG,iBAAmBF,KAAKL,SAAWK,KAAK9O,MAAQ,GAChDiP,cAAgBF,KAAKN,SAAW,GAEpCO,kBAAoBE,MAAMC,QAAQH,kBAAoBA,iBAAmB,IAAI1J,KAAI,SAASuF,MACtFA,EAAEb,OAASa,EAAEb,QAAU,YAEnBa,EAAEvG,eAA4C,iBAApBuG,EAAEvG,kBAExBuG,EAAEvG,cAAgB4G,KAAKC,MAAMN,EAAEvG,eACjC,MAAOpD,GACL2J,EAAEvG,cAAgB,YAGnBuG,KAEXoE,eAAiBC,MAAMC,QAAQF,eAAiBA,cAAgB,IAAI3J,KAAI,SAASuF,MAC7EA,EAAEb,OAAS,SAEPa,EAAEvG,eAA4C,iBAApBuG,EAAEvG,kBAExBuG,EAAEvG,cAAgB4G,KAAKC,MAAMN,EAAEvG,eACjC,MAAOpD,GACL2J,EAAEvG,cAAgB,YAGnBuG,KAGXrK,KAAKlE,cAAgB0S,iBAAiBI,OAAOH,eAE7CzO,KAAKlE,cAAc+S,MAAK,SAASC,EAAGC,UACzB,IAAIzB,KAAKyB,EAAEC,YAAc,IAAI1B,KAAKwB,EAAEE,eAI/ChP,KAAK2D,gCAEL3D,KAAKsK,kBAAkBtK,KAAKlE,eAC5BkE,KAAKuK,kBAAkBvK,KAAKlE,cAAc0E,WAE9C,SAASsH,KACLvM,EAAE,mBAAmBwL,SAAS,UACX,MAAfe,IAAImH,OACJ1T,EAAE,uBAAuBmL,YAAY,UAAU9I,KAC3C,4EAC4BjC,QAAQuT,eADpC,8BAE2BvT,QAAQwT,sBAFnC,wGAImCxT,QAAQyT,YAAc,aAG7D7T,EAAE,uBAAuBmL,YAAY,UAAU9I,KAC3C,yFAC4BjC,QAAQ0T,oBADpC,8BAE2B1T,QAAQ2T,cAFnC,gHAImC3T,QAAQ4T,MAAQ,iBAWvEhF,kBAAmB,SAASiF,WACpBC,UAAsB,IAAVD,MAAc7T,QAAQ+T,YAAcF,MAAQ,IAAM7T,QAAQgU,aAC1EpU,EAAE,iCAAiC0M,KAAKtM,QAAQiU,oBAAoB7R,QAAQ,UACxE0R,UAAUlL,iBAOlB+F,kBAAmB,SAAS2D,aACpBjO,KAAOrD,KAEPA,KAAKT,wBACAA,iBAAiB2T,eACjB3T,iBAAmB,UAGxB4T,MAAQvU,EAAE,qBACduU,MAAMC,QAENxU,EAAE,mBAAmBwL,SAAS,WAEzBkH,SAA8B,IAAnBA,QAAQzN,cACpBjF,EAAE,uBAAuBmL,YAAY,eACrCnL,EAAE,0BAA0BwL,SAAS,UAIzCxL,EAAE,uBAAuBwL,SAAS,UAClCxL,EAAE,0BAA0BmL,YAAY,UAExCuH,QAAQrK,SAAQ,SAASC,YACjBwJ,KAAOrN,KAAKmN,WAAWtJ,OAAOmL,YAC9BgB,SAAWnM,OAAOoM,WAAapM,OAAOqM,YAAc,GACpDC,cAAgBH,SAAW,2CAA6CA,SACxE,sCAAwCA,SAAW,UAAY,GAC/DI,cAAgBvM,OAAOQ,SAAW,yCAA2CR,OAAOQ,SACpF,UAAY,GAEZmF,QAAU3F,OAAO2F,QAAU,aAAajF,cACxC8L,YAAc,GAEdA,YADW,WAAX7G,OACc,wEACV7N,QAAQ2U,OAAS,UAEP,oEACV3U,QAAQ4U,GAAK,cAGjBC,IAAMjV,EAAE,oDAAsDsI,OAAOwF,KACrE,yBAA2BG,OAAS,WACxCgH,IAAI5S,KACA,gFAGSiG,OAAOyF,aAAezF,OAAOS,MAAQ3I,QAAQ4N,gBAHtD,kDAIqD6G,cAAgBD,cAJrE,kDAOmC9C,KAPnC,oBAQSgD,YAAc,SAG3BP,MAAMW,OAAOD,QAGjBjV,EAAE,0BAA0B6L,IAAI,QAAS,uBAAuBlE,GAAG,QAAS,uBACxE,eACIwN,KAAOnV,EAAEoB,MACT0M,KAAOqH,KAAKlR,KAAK,eAErBjE,EAAE,uBAAuBmL,YAAY,iBACrCgK,KAAK3J,SAAS,iBACd/G,KAAK2Q,kBAAkBtH,SAG3BpJ,YAAW,eAEHD,KAAK9D,iBAAmB,IAAI6C,OAAO6R,iBAAiBC,UAAU,iBAAkB,CAC5EC,YAAY,EACZC,aAAa,EACbC,QAAS,GACTC,SAAS,EACTC,OAAQ,CACJC,YAAaxV,QAAQyV,cACrBC,OAAQ1V,QAAQ2V,eAChBC,KAAM5V,QAAQ6V,kBAItBvR,YAAW,WACP1E,EAAE,sBAAsBmL,YAAY,uBACrC,KAEHzG,YAAW,eACHwR,SAAWlW,EAAE,uBAAuBmW,WACpCD,SAASjR,SAAWR,KAAKhE,cAAe,CACxCyV,SAAS1K,SAAS,qBACd4K,UAAYF,SAASjS,KAAK,eAC1BmS,WACA3R,KAAK2Q,kBAAkBgB,cAGhC,KACL,MAAOjR,GACL3B,OAAOY,QAAQU,KAAK,mCAAoCK,MAE7D,MAOPiQ,kBAAmB,SAAStH,UACpBrJ,KAAOrD,KAEXpB,EAAE,uBAAuBwL,SAAS,UAClCxL,EAAE,mBAAmBwL,SAAS,UAC9BxL,EAAE,mBAAmBmL,YAAY,cAE7BkL,aAAejV,KAAKb,cAAcoI,MAAK,SAASmG,UACzCA,EAAEhB,OAASA,QAElBG,OAASoI,cAAgBA,aAAapI,QAAyB,YAE/DoI,eACArW,EAAE,8BAA8B0M,KAAK2J,aAAatI,aAAesI,aAAatN,MAC1E3I,QAAQkW,eACZ7R,KAAKgL,2BAA2B4G,eAGrB,WAAXpI,QAAuBoI,aACvB5R,KAAK8R,iBAAiBF,cAK1BpW,KAAK4D,KAAK,CAAC,CACPC,WAAY,gDACZC,KAAM,CACFyS,SAAU,eAAiB1I,KAC3BzG,OAAQ,MACRT,KAAM,OAEV,GAAG5C,MAAK,SAASV,gBAETmE,SAAW0H,KAAKC,MAAM9L,OAAOW,MAAQ,MACrCqE,OAASb,SAASa,QAAUb,SAC5BxD,KAAOwD,SAASxD,MAAQ,GAE5BqE,OAAO2F,OAASA,WAEZwI,SAAWhP,SAASiP,KAAQpO,QAAUA,OAAOqO,WAAerO,QAAUA,OAAOoO,QACvDjP,SAASmP,sBAAwB3S,MAAwB,IAAhBA,KAAKgB,SAAiBwR,WAE9DA,qBACvBhS,KAAKoS,qBAAqBJ,SAAUnO,OAAOwO,QAAU,IAChDzT,MAAK,SAAS0T,qBACPC,UAAYD,gBAAgB9S,MAAQ,GAExCQ,KAAKhE,cAAgB6H,OACrB7D,KAAK/D,kBAAoBsW,cAErBzG,WAAa9L,KAAKlE,cAAc+M,WAAU,SAASwB,UAC5CA,EAAEhB,OAASA,SAEF,IAAhByC,aACA9L,KAAKlE,cAAcgQ,YAAc0G,OAAOC,OAAO,GAAI5O,OAC/C,CAACrE,KAAM+S,UAAW/I,OAAQA,UAGlCxJ,KAAK0S,oBAAoB7O,OAAQ0O,cAEpCpR,OAAM,SAASzB,OACZnE,EAAE,mBAAmBwL,SAAS,UAC9BxL,EAAE,mBAAmBqC,KACjB,4EACkDjC,QAAQgX,sBACtD,KAAOjT,MAAMI,QAFjB,oGAIuDuJ,KAJvD,sCAKuC1N,QAAQ4T,MAL/C,mBAOF7I,YAAY,aAK1B1G,KAAKhE,cAAgB6H,OACrB7D,KAAK/D,kBAAoBuD,SAErBsM,WAAa9L,KAAKlE,cAAc+M,WAAU,SAASwB,UAC5CA,EAAEhB,OAASA,SAEF,IAAhByC,aACA9L,KAAKlE,cAAcgQ,YAAc0G,OAAOC,OAAO,GAAI5O,OAAQ,CAACrE,KAAMA,KAAMgK,OAAQA,UAGpFxJ,KAAK0S,oBAAoB7O,OAAQrE,MACnC,MAAOkB,GACLnF,EAAE,mBAAmBwL,SAAS,UAC9BxL,EAAE,mBAAmBqC,KACjB,4EACkDjC,QAAQiX,0BAD1D,oGAGuDvJ,KAHvD,sCAIuC1N,QAAQ4T,MAJ/C,mBAMF7I,YAAY,cAEnBjH,MAAK,WACJlE,EAAE,mBAAmBwL,SAAS,UAC9BxL,EAAE,mBAAmBqC,KACjB,4EACkDjC,QAAQiX,0BAD1D,oGAGuDvJ,KAHvD,sCAIuC1N,QAAQ4T,MAJ/C,mBAMF7I,YAAY,cAQtBoL,iBAAkB,SAASF,kBACnB5R,KAAOrD,KAEPkW,WAAajB,aAAaiB,YAAc,GACxCC,iBAAmBlB,aAAamB,oBAAsBnB,aAAatN,KAEvE/I,EAAEgI,KAAK,CACHC,IAAKrG,EAAEC,IAAIC,QAAU,iCAAmCF,EAAEC,IAAI2F,QAC1D,gDACJH,OAAQ,OACRoQ,YAAa,mBACbxT,KAAMkL,KAAKuI,UAAU,CAAC,CAClBC,MAAO,EACP7T,WAAY,0CACZC,KAAM,CACF6T,SAAUL,iBACVD,WAAYnI,KAAKuI,UAAUJ,YAC3BO,aAAa,MAGrBC,QAAS,IACTzT,QAAS,SAAS0T,aACVzU,OAAS6P,MAAMC,QAAQ2E,UAAYA,QAAQ9S,OAAS,EAAI8S,QAAQ,GAAK,QAErEzU,QAAUA,OAAOa,aACjBnE,EAAE,mBAAmBwL,SAAS,eAC9BxL,EAAE,mBAAmBqC,KACjB,6EAEMiB,OAAO0U,WAAa1U,OAAO0U,UAAUzT,SAAYjB,OAAOa,OAF9D,oGAIuDkS,aAAavI,KAJpE,sCAKuC1N,QAAQ4T,MAL/C,mBAOF7I,YAAY,cAId1D,SAAYnE,QAAUA,OAAOW,KAAQX,OAAOW,KAAQX,QAAU,MAC9DmE,SAASpD,QAAS,KAEdJ,MADawD,SAASsQ,SAAWtQ,SAASxD,MAAQ,IAChCsF,KAAI,SAAS0L,QAC3BA,IAAIgD,OAAS9E,MAAMC,QAAQ6B,IAAIgD,OAAQ,KACnCC,QAAU,UACdjD,IAAIgD,MAAM5P,SAAQ,SAAS8P,MACvBD,QAAQC,KAAKC,KAAOD,KAAKlL,SAEtBiL,eAEJjD,OAEP3M,OAAS,CACTS,KAAMsN,aAAatN,KACnBgF,YAAasI,aAAatI,aAAesI,aAAatN,KACtDD,SAAWrB,SAASa,QAAUb,SAASa,OAAOQ,UAAauN,aAAavN,UAAY,gBACpF2K,WAAY4C,aAAa5C,WACzBxF,OAAQ,SACRH,KAAMuI,aAAavI,MAGvBrJ,KAAKhE,cAAgB6H,OACrB7D,KAAK/D,kBAAoBuD,SAErBsM,WAAa9L,KAAKlE,cAAc+M,WAAU,SAASwB,UAC5CA,EAAEhB,OAASuI,aAAavI,SAEf,IAAhByC,aACA9L,KAAKlE,cAAcgQ,YAAYtM,KAAOA,KACtCQ,KAAKlE,cAAcgQ,YAAYmE,UAAYzQ,KAAKgB,QAGpDR,KAAK0S,oBAAoB7O,OAAQrE,WAEjCjE,EAAE,mBAAmBwL,SAAS,UAC9BxL,EAAE,mBAAmBqC,KACjB,gFAEKoF,SAASlD,SAAWnE,QAAQiY,wBAFjC,qGAIuDhC,aAAavI,KAJpE,sCAKuC1N,QAAQ4T,MAL/C,mBAOF7I,YAAY,WAGtBhH,MAAO,WACHnE,EAAE,mBAAmBwL,SAAS,UAC9BxL,EAAE,mBAAmBqC,KACjB,4EACkDjC,QAAQkY,4BAD1D,oGAGuDjC,aAAavI,KAHpE,sCAIuC1N,QAAQ4T,MAJ/C,mBAMF7I,YAAY,cAW1B0L,qBAAsB,SAASH,IAAKI,eAChCA,OAASA,QAAU,GAEZ,IAAInT,SAAQ,SAASC,QAASiC,QACjC7F,EAAEgI,KAAK,CACHC,IAAKrG,EAAEC,IAAIC,QAAU,sDACrBuF,OAAQ,OACRoQ,YAAa,mBACbxT,KAAMkL,KAAKuI,UAAU,CACjBhB,IAAKA,IACLI,OAAQA,OACRtP,QAAS5F,EAAEC,IAAI2F,UAEnBsQ,QAAS,IACTzT,QAAS,SAASoD,aACVA,SAASpD,QAAS,KAEdJ,KAAOwD,SAASxD,KAChBqD,QAAUG,SAASH,WACH,iBAATrD,SAEtCA,KAAOkL,KAAKC,MAAMnL,MACjB,MAAOkB,GACRlB,KAAO,MAG2C,iBAAZqD,YAEtCA,QAAU6H,KAAKC,MAAM9H,SACpB,MAAOnC,GACRmC,QAAU,GAGiB1D,QAAQ,CACJK,KAAMA,MAAQ,GACdqD,QAASA,SAAW,GACpBoN,UAAWjN,SAASiN,WAAa,EACjCvQ,MAAO,YAGXP,QAAQ,CACJK,KAAM,GACNqD,QAAS,GACToN,UAAW,EACXvQ,MAAOsD,SAASlD,SAAW,4BAIvCJ,MAAO,SAASoI,IAAKmH,OAAQvP,WACrBoU,aAAe,+BAGfA,aADepJ,KAAKC,MAAM7C,IAAI8C,cACN9K,SAAWgU,aACrC,MAAOpT,GACLoT,aAAepU,OAASoU,aAE5B1S,OAAO,IAAIM,MAAMoS,sBAWjCpB,oBAAqB,SAAS7O,OAAQrE,UAC9BQ,KAAOrD,KACXpB,EAAE,mBAAmBwL,SAAS,cAE1BgN,YAAc,GACd/D,SAAWxQ,KAAOA,KAAKgB,OAAS,EAEpCuT,aAAe,kDACfA,aAAe,qBAAuBlQ,OAAOyF,aAAezF,OAAOS,MAAQ3I,QAAQkI,QAAU,QAC7FkQ,aAAe,kFAEXC,cAAgBnQ,OAAO2F,QAAU,aAAajF,cAE9CwP,aADiB,WAAjBC,aACe,wEACXrY,QAAQ2U,OAAS,UAEN,oEACX3U,QAAQ4U,GAAK,UAGrBwD,aAAe,0EAA4E/D,SACvF,IAAMrU,QAAQsY,KAAO,UACzBF,aAAe,SACfA,aAAe,SAEfA,aAAe,0FAEfA,aAAe,2DACfA,aAAe,yHACwCpY,QAAQuY,MAAQ,YACvEH,aAAe,sHAC0BpY,QAAQwY,MAAQ,YACzDJ,aAAe,aAEXK,aAAepU,KAAKxD,WAAa,0BAA4B,MACjEuX,aAAe,oDACfA,aAAe,yGAC2BpY,QAAQ0Y,UAAY,YAC9DN,aAAe,uEAAyEK,aACpF,wCAA0CzY,QAAQ2Y,WACjDtU,KAAKxD,WAAa,qEAAuE,IAC1F,YACJuX,aAAe,0EAA4EK,aACvF,gCAAkCzY,QAAQ4Y,YACzCvU,KAAKxD,WAAa,qEAAuE,IAC1F,YACJuX,aAAe,SACfA,aAAe,SAEXvU,MAAQA,KAAKgB,OAAS,EAAG,KACrBqC,QAAU2P,OAAOgC,KAAKhV,KAAK,IAG/BuU,aAAe,2DACfA,aAAe,4CACfA,aAAe,wDACfA,aAAe,6EACfA,aAAe,gDACflR,QAAQe,SAAQ,SAASyI,YACjBoI,gBAAkBpI,OAAOtO,QAAQ,KAAM,KAAKA,QAAQ,SAAS,SAAS2W,UAC/DA,EAAEnX,iBAEbwW,aAAe,OAASU,gBAAkB,WAE9CV,aAAe,gBACfA,aAAe,UAEGvU,KAAKmV,MAAM,EAhBV,KAiBP/Q,SAAQ,SAAS4M,KACzBuD,aAAe,OACflR,QAAQe,SAAQ,SAASyI,YACjB7D,MAAQgI,IAAInE,QACZ7D,MAAAA,QACAA,MAAQ,QAERoM,aAAeC,OAAOrM,OACtBoM,aAAapU,OAAS,MACtBoU,aAAeA,aAAaE,UAAU,EAAG,KAAO,OAEpDf,aAAe,cAAgBc,OAAOrM,OAAOzK,QAAQ,KAAM,UAAY,KACnE6W,aAAe,WAEvBb,aAAe,WAGnBA,aAAe,mBACfA,aAAe,SACfA,aAAe,SAEXvU,KAAKgB,OAtCU,MAuCfuT,aAAe,wFAEfA,aAAe,2CACXpY,QAAQoZ,iBAAiBhX,QAAQ,UA1CtB,KA0C+CA,QAAQ,UAAWyB,KAAKgB,QAClF,UACJuT,aAAe,8BAAgCpY,QAAQqZ,eAAiB,UACxEjB,aAAe,UAEnBA,aAAe,SAEfA,aAAe,kEACfA,aAAe,oDACfA,aAAe,iFAEfA,aAAe,sCACfA,aAAe,qDAAuDpY,QAAQsZ,UAAY,WAC1FlB,aAAe,qEACfA,aAAe,uBAAyBpY,QAAQuZ,SAAW,YAC3DnB,aAAe,wBAA0BpY,QAAQwZ,UAAY,YAC7DpB,aAAe,uBAAyBpY,QAAQyZ,SAAW,YAC3DrB,aAAe,4BAA8BpY,QAAQ0Z,cAAgB,YACrEtB,aAAe,YACfA,aAAe,SAEfA,aAAe,sCACfA,aAAe,gDAAkDpY,QAAQ2Z,YAAc,WACvFvB,aAAe,gEACflR,QAAQe,SAAQ,SAASyI,OAAQzD,SACzB6L,gBAAkBpI,OAAOtO,QAAQ,KAAM,KAAKA,QAAQ,SAAS,SAAS2W,UAC/DA,EAAEnX,iBAGbwW,aAAe,kBAAoB1H,OAAS,KADrB,IAARzD,IAAY,YAAc,IACoB,IAAM6L,gBAAkB,eAEzFV,aAAe,YACfA,aAAe,aAEXwB,YAAcvV,KAAKoM,qBAAqB5M,KAAMqD,SAClDkR,aAAe,sCACfA,aAAe,gDAAkDpY,QAAQ6Z,YAAc,WACvFzB,aAAe,gEACXwB,YAAY/U,OAAS,EACrB+U,YAAY3R,SAAQ,SAAS6R,IAAK7M,SAC1B6L,gBAAkBgB,IAAI1X,QAAQ,KAAM,KAAKA,QAAQ,SAAS,SAAS2W,UAC5DA,EAAEnX,iBAETmY,SAAW9M,MAAQ2M,YAAY/U,OAAS,EAAI,YAAc,GAC9DuT,aAAe,kBAAoB0B,IAAM,IAAMC,SAAW,IAAMjB,gBAAkB,eAGtF5R,QAAQe,SAAQ,SAASyI,OAAQzD,SACzB6L,gBAAkBpI,OAAOtO,QAAQ,KAAM,KAAKA,QAAQ,SAAS,SAAS2W,UAC/DA,EAAEnX,iBAETmY,SAAW9M,MAAQ/F,QAAQrC,OAAS,EAAI,YAAc,GAC1DuT,aAAe,kBAAoB1H,OAAS,IAAMqJ,SAAW,IAAMjB,gBAAkB,eAG7FV,aAAe,YACfA,aAAe,SAEfA,aAAe,SACfA,aAAe,SAEfA,aAAe,mFACfA,aAAe,sCACfA,aAAe,SACfA,aAAe,cAGfA,aAAe,qDACfA,aAAe,iDACfA,aAAe,WAAapY,QAAQga,gBAAkB,gBACtD5B,aAAe,6BAA+BpY,QAAQia,WAAa,WACnE7B,aAAe,SAGnBxY,EAAE,mBAAmBqC,KAAKmW,aAAarN,YAAY,UAEnD1G,KAAK3D,YAAc,QAEnBd,EAAE,2CAA2C2H,GAAG,SAAS,WACrDlD,KAAK6V,aAAahS,OAAOwF,KAAM,UAEnC9N,EAAE,2CAA2C2H,GAAG,SAAS,WACjD3H,EAAEoB,MAAMmZ,SAAS,0BACjB9V,KAAKhD,wBAAwB,OAGjCgD,KAAK6V,aAAahS,OAAOwF,KAAM,UAEnC9N,EAAE,4CAA4C2H,GAAG,SAAS,WAClD3H,EAAEoB,MAAMmZ,SAAS,0BACjB9V,KAAKhD,wBAAwB,QAGjCgD,KAAK6V,aAAahS,OAAOwF,KAAM,WAGnC9N,EAAE,6BAA6B6L,IAAI,SAASlE,GAAG,SAAS,WACpDlD,KAAKoJ,oBAAoBvF,YAOjCR,YAAa,eACL7D,KAAO7C,KAAKV,qBAEXuD,MAAwB,IAAhBA,KAAKgB,YAIdyU,UAAY1Z,EAAE,sBAAsBqL,OAAS,MAC7CmP,OAAS5V,SAASC,eAAe,mBAChC2V,QAIDpZ,KAAKL,qBACAA,cAAcuT,eACdvT,cAAgB,UAGrB0Z,SAAWza,EAAE,iBAAiBqL,MAC9BqP,SAAW1a,EAAE,iBAAiBqL,UAE7BoP,WAAaC,SAAU,KACpBpT,QAAU2P,OAAOgC,KAAKhV,KAAK,IAC/BwW,SAAWA,UAAYnT,QAAQ,GAC/BoT,SAAWA,UAAYpT,QAAQA,QAAQrC,OAAS,OAGhD0V,kBAAoBD,SAASlY,QAAQ,KAAM,KAAKA,QAAQ,SAAS,SAAS2W,UACnEA,EAAEnX,iBAGT4Y,UAAY3W,KAAKmV,MAAM,EAAG,IAC1BzD,OAASiF,UAAUrR,KAAI,SAASuF,OAC5B+L,MAAQ/L,EAAE2L,aACVI,MAAAA,aACOza,QAAQ0a,YAEfC,SAAWzB,OAAOuB,cACfE,SAAS9V,OAAS,GAAK8V,SAASxB,UAAU,EAAG,IAAM,MAAQwB,YAElEC,OAASJ,UAAUrR,KAAI,SAASuF,UACzBuC,WAAWvC,EAAE4L,YAAc,KAGlCO,OAAS7Z,KAAK8Z,oBAAoBF,OAAO/V,QACzCkW,YAAc/Z,KAAKga,kBAAkB1B,UAAW/D,OAAQqF,OAAQL,kBAAmBM,iBAG9Ela,cAAgB,IAAIK,KAAKjB,MAAMqa,OAAOa,WAAW,MAAOF,aAC/D,MAAOhX,OACLX,OAAOY,QAAQD,MAAM,wBAAyBA,OAC9CnE,EAAE,+CAA+CqC,KAC7C,8EACAjC,QAAQkb,oBAAsB,KAAOnX,MAAMI,QAAU,cAUjE2W,oBAAqB,SAASjH,eACtBsH,WAAa,CACb,UAAW,UAAW,UAAW,UAAW,UAC5C,UAAW,UAAW,UAAW,UAAW,UAC5C,UAAW,UAAW,UAAW,UAAW,WAG5CN,OAAS,GACJ9J,EAAI,EAAGA,EAAI8C,MAAO9C,IACvB8J,OAAOhP,KAAKsP,WAAWpK,EAAIoK,WAAWtW,gBAEnCgW,QAYXG,kBAAmB,SAAS1B,UAAW/D,OAAQqF,OAAQN,SAAUO,YAKzDO,WAAa,CACbC,YAAY,EACZC,qBAAqB,EACrBC,QAAS,CACLxZ,MAAO,CACHyZ,SAAS,EACTlP,KAVMtL,KAAKX,eAAiBW,KAAKX,cAAcsN,aACtD3M,KAAKX,eAAiBW,KAAKX,cAAcsI,MAC1C3I,QAAQkI,OASAuT,KAAM,CAACC,KAAM,GAAIC,OAAQ,QACzBC,QAAS,CAACC,IAAK,GAAIC,OAAQ,KAE/BC,OAAQ,CACJP,QAAuB,QAAdlC,WAAqC,aAAdA,UAChC0C,SAAU,iBAKJ,QAAd1C,WAAqC,aAAdA,UAChB,CACHnT,KAAMmT,UACNzV,KAAM,CACF0R,OAAQA,OACR0G,SAAU,CAAC,CACPpY,KAAM+W,OACN1V,gBAAiB2V,OACjBqB,YAAa,OACbC,YAAa,KAGrBC,QAAShB,YAEQ,SAAd9B,UACA,CACHnT,KAAM,OACNtC,KAAM,CACF0R,OAAQA,OACR0G,SAAU,CAAC,CACPxB,MAAOH,SACPzW,KAAM+W,OACNsB,YAAarB,OAAO,GACpB3V,gBAAiB2V,OAAO,GAAK,KAC7BsB,YAAa,EACbE,MAAM,EACNC,QAAS,MAGjBF,QAASvF,OAAOC,OAAO,GAAIsE,WAAY,CACnCmB,OAAQ,CACJC,EAAG,CAACC,aAAa,GACjBC,EAAG,CAACC,MAAO,CAACC,YAAa,GAAIC,YAAa,SAK/C,CACH1W,KAAM,MACNtC,KAAM,CACF0R,OAAQA,OACR0G,SAAU,CAAC,CACPxB,MAAOH,SACPzW,KAAM+W,OACN1V,gBAAiB2V,OACjBqB,YAAarB,OAAO1R,KAAI,SAASX,UACtBA,KAEX2T,YAAa,KAGrBC,QAASvF,OAAOC,OAAO,GAAIsE,WAAY,CACnCmB,OAAQ,CACJC,EAAG,CAACC,aAAa,GACjBC,EAAG,CAACC,MAAO,CAACC,YAAa,GAAIC,YAAa,UAY9D3C,aAAc,SAAS4C,WAAYxb,YAC3B+C,KAAOrD,KAENqD,KAAK/D,mBAAsByS,MAAMC,QAAQ3O,KAAK/D,oBACb,IAAlC+D,KAAK/D,kBAAkBuE,QAS3BhD,KAAKC,KAAK,CACNC,MAAO/B,QAAQ+c,YAAY3a,QAAQ,WAAYd,OAAOM,eACtDyM,mBAAmB,EACnB7D,QAAS,WACL3I,KAAK0M,iBAIblK,KAAKf,uBAAuBhC,QAAQ2B,MAAK,SAAS+Z,iBACzCA,YAAY/Y,UAAY+Y,YAAY9Y,gBACrCrC,KAAKiK,aACDzH,KAAKxD,YAAyB,QAAXS,OACnB+C,KAAKhD,wBAAwBC,QAE7BO,KAAKC,KAAK,CACNiK,KAAM,QACNhK,MAAO/B,QAAQid,mBACf3Q,KAAM0Q,YAAY7Y,SAAWnE,QAAQkd,yBAM7CC,SAAWL,WACMzY,KAAKhE,eAA+C,WAA9BgE,KAAKhE,cAAcwN,QACxCxJ,KAAKhE,cAAcsI,OACrCwU,SAAW9Y,KAAKhE,cAAcsI,UAG9BnC,KAAO,YAAcW,mBAAmBgW,UAAY,WAAa7b,OACjE,YAAcE,EAAEC,IAAI2F,QACxBZ,MAAQ,SAAWnC,KAAK3D,gBAEpBwG,QAAU7C,KAAK/D,kBAAkBuE,OAAS,EAAIgS,OAAOgC,KAAKxU,KAAK/D,kBAAkB,IAAM,GACvF8c,kBAAqB/Y,KAAKhE,eAAiBgE,KAAKhE,cAAcsN,aAC7DtJ,KAAKhE,eAAiBgE,KAAKhE,cAAcsI,MAAS,SACnD0U,kBAAoB,CACpB1F,QAAStT,KAAK/D,kBACd4G,QAASA,QACTiI,YAAaiO,kBACbE,gBAAkBjZ,KAAKhE,eAAiBgE,KAAKhE,cAAcqI,UAAa,IAE5ElC,MAAQ,gBAAkBW,mBAAmB4H,KAAKuI,UAAU+F,wBAExDE,kBAAoBha,QAAQC,QAAQ,MACzB,QAAXlC,QAAyC,UAArB+C,KAAK3D,cACzB6c,kBAAoBlZ,KAAKD,oBAAoBoB,OAAM,kBACxC,SAIf+X,kBAAkBta,MAAK,SAASua,mBACxBA,YAAcA,WAAW3Y,OAAS,MAClC2B,MAAQ,gBAAkBW,mBAAmBqW,YAC7Cpa,OAAOY,QAAQc,IAAI,sDAGhBkC,MAAMxF,EAAEC,IAAIC,QAAU,kDAAmD,CAC5EuF,OAAQ,OACRC,QAAS,gBACW,qCAEpBV,KAAMA,KACNiX,YAAa,mBAElBxa,MAAK,SAASoE,cACTgQ,YAAchQ,SAASH,QAAQwW,IAAI,gBACnCC,mBAAqBtW,SAASH,QAAQwW,IAAI,0BAE1CrG,aAAeA,YAAYuG,SAAS,sBAAwBD,0BACrDtW,SAASC,OAAOrE,MAAK,SAAS4a,iBAC3B,IAAI9X,MAAM8X,UAAU1Z,SAAW,wBAIxCkD,SAASyW,SACJ,IAAI/X,MAAM,8BAAgCsB,SAASiM,eAGtDjM,SAAS0W,UACjB9a,MAAK,SAAS8a,UACThX,WAAc1C,KAAKhE,eAAiBgE,KAAKhE,cAAcsN,aACtDtJ,KAAKhE,eAAiBgE,KAAKhE,cAAcsI,MAAS,SACnDqV,cAAgBjX,WAAW3E,QAAQ,mBAAoB,IACtDA,QAAQ,OAAQ,KAAKwG,cACtBqV,YAAa,IAAItM,MAAOuM,cAAcC,MAAM,KAAK,GAEjDtW,IAAMzE,OAAOgb,IAAIC,gBAAgBN,MACjCO,KAAO9Z,SAASmB,cAAc,KAClC2Y,KAAKC,KAAO1W,IACZyW,KAAKE,SAAWR,cAAgB,IAAMC,WAAa,IAAM3c,OACzDkD,SAASgC,KAAKP,YAAYqY,MAC1BA,KAAK/S,QACLnI,OAAOgb,IAAIK,gBAAgB5W,KAC3BrD,SAASgC,KAAKK,YAAYyX,MAE1Bzc,KAAKiK,QAELzH,KAAKyC,YAAYxF,OAAQyF,YACzB1C,KAAK6B,UAAU5E,OAAOM,cAAgB,IAAM5B,QAAQ0e,sBAAuB,cAE5ElZ,OAAM,SAASzB,OACdlC,KAAKiK,QACLjK,KAAKC,KAAK,CACNiK,KAAM,QACNhK,MAAO/B,QAAQ2e,aACfrS,KAAMvI,MAAMI,SAAWnE,QAAQ4e,6BAlHvC/c,KAAKC,KAAK,CACNiK,KAAM,UACNhK,MAAO/B,QAAQ6e,OACfvS,KAAMtM,QAAQ8e,0BAuH9B1b,OAAOnD,iBAAmBA,iBAEnB,CAKHa,KAAM,SAASC,QAt9ERjB,IAAIif,YAAY,CAEnB,CAAC/G,IAAK,UAAWgH,UAAW,2BAC5B,CAAChH,IAAK,SAAUgH,UAAW,2BAC3B,CAAChH,IAAK,KAAMgH,UAAW,2BACvB,CAAChH,IAAK,SAAUgH,UAAW,2BAC3B,CAAChH,IAAK,iBAAkBgH,UAAW,2BACnC,CAAChH,IAAK,kBAAmBgH,UAAW,2BACpC,CAAChH,IAAK,UAAWgH,UAAW,2BAC5B,CAAChH,IAAK,OAAQgH,UAAW,2BACzB,CAAChH,IAAK,QAASgH,UAAW,2BAC1B,CAAChH,IAAK,QAASgH,UAAW,2BAC1B,CAAChH,IAAK,QAASgH,UAAW,2BAC1B,CAAChH,IAAK,SAAUgH,UAAW,2BAC3B,CAAChH,IAAK,QAASgH,UAAW,2BAE1B,CAAChH,IAAK,aAAcgH,UAAW,2BAC/B,CAAChH,IAAK,aAAcgH,UAAW,2BAC/B,CAAChH,IAAK,cAAegH,UAAW,2BAChC,CAAChH,IAAK,eAAgBgH,UAAW,2BACjC,CAAChH,IAAK,uBAAwBgH,UAAW,2BACzC,CAAChH,IAAK,sBAAuBgH,UAAW,2BACxC,CAAChH,IAAK,gBAAiBgH,UAAW,2BAClC,CAAChH,IAAK,wBAAyBgH,UAAW,2BAC1C,CAAChH,IAAK,0BAA2BgH,UAAW,2BAC5C,CAAChH,IAAK,UAAWgH,UAAW,2BAC5B,CAAChH,IAAK,oBAAqBgH,UAAW,2BACtC,CAAChH,IAAK,oBAAqBgH,UAAW,2BACtC,CAAChH,IAAK,eAAgBgH,UAAW,2BAEjC,CAAChH,IAAK,wBAAyBgH,UAAW,2BAC1C,CAAChH,IAAK,kBAAmBgH,UAAW,2BACpC,CAAChH,IAAK,cAAegH,UAAW,2BAChC,CAAChH,IAAK,kBAAmBgH,UAAW,2BACpC,CAAChH,IAAK,qBAAsBgH,UAAW,2BACvC,CAAChH,IAAK,mBAAoBgH,UAAW,2BACrC,CAAChH,IAAK,yBAA0BgH,UAAW,2BAC3C,CAAChH,IAAK,yBAA0BgH,UAAW,2BAE3C,CAAChH,IAAK,aAAcgH,UAAW,2BAC/B,CAAChH,IAAK,sBAAuBgH,UAAW,2BACxC,CAAChH,IAAK,eAAgBgH,UAAW,2BACjC,CAAChH,IAAK,kBAAmBgH,UAAW,2BACpC,CAAChH,IAAK,qBAAsBgH,UAAW,2BACvC,CAAChH,IAAK,YAAagH,UAAW,2BAC9B,CAAChH,IAAK,uBAAwBgH,UAAW,2BACzC,CAAChH,IAAK,wBAAyBgH,UAAW,2BAC1C,CAAChH,IAAK,mBAAoBgH,UAAW,2BACrC,CAAChH,IAAK,mBAAoBgH,UAAW,2BACrC,CAAChH,IAAK,mBAAoBgH,UAAW,2BACrC,CAAChH,IAAK,gBAAiBgH,UAAW,2BAClC,CAAChH,IAAK,kBAAmBgH,UAAW,2BACpC,CAAChH,IAAK,0BAA2BgH,UAAW,2BAC5C,CAAChH,IAAK,0BAA2BgH,UAAW,2BAC5C,CAAChH,IAAK,aAAcgH,UAAW,2BAC/B,CAAChH,IAAK,gBAAiBgH,UAAW,2BAClC,CAAChH,IAAK,6BAA8BgH,UAAW,2BAC/C,CAAChH,IAAK,OAAQgH,UAAW,2BACzB,CAAChH,IAAK,QAASgH,UAAW,2BAC1B,CAAChH,IAAK,SAAUgH,UAAW,2BAC3B,CAAChH,IAAK,eAAgBgH,UAAW,2BAEjC,CAAChH,IAAK,kBAAmBgH,UAAW,2BACpC,CAAChH,IAAK,qBAAsBgH,UAAW,2BACvC,CAAChH,IAAK,gBAAiBgH,UAAW,2BAClC,CAAChH,IAAK,wBAAyBgH,UAAW,2BAC1C,CAAChH,IAAK,wBAAyBgH,UAAW,2BAC1C,CAAChH,IAAK,kBAAmBgH,UAAW,2BACpC,CAAChH,IAAK,uBAAwBgH,UAAW,2BACzC,CAAChH,IAAK,gBAAiBgH,UAAW,2BAClC,CAAChH,IAAK,yBAA0BgH,UAAW,2BAC3C,CAAChH,IAAK,eAAgBgH,UAAW,2BACjC,CAAChH,IAAK,gBAAiBgH,UAAW,2BAClC,CAAChH,IAAK,yBAA0BgH,UAAW,2BAE3C,CAAChH,IAAK,kBAAmBgH,UAAW,2BACpC,CAAChH,IAAK,eAAgBgH,UAAW,2BACjC,CAAChH,IAAK,2BAA4BgH,UAAW,2BAC7C,CAAChH,IAAK,yBAA0BgH,UAAW,2BAC3C,CAAChH,IAAK,kBAAmBgH,UAAW,2BACpC,CAAChH,IAAK,2BAA4BgH,UAAW,2BAC7C,CAAChH,IAAK,gCAAiCgH,UAAW,2BAClD,CAAChH,IAAK,4BAA6BgH,UAAW,2BAC9C,CAAChH,IAAK,kCAAmCgH,UAAW,2BACpD,CAAChH,IAAK,0BAA2BgH,UAAW,2BAC5C,CAAChH,IAAK,kCAAmCgH,UAAW,2BAEpD,CAAChH,IAAK,iBAAkBgH,UAAW,2BACnC,CAAChH,IAAK,mBAAoBgH,UAAW,2BACrC,CAAChH,IAAK,kBAAmBgH,UAAW,2BACpC,CAAChH,IAAK,qBAAsBgH,UAAW,2BACvC,CAAChH,IAAK,oBAAqBgH,UAAW,2BAEtC,CAAChH,IAAK,aAAcgH,UAAW,2BAC/B,CAAChH,IAAK,YAAagH,UAAW,2BAC9B,CAAChH,IAAK,aAAcgH,UAAW,2BAC/B,CAAChH,IAAK,YAAagH,UAAW,2BAC9B,CAAChH,IAAK,iBAAkBgH,UAAW,2BACnC,CAAChH,IAAK,gBAAiBgH,UAAW,2BAClC,CAAChH,IAAK,gBAAiBgH,UAAW,2BAClC,CAAChH,IAAK,wBAAyBgH,UAAW,2BAC1C,CAAChH,IAAK,UAAWgH,UAAW,6BAC7B/b,MAAK,SAAS0U,eAEF,CACP,UAAW,SAAU,KAAM,SAAU,gBAAiB,iBACtD,UAAW,OAAQ,QAAS,QAAS,QAAS,SAAU,QACxD,YAAa,YAAa,aAAc,cAAe,qBACvD,oBAAqB,eAAgB,sBAAuB,wBAC5D,SAAU,iBAAkB,kBAAmB,aAC/C,sBAAuB,iBAAkB,aAAc,WACvD,kBAAmB,YAAa,sBAAuB,uBACvD,aAAc,oBAAqB,cAAe,iBAClD,oBAAqB,WAAY,qBAAsB,sBACvD,kBAAmB,kBAAmB,kBAAmB,eACzD,iBAAkB,wBAAyB,wBAAyB,YACpE,eAAgB,0BAA2B,OAAQ,QAAS,SAAU,cACtE,gBAAiB,mBAAoB,eAAgB,sBACrD,sBAAuB,iBAAkB,qBAAsB,eAC/D,uBAAwB,cAAe,eAAgB,sBACvD,iBAAkB,cAAe,wBAAyB,sBAC1D,gBAAiB,wBAAyB,4BAC1C,yBAA0B,8BAC1B,yBAA0B,gCAC1B,gBAAiB,iBAAkB,iBAAkB,mBAAoB,iBACzE,YAAa,WAAY,YAAa,WAAY,gBAClD,cAAe,cAAe,sBAAuB,WAEpD1P,SAAQ,SAAS+P,IAAKT,OACvBvX,QAAQgY,KAAOL,QAAQJ,QAAUS,OAE9BhY,WACRwF,OAAM,kBAELxF,QAAU,CACN0P,QAAS,UACTiF,OAAQ,SACRC,GAAI,KACJ1M,OAAQ,SACRgO,cAAe,iBACftI,eAAgB,kBAChB8M,QAAS,UACTpC,KAAM,OACNC,MAAO,QACPC,MAAO,QACP5E,MAAO,QACP/Q,OAAQ,SACRkB,MAAO,QACP2U,UAAW,aACXC,UAAW,aACXC,WAAY,cACZmE,YAAa,2BACbE,mBAAoB,uBACpBC,kBAAmB,sBACnByB,aAAc,gBACdC,oBAAqB,0BACrBF,sBAAuB,+BACvBG,OAAQ,UACRC,eAAgB,oBAChB9E,gBAAiB,oBACjBC,WAAY,oCACZjY,oBAAqB,wBACrBE,eAAgB,kBAChBS,WAAY,cACZN,SAAU,aACVC,gBAAiB,kBACjBC,UAAW,cACXC,oBAAqB,+BACrBL,qBAAsB,uCACtBwH,WAAY,aACZC,kBAAmB,sBACnBE,YAAa,eACbC,eAAgB,kBAChBC,kBAAmB,qBACnBC,SAAU,YACVV,mBAAoB,2BACpBC,oBAAqB,mCACrBwC,gBAAiB,mBACjBmB,gBAAiB,mBACjBK,gBAAiB,mBACjBjB,aAAc,gBACdgB,eAAgB,kBAChBH,sBAAuB,mBACvBC,sBAAuB,0CACvBC,UAAW,cACXzD,aAAc,gBACdiD,wBAAyB,+BACzBnE,KAAM,OACNP,MAAO,QACPoE,OAAQ,SACRC,YAAa,eACbyB,cAAe,kBACfD,iBAAkB,qBAClBD,aAAc,gBACdF,oBAAqB,iBACrBC,oBAAqB,0CACrBI,eAAgB,kBAChBC,mBAAoB,iBACpBI,aAAc,gBACdK,qBAAsB,8BACtBkF,YAAa,WACbC,aAAc,UACdC,oBAAqB,yBACrBV,eAAgB,kBAChBE,YAAa,eACbD,sBAAuB,sCACvBE,oBAAqB,yBACrBC,cAAe,yBACfqD,sBAAuB,2BACvBC,0BAA2B,gCAC3BgB,uBAAwB,4BACxBC,4BAA6B,kCAC7B+G,uBAAwB,0BACxBC,8BAA+B,kCAC/BzJ,cAAe,oBACfE,eAAgB,mBAChBE,eAAgB,kBAChBuD,iBAAkB,wCAClBC,eAAgB,yBAChBC,UAAW,aACXC,SAAU,YACVC,UAAW,aACXC,SAAU,YACVC,cAAe,iBACfC,YAAa,kBACbE,YAAa,kBACbqB,oBAAqB,wBACrB5F,QAAS,iBAqvECrS,MAAK,eAEXkc,UAAYC,aAAY,WACpBhc,OAAOkO,kBACP+N,cAAcF,WACdlf,iBAAiBa,KAAKC,WAE3B,KAGHuD,YAAW,WACP+a,cAAcF,WACT/b,OAAOkO,kBACR1R,EAAE,mBAAmBwL,SAAS,UAC9BxL,EAAE,uBAAuBmL,YAAY,UAAU9I,KAC3C,4FAC4BjC,QAAQif,uBADpC,8BAE2Bjf,QAAQkf,8BAAgC,WAG5E"}