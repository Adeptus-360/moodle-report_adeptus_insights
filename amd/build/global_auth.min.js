define("report_adeptus_insights/global_auth",["jquery","core/ajax","core/notification"],(function($,Ajax,Notification){return{init:function(){return new Promise(((resolve,reject)=>{this.isAuthenticated()?resolve():this.checkAuthStatus().then((()=>{resolve()})).catch((error=>{console.error("[GlobalAuth] Authentication failed:",error),reject(error)}))}))},checkAuthStatus:function(){return new Promise(((resolve,reject)=>{$.ajax({url:M.cfg.wwwroot+"/report/adeptus_insights/ajax/get_auth_status.php",method:"GET",dataType:"json",success:response=>{response&&response.success?(this.handleAuthSuccess(response.data),resolve()):(this.handleAuthFailure(response.message||"Authentication failed"),reject(new Error(response.message||"Authentication failed")))},error:(xhr,status,error)=>{console.error("[GlobalAuth] Error getting auth status:",error),this.handleAuthFailure("Failed to check authentication status"),reject(new Error("Failed to check authentication status"))}})}))},handleAuthSuccess:function(authData){window.adeptusAuthData=authData,this.hideModal(),$(document).trigger("adeptus:enableInteractiveFeatures"),this.updateUIForAuthenticatedUser()},handleAuthFailure:function(message){this.showModal(),$(document).trigger("adeptus:enableReadOnly")},showModal:function(){if($("#global-auth-modal").length)$("#global-auth-modal").modal("show");else{var modalHtml=this.createModalHTML();$("body").append(modalHtml),$("#global-auth-modal").modal("show"),this.initModalFunctionality()}},hideModal:function(){$("#global-auth-modal").modal("hide")},createModalHTML:function(){return'\n                <div class="modal fade" id="global-auth-modal" tabindex="-1" role="dialog" aria-labelledby="global-auth-modal-label" aria-hidden="true">\n                    <div class="modal-dialog modal-dialog-centered" role="document">\n                        <div class="modal-content">\n                            <div class="modal-header">\n                                <h5 class="modal-title" id="global-auth-modal-label">\n                                    <i class="fa fa-lock"></i> Adeptus Insights Authentication\n                                </h5>\n                                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>\n                            </div>\n                            <div class="modal-body">\n                                <div class="auth-form">\n                                    <div class="form-group mb-3">\n                                        <label for="site-url">Site URL</label>\n                                        <input type="text" class="form-control" id="site-url" value="'.concat(window.location.origin,'" disabled>\n                                    </div>\n                                    <div class="form-group mb-3">\n                                        <label for="admin-email">Admin Email</label>\n                                        <input type="email" class="form-control" id="admin-email" value="admin@example.com" disabled>\n                                    </div>\n                                    <div class="form-group mb-3">\n                                        <label for="auth-password">Password</label>\n                                        <div class="input-group">\n                                            <input type="password" class="form-control" id="auth-password" placeholder="Enter your password">\n                                            <button class="btn btn-outline-secondary" type="button" id="toggle-password">\n                                                <i class="fa fa-eye"></i>\n                                            </button>\n                                        </div>\n                                    </div>\n                                </div>\n                            </div>\n                            <div class="modal-footer">\n                                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>\n                                <button type="button" class="btn btn-primary" id="auth-submit">\n                                    <i class="fa fa-sign-in"></i> Authenticate\n                                </button>\n                            </div>\n                        </div>\n                    </div>\n                </div>\n            ')},initModalFunctionality:function(){$("#auth-submit").on("click",(()=>{this.handleLogin()})),$("#toggle-password").on("click",(()=>{this.togglePasswordVisibility()})),$("#auth-password").on("keypress",(e=>{13===e.which&&this.handleLogin()})),this.autoFillSiteInfo(),this.includeCustomCSS()},handleLogin:function(){var password=$("#auth-password").val();password?($("#auth-submit").prop("disabled",!0).html('<i class="fa fa-spinner fa-spin"></i> Authenticating...'),this.authenticate(password).then((()=>{this.hideModal(),Notification.addNotification({message:"Authentication successful!",type:"success"})})).catch((error=>{Notification.addNotification({message:error.message||"Authentication failed",type:"error"}),$("#auth-submit").prop("disabled",!1).html('<i class="fa fa-sign-in"></i> Authenticate')}))):Notification.addNotification({message:"Please enter your password",type:"error"})},authenticate:function(password){return new Promise(((resolve,reject)=>{$.ajax({url:M.cfg.wwwroot+"/report/adeptus_insights/ajax/authenticate.php",method:"POST",data:{password:password,sesskey:M.cfg.sesskey},dataType:"json",success:response=>{response&&response.success?(this.handleAuthSuccess(response.data),resolve()):reject(new Error(response.message||"Authentication failed"))},error:(xhr,status,error)=>{reject(new Error("Failed to authenticate"))}})}))},togglePasswordVisibility:function(){var $passwordField=$("#auth-password"),$icon=$("#toggle-password").find("i");"password"===$passwordField.attr("type")?($passwordField.attr("type","text"),$icon.removeClass("fa-eye").addClass("fa-eye-slash")):($passwordField.attr("type","password"),$icon.removeClass("fa-eye-slash").addClass("fa-eye"))},autoFillSiteInfo:function(){"undefined"!=typeof M&&M.user&&M.user.email&&$("#admin-email").val(M.user.email)},includeCustomCSS:function(){if(!$("#global-auth-modal-css").length){$("head").append('\n                    <style id="global-auth-modal-css">\n                        #global-auth-modal .modal-content {\n                            border-radius: 15px;\n                            border: none;\n                            box-shadow: 0 10px 30px rgba(0,0,0,0.2);\n                        }\n                        #global-auth-modal .modal-header {\n                            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);\n                            color: white;\n                            border-radius: 15px 15px 0 0;\n                        }\n                        #global-auth-modal .modal-title i {\n                            margin-right: 8px;\n                        }\n                        #global-auth-modal .form-control:disabled {\n                            background-color: #f8f9fa;\n                            color: #6c757d;\n                        }\n                        #global-auth-modal .btn-primary {\n                            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);\n                            border: none;\n                            border-radius: 25px;\n                            padding: 10px 25px;\n                        }\n                        #global-auth-modal .btn-primary:hover {\n                            transform: translateY(-2px);\n                            box-shadow: 0 5px 15px rgba(0,0,0,0.2);\n                        }\n                        #global-auth-modal .input-group-text {\n                            background-color: #f8f9fa;\n                            border-color: #ced4da;\n                        }\n                    </style>\n                ')}},updateUIForAuthenticatedUser:function(){$(".auth-required").hide(),$(".auth-not-required").show(),window.adeptusAuthData&&window.adeptusAuthData.user_name&&$(".user-name").text(window.adeptusAuthData.user_name)},isAuthenticated:function(){return window.adeptusAuthData&&window.adeptusAuthData.user_authorized&&window.adeptusAuthData.has_api_key},getAuthData:function(){return window.adeptusAuthData||null},logout:function(){window.adeptusAuthData=null,this.showModal(),$(document).trigger("adeptus:enableReadOnly"),this.updateUIForUnauthenticatedUser()},updateUIForUnauthenticatedUser:function(){$(".auth-required").show(),$(".auth-not-required").hide(),$(".user-name").text("Guest")}}}));

//# sourceMappingURL=global_auth.min.js.map