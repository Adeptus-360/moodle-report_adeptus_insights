define(["jquery","core/notification"],function(a,t){"use strict";var e={init:function(){a(document).on("adeptus:enableReadOnly",function(){e.enable()}),a(document).on("adeptus:disableReadOnly",function(){e.disable()}),window.adeptusAuthData&&e.checkInitialState()},checkInitialState:function(){var t=window.adeptusAuthData;t&&t.user_authorized&&t.has_api_key&&!(t.auth_errors&&0<t.auth_errors)||this.enable()},enable:function(){a("body").addClass("adeptus-readonly-mode"),this.disableInteractiveElements(),this.showReadOnlyNotification(),this.disableForms(),this.disableButtons(),a(document).trigger("adeptus:readOnlyEnabled")},disable:function(){a("body").removeClass("adeptus-readonly-mode"),this.enableInteractiveElements(),this.hideReadOnlyNotification(),this.enableForms(),this.enableButtons(),a(document).trigger("adeptus:readOnlyDisabled")},disableInteractiveElements:function(){a("input, textarea, select").prop("disabled",!0),a("a:not(.nav-link):not(.breadcrumb-item a)").addClass("disabled").css("pointer-events","none"),a("button:not(.nav-toggle)").prop("disabled",!0),a("form").on("submit.adeptus-readonly",function(t){return t.preventDefault(),!1})},enableInteractiveElements:function(){a("input, textarea, select").prop("disabled",!1),a("a.disabled").removeClass("disabled").css("pointer-events",""),a("button").prop("disabled",!1),a("form").off("submit.adeptus-readonly")},disableForms:function(){a("form").each(function(){var t=a(this);t.data("adeptus-original-action")||(t.data("adeptus-original-action",t.attr("action")),t.attr("action","javascript:void(0)"))})},enableForms:function(){a("form").each(function(){var t=a(this),e=t.data("adeptus-original-action");e&&(t.attr("action",e),t.removeData("adeptus-original-action"))})},disableButtons:function(){a("button:not(.nav-toggle)").each(function(){var t=a(this);t.data("adeptus-original-text")||(t.data("adeptus-original-text",t.text()),t.text("Read-Only Mode"),t.addClass("btn-secondary").removeClass("btn-primary btn-success btn-danger btn-warning btn-info"))})},enableButtons:function(){a("button").each(function(){var t=a(this),e=t.data("adeptus-original-text");e&&(t.text(e),t.removeData("adeptus-original-text"),t.removeClass("btn-secondary"))})},showReadOnlyNotification:function(){t?this.readOnlyNotification=t.addNotification({message:"Plugin is in read-only mode due to authentication issues",type:"warning",closebutton:!1}):this.readOnlyAlertShown||(alert("Plugin is in read-only mode due to authentication issues"),this.readOnlyAlertShown=!0)},hideReadOnlyNotification:function(){this.readOnlyNotification&&t&&(t.closeNotification(this.readOnlyNotification),this.readOnlyNotification=null),this.readOnlyAlertShown=!1},isEnabled:function(){return a("body").hasClass("adeptus-readonly-mode")}};return e});