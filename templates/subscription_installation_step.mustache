{{!
    This file is part of Moodle - http://moodle.org/

    Moodle is free software: you can redistribute it and/or modify
    it under the terms of the GNU General Public License as published by
    the Free Software Foundation, either version 3 of the License, or
    (at your option) any later version.

    Moodle is distributed in the hope that it will be useful,
    but WITHOUT ANY WARRANTY; without even the implied warranty of
    MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
    GNU General Public License for more details.

    You should have received a copy of the GNU General Public License
    along with Moodle.  If not, see <http://www.gnu.org/licenses/>.
}}
{{!
    @template   report_adeptus_insights/subscription_installation_step

    Subscription installation step template providing enterprise-grade subscription
    selection with monthly/annual toggle and plan comparison features.

    Example context (json):
    {
        "plans": [{"name": "Free", "price": 0}]
    }

    @package    report_adeptus_insights
    @copyright  2026 Adeptus 360 <info@adeptus360.com>
    @license    http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later
}}

<div class="adeptus-installation-container">
    <!-- Installation Header -->
    <div class="adeptus-installation-header">
        <h1><i class="fa fa-rocket"></i> {{#str}}choose_your_plan, report_adeptus_insights{{/str}}</h1>
        <p>{{#str}}select_plan_fits, report_adeptus_insights{{/str}}</p>
    </div>

    <!-- Installation Progress -->
    <div class="adeptus-installation-progress">
        <div class="adeptus-progress-step completed">
            <div class="adeptus-step-number"><i class="fa fa-check"></i></div>
            <div class="adeptus-step-label">{{#str}}step_registration, report_adeptus_insights{{/str}}</div>
        </div>
        <div class="adeptus-progress-connector completed"></div>
        <div class="adeptus-progress-step current">
            <div class="adeptus-step-number">2</div>
            <div class="adeptus-step-label">{{#str}}step_choose_plan, report_adeptus_insights{{/str}}</div>
        </div>
        <div class="adeptus-progress-connector"></div>
        <div class="adeptus-progress-step pending">
            <div class="adeptus-step-number">3</div>
            <div class="adeptus-step-label">{{#str}}step_complete, report_adeptus_insights{{/str}}</div>
        </div>
    </div>

    <!-- Billing Toggle -->
    <div class="adeptus-billing-toggle-container">
        <div class="adeptus-billing-toggle">
            <button type="button" class="adeptus-billing-toggle-btn active" data-interval="monthly">
                {{#str}}monthly, report_adeptus_insights{{/str}}
            </button>
            <button type="button" class="adeptus-billing-toggle-btn" data-interval="yearly">
                {{#str}}annual, report_adeptus_insights{{/str}}
                {{#max_yearly_savings}}<span class="adeptus-savings-badge">{{#str}}save, report_adeptus_insights{{/str}} {{max_yearly_savings}}%</span>{{/max_yearly_savings}}
            </button>
        </div>
    </div>

    <!-- Plans Section -->
    <div class="adeptus-plans-section">
        <div class="adeptus-plans-grid" id="plans-container">
            {{#monthly_plans}}
            <div class="adeptus-plan-card {{#is_popular}}popular{{/is_popular}} {{#is_current}}current{{/is_current}}" data-tier="{{tier}}" data-interval="monthly">
                {{#is_popular}}<div class="adeptus-plan-badge popular">{{#str}}most_popular, report_adeptus_insights{{/str}}</div>{{/is_popular}}
                {{#is_current}}<div class="adeptus-plan-badge current">{{#str}}current_plan, report_adeptus_insights{{/str}}</div>{{/is_current}}

                <div class="adeptus-plan-header">
                    <div class="adeptus-plan-name">{{short_name}}</div>
                    <div class="adeptus-plan-description">{{description}}</div>
                </div>

                <div class="adeptus-plan-price">
                    {{#is_free}}
                    <div class="adeptus-price-free">{{#str}}free, report_adeptus_insights{{/str}}</div>
                    <div class="adeptus-price-period">{{#str}}forever, report_adeptus_insights{{/str}}</div>
                    {{/is_free}}
                    {{^is_free}}
                    <div class="adeptus-price-amount">
                        <span class="adeptus-currency">$</span>{{price_formatted}}
                    </div>
                    <div class="adeptus-price-period">{{#str}}per_month, report_adeptus_insights{{/str}}</div>
                    {{/is_free}}
                </div>

                <div class="adeptus-plan-limits">
                    <div class="adeptus-limit-item">
                        <div class="adeptus-limit-value">{{tokens_limit}}</div>
                        <div class="adeptus-limit-label">{{#str}}ai_tokens, report_adeptus_insights{{/str}}</div>
                    </div>
                    <div class="adeptus-limit-item">
                        <div class="adeptus-limit-value">{{exports_limit}}</div>
                        <div class="adeptus-limit-label">{{#str}}exports_mo, report_adeptus_insights{{/str}}</div>
                    </div>
                    <div class="adeptus-limit-item">
                        <div class="adeptus-limit-value">{{reports_limit}}</div>
                        <div class="adeptus-limit-label">{{#str}}saved_reports, report_adeptus_insights{{/str}}</div>
                    </div>
                    <div class="adeptus-limit-item">
                        <div class="adeptus-limit-value">{{export_formats}}</div>
                        <div class="adeptus-limit-label">{{#str}}formats, report_adeptus_insights{{/str}}</div>
                    </div>
                </div>

                <div class="adeptus-plan-features">
                    <ul>
                        {{#features}}
                        <li><i class="fa fa-check"></i> {{.}}</li>
                        {{/features}}
                    </ul>
                </div>

                <div class="adeptus-plan-action">
                    {{#is_current}}
                    <button class="adeptus-plan-btn adeptus-plan-btn-current" disabled>
                        <i class="fa fa-check-circle"></i> {{#str}}current_plan, report_adeptus_insights{{/str}}
                    </button>
                    {{/is_current}}
                    {{^is_current}}
                    {{#is_free}}
                    <button class="adeptus-plan-btn adeptus-plan-btn-outline select-adeptus-plan-btn" data-plan-id="{{id}}" data-adeptus-plan-name="{{name}}">
                        {{#str}}select_free_plan, report_adeptus_insights{{/str}}
                    </button>
                    {{/is_free}}
                    {{^is_free}}
                    <button class="adeptus-plan-btn adeptus-plan-btn-primary select-adeptus-plan-btn" data-plan-id="{{id}}" data-adeptus-plan-name="{{name}}" data-stripe-product="{{stripe_product_id}}">
                        <i class="fa fa-arrow-up"></i> {{#str}}upgrade_to, report_adeptus_insights{{/str}} {{short_name}}
                    </button>
                    {{/is_free}}
                    {{/is_current}}
                </div>
            </div>
            {{/monthly_plans}}
        </div>
    </div>

    <!-- Hidden form for plan selection submission -->
    <form id="complete-installation-form" method="post" class="d-none">
        <input type="hidden" name="sesskey" value="{{sesskey}}">
        <input type="hidden" name="action" value="completeinstallation">
    </form>
</div>
